<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 13 String processing and text mining | Data Science with R</title>
  <meta name="description" content="A comprehensive guide to data science using R, covering fundamentals, visualization, statistics, machine learning with tidymodels, and generative AI integration. Third Edition by Daniel Paredes." />
  <meta name="generator" content="bookdown 0.46 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 13 String processing and text mining | Data Science with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A comprehensive guide to data science using R, covering fundamentals, visualization, statistics, machine learning with tidymodels, and generative AI integration. Third Edition by Daniel Paredes." />
  <meta name="github-repo" content="dparedesi/Data-Science-with-R-book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 13 String processing and text mining | Data Science with R" />
  
  <meta name="twitter:description" content="A comprehensive guide to data science using R, covering fundamentals, visualization, statistics, machine learning with tidymodels, and generative AI integration. Third Edition by Daniel Paredes." />
  

<meta name="author" content="Author: Mg. Daniel Paredes Inilupu" />


<meta name="date" content="2025-12-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="unsupervised-learning.html"/>
<link rel="next" href="genai-intro.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics: Sin Vista -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VJJ963010J"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VJJ963010J');
</script>

<!-- Global site tag (gtag.js) - Google Analytics: Vista -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-165839710-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-165839710-1');
</script>

<!-- Global site tag (gtag.js) - Google Analytics: Agentedec4mbio -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-17876479-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-17876479-1');
</script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Science with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#support-this-work"><i class="fa fa-check"></i>Support This Work</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#stay-connected"><i class="fa fa-check"></i>Stay Connected</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="acknowledgments.html"><a href="acknowledgments.html"><i class="fa fa-check"></i>Acknowledgments</a>
<ul>
<li class="chapter" data-level="" data-path="acknowledgments.html"><a href="acknowledgments.html#family"><i class="fa fa-check"></i>Family</a></li>
<li class="chapter" data-level="" data-path="acknowledgments.html"><a href="acknowledgments.html#mentors-and-inspirations"><i class="fa fa-check"></i>Mentors and Inspirations</a></li>
<li class="chapter" data-level="" data-path="acknowledgments.html"><a href="acknowledgments.html#contributors"><i class="fa fa-check"></i>Contributors</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#why-r"><i class="fa fa-check"></i>Why R?</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#installing-r"><i class="fa fa-check"></i>Installing R</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#installing-rstudio"><i class="fa fa-check"></i>Installing RStudio</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#rstudio-sections"><i class="fa fa-check"></i>RStudio Sections</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#essential-keyboard-shortcuts"><i class="fa fa-check"></i>Essential Keyboard Shortcuts</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#testing-your-installation"><i class="fa fa-check"></i>Testing Your Installation</a>
<ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#writing-scripts"><i class="fa fa-check"></i>Writing Scripts</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#whats-next"><i class="fa fa-check"></i>What’s Next?</a></li>
</ul></li>
<li class="part"><span><b>I Fundamentals and Key Tools</b></span></li>
<li class="chapter" data-level="1" data-path="objects.html"><a href="objects.html"><i class="fa fa-check"></i><b>1</b> Objects</a>
<ul>
<li class="chapter" data-level="1.1" data-path="objects.html"><a href="objects.html#what-are-objects-in-r"><i class="fa fa-check"></i><b>1.1</b> What are objects in R?</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="objects.html"><a href="objects.html#r-as-an-object-oriented-language"><i class="fa fa-check"></i><b>1.1.1</b> R as an object-oriented language</a></li>
<li class="chapter" data-level="1.1.2" data-path="objects.html"><a href="objects.html#the-power-of-abstraction"><i class="fa fa-check"></i><b>1.1.2</b> The power of abstraction</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="objects.html"><a href="objects.html#variables-the-first-objects-on-your-journey"><i class="fa fa-check"></i><b>1.2</b> Variables: The first objects on your journey</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="objects.html"><a href="objects.html#creating-variables-in-r"><i class="fa fa-check"></i><b>1.2.1</b> Creating variables in R</a></li>
<li class="chapter" data-level="1.2.2" data-path="objects.html"><a href="objects.html#operations-with-variables"><i class="fa fa-check"></i><b>1.2.2</b> Operations with variables</a></li>
<li class="chapter" data-level="1.2.3" data-path="objects.html"><a href="objects.html#best-practices-for-naming-variables"><i class="fa fa-check"></i><b>1.2.3</b> Best practices for naming variables</a></li>
<li class="chapter" data-level="1.2.4" data-path="objects.html"><a href="objects.html#data-types"><i class="fa fa-check"></i><b>1.2.4</b> Data types</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="objects.html"><a href="objects.html#object-types-for-complex-data"><i class="fa fa-check"></i><b>1.3</b> Object types for complex data</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="objects.html"><a href="objects.html#vectors-organizing-information-of-the-same-type"><i class="fa fa-check"></i><b>1.3.1</b> Vectors: organizing information of the same type</a></li>
<li class="chapter" data-level="1.3.2" data-path="objects.html"><a href="objects.html#lists-grouping-objects-of-different-types"><i class="fa fa-check"></i><b>1.3.2</b> Lists: grouping objects of different types</a></li>
<li class="chapter" data-level="1.3.3" data-path="objects.html"><a href="objects.html#matrices-organizing-data-in-rows-and-columns"><i class="fa fa-check"></i><b>1.3.3</b> Matrices: organizing data in rows and columns</a></li>
<li class="chapter" data-level="1.3.4" data-path="objects.html"><a href="objects.html#arrays-multidimensional-matrices"><i class="fa fa-check"></i><b>1.3.4</b> Arrays: multidimensional matrices</a></li>
<li class="chapter" data-level="1.3.5" data-path="objects.html"><a href="objects.html#factors-representing-categorical-data"><i class="fa fa-check"></i><b>1.3.5</b> Factors: representing categorical data</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="objects.html"><a href="objects.html#the-universe-of-objects-in-r"><i class="fa fa-check"></i><b>1.4</b> The Universe of Objects in R</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="objects.html"><a href="objects.html#philosophy-of-objects-in-r"><i class="fa fa-check"></i><b>1.4.1</b> Philosophy of objects in R</a></li>
<li class="chapter" data-level="1.4.2" data-path="objects.html"><a href="objects.html#comparison-with-other-languages"><i class="fa fa-check"></i><b>1.4.2</b> Comparison with other languages</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="objects.html"><a href="objects.html#exercises"><i class="fa fa-check"></i><b>1.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>2</b> Functions</a>
<ul>
<li class="chapter" data-level="2.1" data-path="functions.html"><a href="functions.html#introduction-to-the-world-of-functions"><i class="fa fa-check"></i><b>2.1</b> Introduction to the world of functions</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="functions.html"><a href="functions.html#what-are-functions"><i class="fa fa-check"></i><b>2.1.1</b> What are functions?</a></li>
<li class="chapter" data-level="2.1.2" data-path="functions.html"><a href="functions.html#why-use-functions"><i class="fa fa-check"></i><b>2.1.2</b> Why use functions?</a></li>
<li class="chapter" data-level="2.1.3" data-path="functions.html"><a href="functions.html#first-functions-exploring-basic-r-functions"><i class="fa fa-check"></i><b>2.1.3</b> First functions: exploring basic R functions</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="functions.html"><a href="functions.html#anatomy-of-a-function"><i class="fa fa-check"></i><b>2.2</b> Anatomy of a function</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="functions.html"><a href="functions.html#arguments-the-ingredients-of-the-function"><i class="fa fa-check"></i><b>2.2.1</b> Arguments: the ingredients of the function</a></li>
<li class="chapter" data-level="2.2.2" data-path="functions.html"><a href="functions.html#body-the-instructions-of-the-function"><i class="fa fa-check"></i><b>2.2.2</b> Body: the instructions of the function</a></li>
<li class="chapter" data-level="2.2.3" data-path="functions.html"><a href="functions.html#return-value-the-result-of-the-function"><i class="fa fa-check"></i><b>2.2.3</b> Return value: the result of the function</a></li>
<li class="chapter" data-level="2.2.4" data-path="functions.html"><a href="functions.html#examples-creating-simple-functions-step-by-step"><i class="fa fa-check"></i><b>2.2.4</b> Examples: creating simple functions step by step</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="functions.html"><a href="functions.html#mastering-the-use-of-functions"><i class="fa fa-check"></i><b>2.3</b> Mastering the use of functions</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="functions.html"><a href="functions.html#functions-with-a-variable-number-of-arguments-...-adapting-to-different-situations"><i class="fa fa-check"></i><b>2.3.1</b> Functions with a variable number of arguments (<code>...</code>): Adapting to different situations</a></li>
<li class="chapter" data-level="2.3.2" data-path="functions.html"><a href="functions.html#variable-scope-local-and-global-variables"><i class="fa fa-check"></i><b>2.3.2</b> Variable scope: local and global variables</a></li>
<li class="chapter" data-level="2.3.3" data-path="functions.html"><a href="functions.html#examples-functions-to-calculate-taxes-discounts-etc."><i class="fa fa-check"></i><b>2.3.3</b> Examples: functions to calculate taxes, discounts, etc.</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="functions.html"><a href="functions.html#higher-order-functions"><i class="fa fa-check"></i><b>2.4</b> Higher-order functions</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="functions.html"><a href="functions.html#lapply-and-sapply-applying-a-function-to-each-element"><i class="fa fa-check"></i><b>2.4.1</b> <code>lapply()</code> and <code>sapply()</code>: applying a function to each element</a></li>
<li class="chapter" data-level="2.4.2" data-path="functions.html"><a href="functions.html#apply-applying-a-function-to-rows-or-columns"><i class="fa fa-check"></i><b>2.4.2</b> <code>apply()</code>: applying a function to rows or columns</a></li>
<li class="chapter" data-level="2.4.3" data-path="functions.html"><a href="functions.html#mapply-applying-a-function-to-multiple-arguments"><i class="fa fa-check"></i><b>2.4.3</b> <code>mapply()</code>: applying a function to multiple arguments</a></li>
<li class="chapter" data-level="2.4.4" data-path="functions.html"><a href="functions.html#examples-data-analysis-with-higher-order-functions"><i class="fa fa-check"></i><b>2.4.4</b> Examples: data analysis with higher-order functions</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="functions.html"><a href="functions.html#closures-functions-with-memory"><i class="fa fa-check"></i><b>2.5</b> Closures: functions with memory</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="functions.html"><a href="functions.html#concept-functions-that-remember"><i class="fa fa-check"></i><b>2.5.1</b> Concept: functions that “remember”</a></li>
<li class="chapter" data-level="2.5.2" data-path="functions.html"><a href="functions.html#applications-creating-counters-functions-with-internal-state"><i class="fa fa-check"></i><b>2.5.2</b> Applications: creating counters, functions with internal state</a></li>
<li class="chapter" data-level="2.5.3" data-path="functions.html"><a href="functions.html#examples-simulating-a-game-creating-an-operation-history"><i class="fa fa-check"></i><b>2.5.3</b> Examples: simulating a game, creating an operation history</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="functions.html"><a href="functions.html#debugging-and-error-handling-solving-the-mysteries-of-your-code"><i class="fa fa-check"></i><b>2.6</b> Debugging and error handling: solving the mysteries of your code</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="functions.html"><a href="functions.html#identifying-errors-common-error-messages-in-r"><i class="fa fa-check"></i><b>2.6.1</b> Identifying errors: common error messages in R</a></li>
<li class="chapter" data-level="2.6.2" data-path="functions.html"><a href="functions.html#debugging-tools-debug-traceback"><i class="fa fa-check"></i><b>2.6.2</b> Debugging tools: <code>debug()</code>, <code>traceback()</code></a></li>
<li class="chapter" data-level="2.6.3" data-path="functions.html"><a href="functions.html#error-handling-trycatch"><i class="fa fa-check"></i><b>2.6.3</b> Error handling: <code>tryCatch()</code></a></li>
<li class="chapter" data-level="2.6.4" data-path="functions.html"><a href="functions.html#examples-debugging-functions-with-errors-handling-exceptions"><i class="fa fa-check"></i><b>2.6.4</b> Examples: debugging functions with errors, handling exceptions</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="functions.html"><a href="functions.html#exercises-1"><i class="fa fa-check"></i><b>2.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-frames.html"><a href="data-frames.html"><i class="fa fa-check"></i><b>3</b> Data Frames</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-frames.html"><a href="data-frames.html#introduction-to-data-frames"><i class="fa fa-check"></i><b>3.1</b> Introduction to Data Frames</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="data-frames.html"><a href="data-frames.html#what-are-data-frames"><i class="fa fa-check"></i><b>3.1.1</b> What are data frames?</a></li>
<li class="chapter" data-level="3.1.2" data-path="data-frames.html"><a href="data-frames.html#why-data-frames"><i class="fa fa-check"></i><b>3.1.2</b> Why data frames?</a></li>
<li class="chapter" data-level="3.1.3" data-path="data-frames.html"><a href="data-frames.html#data-frames-in-action-exploring-information-about-the-united-states"><i class="fa fa-check"></i><b>3.1.3</b> Data Frames in action: exploring information about the United States</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-frames.html"><a href="data-frames.html#creating-data-frames-building-your-database-for-the-move"><i class="fa fa-check"></i><b>3.2</b> Creating Data Frames: Building your database for the move</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data-frames.html"><a href="data-frames.html#importing-data-from-files-csv-excel"><i class="fa fa-check"></i><b>3.2.1</b> Importing data from files: CSV, Excel</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-frames.html"><a href="data-frames.html#creating-data-frames-manually"><i class="fa fa-check"></i><b>3.2.2</b> Creating data frames manually</a></li>
<li class="chapter" data-level="3.2.3" data-path="data-frames.html"><a href="data-frames.html#examples"><i class="fa fa-check"></i><b>3.2.3</b> Examples</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-frames.html"><a href="data-frames.html#exploring-data-frames-discovering-the-secrets-of-your-data"><i class="fa fa-check"></i><b>3.3</b> Exploring Data Frames: Discovering the secrets of your data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="data-frames.html"><a href="data-frames.html#accessing-rows-columns-and-cells"><i class="fa fa-check"></i><b>3.3.1</b> Accessing rows, columns, and cells</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-frames.html"><a href="data-frames.html#functions-for-exploring-data-frames"><i class="fa fa-check"></i><b>3.3.2</b> Functions for exploring data frames</a></li>
<li class="chapter" data-level="3.3.3" data-path="data-frames.html"><a href="data-frames.html#examples-exploring-data-frames-with-move-information"><i class="fa fa-check"></i><b>3.3.3</b> Examples: exploring data frames with move information</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-frames.html"><a href="data-frames.html#manipulating-data-frames-transforming-your-data"><i class="fa fa-check"></i><b>3.4</b> Manipulating Data Frames: Transforming your data</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="data-frames.html"><a href="data-frames.html#introduction-to-the-pipeline-operator"><i class="fa fa-check"></i><b>3.4.1</b> Introduction to the pipeline operator (<code>|&gt;</code>)</a></li>
<li class="chapter" data-level="3.4.2" data-path="data-frames.html"><a href="data-frames.html#transforming-a-table-with-mutate"><i class="fa fa-check"></i><b>3.4.2</b> Transforming a table with <code>mutate()</code></a></li>
<li class="chapter" data-level="3.4.3" data-path="data-frames.html"><a href="data-frames.html#filtering-data-selecting-cities-that-interest-you"><i class="fa fa-check"></i><b>3.4.3</b> Filtering data: selecting cities that interest you</a></li>
<li class="chapter" data-level="3.4.4" data-path="data-frames.html"><a href="data-frames.html#sorting-data-finding-the-safest-cities"><i class="fa fa-check"></i><b>3.4.4</b> Sorting data: finding the safest cities</a></li>
<li class="chapter" data-level="3.4.5" data-path="data-frames.html"><a href="data-frames.html#aggregating-and-summarizing-data-obtaining-general-overview"><i class="fa fa-check"></i><b>3.4.5</b> Aggregating and summarizing data: obtaining general overview</a></li>
<li class="chapter" data-level="3.4.6" data-path="data-frames.html"><a href="data-frames.html#joining-data-frames-combining-information"><i class="fa fa-check"></i><b>3.4.6</b> Joining data frames: combining information</a></li>
<li class="chapter" data-level="3.4.7" data-path="data-frames.html"><a href="data-frames.html#examples-1"><i class="fa fa-check"></i><b>3.4.7</b> Examples</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="data-frames.html"><a href="data-frames.html#exercises-2"><i class="fa fa-check"></i><b>3.5</b> Exercises</a></li>
<li class="chapter" data-level="3.6" data-path="data-frames.html"><a href="data-frames.html#data-frames-in-plots"><i class="fa fa-check"></i><b>3.6</b> Data frames in plots</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="data-frames.html"><a href="data-frames.html#scatter-plots"><i class="fa fa-check"></i><b>3.6.1</b> Scatter plots</a></li>
<li class="chapter" data-level="3.6.2" data-path="data-frames.html"><a href="data-frames.html#histograms"><i class="fa fa-check"></i><b>3.6.2</b> Histograms</a></li>
<li class="chapter" data-level="3.6.3" data-path="data-frames.html"><a href="data-frames.html#box-plot"><i class="fa fa-check"></i><b>3.6.3</b> Box plot</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="data-frames.html"><a href="data-frames.html#data-interpretation"><i class="fa fa-check"></i><b>3.7</b> Data interpretation</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="data-frames.html"><a href="data-frames.html#quartiles"><i class="fa fa-check"></i><b>3.7.1</b> Quartiles</a></li>
<li class="chapter" data-level="3.7.2" data-path="data-frames.html"><a href="data-frames.html#interpretation-of-box-plot"><i class="fa fa-check"></i><b>3.7.2</b> Interpretation of box plot</a></li>
<li class="chapter" data-level="3.7.3" data-path="data-frames.html"><a href="data-frames.html#examples-2"><i class="fa fa-check"></i><b>3.7.3</b> Examples</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="data-frames.html"><a href="data-frames.html#exercises-3"><i class="fa fa-check"></i><b>3.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="advanced-techniques.html"><a href="advanced-techniques.html"><i class="fa fa-check"></i><b>4</b> Advanced Techniques</a>
<ul>
<li class="chapter" data-level="4.1" data-path="advanced-techniques.html"><a href="advanced-techniques.html#metaprogramming-writing-code-that-writes-code"><i class="fa fa-check"></i><b>4.1</b> Metaprogramming: writing code that writes code</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="advanced-techniques.html"><a href="advanced-techniques.html#manipulating-expressions-the-art-of-sculpting-code"><i class="fa fa-check"></i><b>4.1.1</b> Manipulating expressions: The art of sculpting code</a></li>
<li class="chapter" data-level="4.1.2" data-path="advanced-techniques.html"><a href="advanced-techniques.html#examples-3"><i class="fa fa-check"></i><b>4.1.2</b> Examples</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="advanced-techniques.html"><a href="advanced-techniques.html#functional-programming-a-new-paradigm"><i class="fa fa-check"></i><b>4.2</b> Functional programming: a new paradigm</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="advanced-techniques.html"><a href="advanced-techniques.html#basic-principles-of-functional-programming"><i class="fa fa-check"></i><b>4.2.1</b> Basic principles of functional programming</a></li>
<li class="chapter" data-level="4.2.2" data-path="advanced-techniques.html"><a href="advanced-techniques.html#higher-order-functions-in-r"><i class="fa fa-check"></i><b>4.2.2</b> Higher-order functions in R</a></li>
<li class="chapter" data-level="4.2.3" data-path="advanced-techniques.html"><a href="advanced-techniques.html#examples-4"><i class="fa fa-check"></i><b>4.2.3</b> Examples</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="advanced-techniques.html"><a href="advanced-techniques.html#r6-the-future-of-oop-in-r"><i class="fa fa-check"></i><b>4.3</b> R6: The future of OOP in R</a></li>
<li class="chapter" data-level="4.4" data-path="advanced-techniques.html"><a href="advanced-techniques.html#exercises-4"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>II Data Visualization and Summarization</b></span></li>
<li class="chapter" data-level="5" data-path="ggplot-and-dplyr.html"><a href="ggplot-and-dplyr.html"><i class="fa fa-check"></i><b>5</b> Ggplot and dplyr</a>
<ul>
<li class="chapter" data-level="5.1" data-path="ggplot-and-dplyr.html"><a href="ggplot-and-dplyr.html#creating-the-ggplot-object"><i class="fa fa-check"></i><b>5.1</b> Creating the ggplot object</a></li>
<li class="chapter" data-level="5.2" data-path="ggplot-and-dplyr.html"><a href="ggplot-and-dplyr.html#aesthetic-mapping-layer"><i class="fa fa-check"></i><b>5.2</b> Aesthetic mapping layer</a></li>
<li class="chapter" data-level="5.3" data-path="ggplot-and-dplyr.html"><a href="ggplot-and-dplyr.html#geoms-layer"><i class="fa fa-check"></i><b>5.3</b> Geoms layer</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="ggplot-and-dplyr.html"><a href="ggplot-and-dplyr.html#tweaking-aes-and-geoms"><i class="fa fa-check"></i><b>5.3.1</b> Tweaking aes and geoms</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="ggplot-and-dplyr.html"><a href="ggplot-and-dplyr.html#scale-layer"><i class="fa fa-check"></i><b>5.4</b> Scale layer</a></li>
<li class="chapter" data-level="5.5" data-path="ggplot-and-dplyr.html"><a href="ggplot-and-dplyr.html#label-title-and-legend-layer"><i class="fa fa-check"></i><b>5.5</b> Label, title and legend layer</a></li>
<li class="chapter" data-level="5.6" data-path="ggplot-and-dplyr.html"><a href="ggplot-and-dplyr.html#reference-lines"><i class="fa fa-check"></i><b>5.6</b> Reference lines</a></li>
<li class="chapter" data-level="5.7" data-path="ggplot-and-dplyr.html"><a href="ggplot-and-dplyr.html#changing-the-plot-style"><i class="fa fa-check"></i><b>5.7</b> Changing the plot style</a></li>
<li class="chapter" data-level="5.8" data-path="ggplot-and-dplyr.html"><a href="ggplot-and-dplyr.html#saving-plots"><i class="fa fa-check"></i><b>5.8</b> Saving plots</a></li>
<li class="chapter" data-level="5.9" data-path="ggplot-and-dplyr.html"><a href="ggplot-and-dplyr.html#summarizing-data-with-dplyr"><i class="fa fa-check"></i><b>5.9</b> Summarizing data with dplyr</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="ggplot-and-dplyr.html"><a href="ggplot-and-dplyr.html#summarize-function"><i class="fa fa-check"></i><b>5.9.1</b> Summarize function</a></li>
<li class="chapter" data-level="5.9.2" data-path="ggplot-and-dplyr.html"><a href="ggplot-and-dplyr.html#group-by-function"><i class="fa fa-check"></i><b>5.9.2</b> Group By Function</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="ggplot-and-dplyr.html"><a href="ggplot-and-dplyr.html#exercises-5"><i class="fa fa-check"></i><b>5.10</b> Exercises</a></li>
<li class="chapter" data-level="5.11" data-path="ggplot-and-dplyr.html"><a href="ggplot-and-dplyr.html#key-takeaways"><i class="fa fa-check"></i><b>5.11</b> Key Takeaways</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="gapminder.html"><a href="gapminder.html"><i class="fa fa-check"></i><b>6</b> Gapminder</a>
<ul>
<li class="chapter" data-level="6.1" data-path="gapminder.html"><a href="gapminder.html#initial-gapminder-plots"><i class="fa fa-check"></i><b>6.1</b> Initial gapminder plots</a></li>
<li class="chapter" data-level="6.2" data-path="gapminder.html"><a href="gapminder.html#facets"><i class="fa fa-check"></i><b>6.2</b> Facets</a></li>
<li class="chapter" data-level="6.3" data-path="gapminder.html"><a href="gapminder.html#time-series"><i class="fa fa-check"></i><b>6.3</b> Time series</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="gapminder.html"><a href="gapminder.html#individual-time-series"><i class="fa fa-check"></i><b>6.3.1</b> Individual time series</a></li>
<li class="chapter" data-level="6.3.2" data-path="gapminder.html"><a href="gapminder.html#multiple-time-series"><i class="fa fa-check"></i><b>6.3.2</b> Multiple time series</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="gapminder.html"><a href="gapminder.html#exercises-6"><i class="fa fa-check"></i><b>6.4</b> Exercises</a></li>
<li class="chapter" data-level="6.5" data-path="gapminder.html"><a href="gapminder.html#histograms-with-ggplot"><i class="fa fa-check"></i><b>6.5</b> Histograms with ggplot</a></li>
<li class="chapter" data-level="6.6" data-path="gapminder.html"><a href="gapminder.html#box-plots-with-ggplot"><i class="fa fa-check"></i><b>6.6</b> Box plots with ggplot</a></li>
<li class="chapter" data-level="6.7" data-path="gapminder.html"><a href="gapminder.html#comparison-of-distributions"><i class="fa fa-check"></i><b>6.7</b> Comparison of distributions</a></li>
<li class="chapter" data-level="6.8" data-path="gapminder.html"><a href="gapminder.html#exercises-7"><i class="fa fa-check"></i><b>6.8</b> Exercises</a></li>
<li class="chapter" data-level="6.9" data-path="gapminder.html"><a href="gapminder.html#key-takeaways-1"><i class="fa fa-check"></i><b>6.9</b> Key Takeaways</a></li>
</ul></li>
<li class="part"><span><b>III Statistics</b></span></li>
<li class="chapter" data-level="" data-path="introduction-to-probabilities.html"><a href="introduction-to-probabilities.html"><i class="fa fa-check"></i>Introduction to Probabilities</a></li>
<li class="chapter" data-level="7" data-path="discrete-probabilities.html"><a href="discrete-probabilities.html"><i class="fa fa-check"></i><b>7</b> Discrete Probabilities</a>
<ul>
<li class="chapter" data-level="7.1" data-path="discrete-probabilities.html"><a href="discrete-probabilities.html#calculation-using-the-mathematical-definition"><i class="fa fa-check"></i><b>7.1</b> Calculation using the mathematical definition</a></li>
<li class="chapter" data-level="7.2" data-path="discrete-probabilities.html"><a href="discrete-probabilities.html#monte-carlo-simulation-for-discrete-variables"><i class="fa fa-check"></i><b>7.2</b> Monte Carlo Simulation for Discrete Variables</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="discrete-probabilities.html"><a href="discrete-probabilities.html#other-functions-to-create-vectors"><i class="fa fa-check"></i><b>7.2.1</b> Other functions to create vectors</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="discrete-probabilities.html"><a href="discrete-probabilities.html#exercises-8"><i class="fa fa-check"></i><b>7.3</b> Exercises</a></li>
<li class="chapter" data-level="7.4" data-path="discrete-probabilities.html"><a href="discrete-probabilities.html#combinations-and-permutations"><i class="fa fa-check"></i><b>7.4</b> Combinations and Permutations</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="discrete-probabilities.html"><a href="discrete-probabilities.html#permutations"><i class="fa fa-check"></i><b>7.4.1</b> Permutations</a></li>
<li class="chapter" data-level="7.4.2" data-path="discrete-probabilities.html"><a href="discrete-probabilities.html#combinations"><i class="fa fa-check"></i><b>7.4.2</b> Combinations</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="discrete-probabilities.html"><a href="discrete-probabilities.html#sufficient-experiments-with-monte-carlo-simulation"><i class="fa fa-check"></i><b>7.5</b> Sufficient Experiments with Monte Carlo Simulation</a></li>
<li class="chapter" data-level="7.6" data-path="discrete-probabilities.html"><a href="discrete-probabilities.html#case-birthdays-in-classrooms"><i class="fa fa-check"></i><b>7.6</b> Case: Birthdays in Classrooms</a></li>
<li class="chapter" data-level="7.7" data-path="discrete-probabilities.html"><a href="discrete-probabilities.html#exercises-9"><i class="fa fa-check"></i><b>7.7</b> Exercises</a></li>
<li class="chapter" data-level="7.8" data-path="discrete-probabilities.html"><a href="discrete-probabilities.html#integrative-exercise"><i class="fa fa-check"></i><b>7.8</b> Integrative Exercise</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="discrete-probabilities.html"><a href="discrete-probabilities.html#monty-hall-problem"><i class="fa fa-check"></i><b>7.8.1</b> Monty Hall Problem</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="continuous-probabilities.html"><a href="continuous-probabilities.html"><i class="fa fa-check"></i><b>8</b> Continuous Probabilities</a>
<ul>
<li class="chapter" data-level="8.1" data-path="continuous-probabilities.html"><a href="continuous-probabilities.html#learning-objectives"><i class="fa fa-check"></i><b>8.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="continuous-probabilities.html"><a href="continuous-probabilities.html#empirical-distribution"><i class="fa fa-check"></i><b>8.2</b> Empirical Distribution</a></li>
<li class="chapter" data-level="8.3" data-path="continuous-probabilities.html"><a href="continuous-probabilities.html#theoretical-distribution"><i class="fa fa-check"></i><b>8.3</b> Theoretical Distribution</a></li>
<li class="chapter" data-level="8.4" data-path="continuous-probabilities.html"><a href="continuous-probabilities.html#key-takeaways-2"><i class="fa fa-check"></i><b>8.4</b> Key Takeaways</a></li>
<li class="chapter" data-level="8.5" data-path="continuous-probabilities.html"><a href="continuous-probabilities.html#exercises-10"><i class="fa fa-check"></i><b>8.5</b> Exercises</a></li>
<li class="chapter" data-level="8.6" data-path="continuous-probabilities.html"><a href="continuous-probabilities.html#monte-carlo-simulation-for-continuous-variables"><i class="fa fa-check"></i><b>8.6</b> Monte Carlo Simulation for Continuous Variables</a></li>
<li class="chapter" data-level="8.7" data-path="continuous-probabilities.html"><a href="continuous-probabilities.html#exercises-11"><i class="fa fa-check"></i><b>8.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="statistical-inference.html"><a href="statistical-inference.html"><i class="fa fa-check"></i><b>9</b> Statistical Inference</a>
<ul>
<li class="chapter" data-level="9.1" data-path="statistical-inference.html"><a href="statistical-inference.html#learning-objectives-1"><i class="fa fa-check"></i><b>9.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="9.2" data-path="statistical-inference.html"><a href="statistical-inference.html#expected-value"><i class="fa fa-check"></i><b>9.2</b> Expected Value</a></li>
<li class="chapter" data-level="9.3" data-path="statistical-inference.html"><a href="statistical-inference.html#central-limit-theorem"><i class="fa fa-check"></i><b>9.3</b> Central Limit Theorem</a></li>
<li class="chapter" data-level="9.4" data-path="statistical-inference.html"><a href="statistical-inference.html#key-takeaways-3"><i class="fa fa-check"></i><b>9.4</b> Key Takeaways</a></li>
<li class="chapter" data-level="9.5" data-path="statistical-inference.html"><a href="statistical-inference.html#exercises-12"><i class="fa fa-check"></i><b>9.5</b> Exercises</a></li>
<li class="chapter" data-level="9.6" data-path="statistical-inference.html"><a href="statistical-inference.html#parameter-estimation-method"><i class="fa fa-check"></i><b>9.6</b> Parameter Estimation Method</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="statistical-inference.html"><a href="statistical-inference.html#margin-of-error"><i class="fa fa-check"></i><b>9.6.1</b> Margin of Error</a></li>
<li class="chapter" data-level="9.6.2" data-path="statistical-inference.html"><a href="statistical-inference.html#confidence-intervals"><i class="fa fa-check"></i><b>9.6.2</b> Confidence Intervals</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="statistical-inference.html"><a href="statistical-inference.html#spread-estimation"><i class="fa fa-check"></i><b>9.7</b> Spread Estimation</a></li>
<li class="chapter" data-level="9.8" data-path="statistical-inference.html"><a href="statistical-inference.html#estimates-outside-election-polls"><i class="fa fa-check"></i><b>9.8</b> Estimates Outside Election Polls</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="statistical-inference.html"><a href="statistical-inference.html#example-estimating-average-height"><i class="fa fa-check"></i><b>9.8.1</b> Example: Estimating Average Height</a></li>
</ul></li>
<li class="chapter" data-level="9.9" data-path="statistical-inference.html"><a href="statistical-inference.html#exercises-13"><i class="fa fa-check"></i><b>9.9</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>IV Data Wrangling</b></span></li>
<li class="chapter" data-level="" data-path="introduction-1.html"><a href="introduction-1.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="10" data-path="data-import-and-consolidation.html"><a href="data-import-and-consolidation.html"><i class="fa fa-check"></i><b>10</b> Data import and consolidation</a>
<ul>
<li class="chapter" data-level="10.1" data-path="data-import-and-consolidation.html"><a href="data-import-and-consolidation.html#importing-from-files"><i class="fa fa-check"></i><b>10.1</b> Importing from files</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="data-import-and-consolidation.html"><a href="data-import-and-consolidation.html#working-directory"><i class="fa fa-check"></i><b>10.1.1</b> Working Directory</a></li>
<li class="chapter" data-level="10.1.2" data-path="data-import-and-consolidation.html"><a href="data-import-and-consolidation.html#readr-and-readxl-packages"><i class="fa fa-check"></i><b>10.1.2</b> readr and readxl packages</a></li>
<li class="chapter" data-level="10.1.3" data-path="data-import-and-consolidation.html"><a href="data-import-and-consolidation.html#importing-files-from-the-internet"><i class="fa fa-check"></i><b>10.1.3</b> Importing files from the internet</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="data-import-and-consolidation.html"><a href="data-import-and-consolidation.html#tidy-data"><i class="fa fa-check"></i><b>10.2</b> Tidy data</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="data-import-and-consolidation.html"><a href="data-import-and-consolidation.html#transforming-to-tidy-data"><i class="fa fa-check"></i><b>10.2.1</b> Transforming to tidy data</a></li>
<li class="chapter" data-level="10.2.2" data-path="data-import-and-consolidation.html"><a href="data-import-and-consolidation.html#separate-function"><i class="fa fa-check"></i><b>10.2.2</b> separate function</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="data-import-and-consolidation.html"><a href="data-import-and-consolidation.html#exercises-14"><i class="fa fa-check"></i><b>10.3</b> Exercises</a></li>
<li class="chapter" data-level="10.4" data-path="data-import-and-consolidation.html"><a href="data-import-and-consolidation.html#joining-tables"><i class="fa fa-check"></i><b>10.4</b> Joining tables</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="data-import-and-consolidation.html"><a href="data-import-and-consolidation.html#join-functions"><i class="fa fa-check"></i><b>10.4.1</b> Join functions</a></li>
<li class="chapter" data-level="10.4.2" data-path="data-import-and-consolidation.html"><a href="data-import-and-consolidation.html#joining-without-a-common-identifier"><i class="fa fa-check"></i><b>10.4.2</b> Joining without a common identifier</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="data-import-and-consolidation.html"><a href="data-import-and-consolidation.html#web-scraping"><i class="fa fa-check"></i><b>10.5</b> Web Scraping</a></li>
<li class="chapter" data-level="10.6" data-path="data-import-and-consolidation.html"><a href="data-import-and-consolidation.html#exercises-15"><i class="fa fa-check"></i><b>10.6</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>V Machine learning</b></span></li>
<li class="chapter" data-level="" data-path="introduction-2.html"><a href="introduction-2.html"><i class="fa fa-check"></i>Introduction</a>
<ul>
<li class="chapter" data-level="10.7" data-path="introduction-2.html"><a href="introduction-2.html#learning-objectives-2"><i class="fa fa-check"></i><b>10.7</b> Learning Objectives</a></li>
<li class="chapter" data-level="10.8" data-path="introduction-2.html"><a href="introduction-2.html#chapter-structure"><i class="fa fa-check"></i><b>10.8</b> Chapter Structure</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="supervised-learning.html"><a href="supervised-learning.html"><i class="fa fa-check"></i><b>11</b> Supervised Learning</a>
<ul>
<li class="chapter" data-level="11.1" data-path="supervised-learning.html"><a href="supervised-learning.html#classification-and-regression"><i class="fa fa-check"></i><b>11.1</b> Classification and Regression</a></li>
<li class="chapter" data-level="11.2" data-path="supervised-learning.html"><a href="supervised-learning.html#knn-k-nearest-neighbors"><i class="fa fa-check"></i><b>11.2</b> kNN: k-Nearest Neighbors</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="supervised-learning.html"><a href="supervised-learning.html#two-variables-as-input"><i class="fa fa-check"></i><b>11.2.1</b> Two variables as input</a></li>
<li class="chapter" data-level="11.2.2" data-path="supervised-learning.html"><a href="supervised-learning.html#multiple-variables-as-input"><i class="fa fa-check"></i><b>11.2.2</b> Multiple variables as input</a></li>
<li class="chapter" data-level="11.2.3" data-path="supervised-learning.html"><a href="supervised-learning.html#diverse-values-of-k"><i class="fa fa-check"></i><b>11.2.3</b> Diverse values of k</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="supervised-learning.html"><a href="supervised-learning.html#tidymodels-framework"><i class="fa fa-check"></i><b>11.3</b> tidymodels Framework</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="supervised-learning.html"><a href="supervised-learning.html#creation-of-training-and-test-data"><i class="fa fa-check"></i><b>11.3.1</b> Creation of training and test data</a></li>
<li class="chapter" data-level="11.3.2" data-path="supervised-learning.html"><a href="supervised-learning.html#training-our-prediction-algorithm"><i class="fa fa-check"></i><b>11.3.2</b> Training our prediction algorithm</a></li>
<li class="chapter" data-level="11.3.3" data-path="supervised-learning.html"><a href="supervised-learning.html#data-pre-processing-with-recipes"><i class="fa fa-check"></i><b>11.3.3</b> Data Pre-processing with Recipes</a></li>
<li class="chapter" data-level="11.3.4" data-path="supervised-learning.html"><a href="supervised-learning.html#creating-a-workflow"><i class="fa fa-check"></i><b>11.3.4</b> Creating a Workflow</a></li>
<li class="chapter" data-level="11.3.5" data-path="supervised-learning.html"><a href="supervised-learning.html#parameter-tuning-with-cross-validation"><i class="fa fa-check"></i><b>11.3.5</b> Parameter Tuning with Cross-Validation</a></li>
<li class="chapter" data-level="11.3.6" data-path="supervised-learning.html"><a href="supervised-learning.html#finalizing-the-model"><i class="fa fa-check"></i><b>11.3.6</b> Finalizing the Model</a></li>
<li class="chapter" data-level="11.3.7" data-path="supervised-learning.html"><a href="supervised-learning.html#testing-the-prediction-model"><i class="fa fa-check"></i><b>11.3.7</b> Testing the prediction model</a></li>
<li class="chapter" data-level="11.3.8" data-path="supervised-learning.html"><a href="supervised-learning.html#model-evaluation-with-yardstick"><i class="fa fa-check"></i><b>11.3.8</b> Model Evaluation with yardstick</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="supervised-learning.html"><a href="supervised-learning.html#confusion-matrix"><i class="fa fa-check"></i><b>11.4</b> Confusion Matrix</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="supervised-learning.html"><a href="supervised-learning.html#accuracy"><i class="fa fa-check"></i><b>11.4.1</b> Accuracy</a></li>
<li class="chapter" data-level="11.4.2" data-path="supervised-learning.html"><a href="supervised-learning.html#sensitivity"><i class="fa fa-check"></i><b>11.4.2</b> Sensitivity</a></li>
<li class="chapter" data-level="11.4.3" data-path="supervised-learning.html"><a href="supervised-learning.html#specificity"><i class="fa fa-check"></i><b>11.4.3</b> Specificity</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="supervised-learning.html"><a href="supervised-learning.html#exercises-16"><i class="fa fa-check"></i><b>11.5</b> Exercises</a></li>
<li class="chapter" data-level="11.6" data-path="supervised-learning.html"><a href="supervised-learning.html#simple-linear-regression"><i class="fa fa-check"></i><b>11.6</b> Simple Linear Regression</a></li>
<li class="chapter" data-level="11.7" data-path="supervised-learning.html"><a href="supervised-learning.html#multiple-linear-regression"><i class="fa fa-check"></i><b>11.7</b> Multiple Linear Regression</a></li>
<li class="chapter" data-level="11.8" data-path="supervised-learning.html"><a href="supervised-learning.html#standard-method-for-evaluating-accuracy"><i class="fa fa-check"></i><b>11.8</b> Standard Method for Evaluating Accuracy</a></li>
<li class="chapter" data-level="11.9" data-path="supervised-learning.html"><a href="supervised-learning.html#selection-of-the-most-optimal-model"><i class="fa fa-check"></i><b>11.9</b> Selection of the Most Optimal Model</a>
<ul>
<li class="chapter" data-level="11.9.1" data-path="supervised-learning.html"><a href="supervised-learning.html#k-nearest-neighbors-model"><i class="fa fa-check"></i><b>11.9.1</b> k-Nearest Neighbors Model</a></li>
<li class="chapter" data-level="11.9.2" data-path="supervised-learning.html"><a href="supervised-learning.html#generalized-linear-model---glm"><i class="fa fa-check"></i><b>11.9.2</b> Generalized Linear Model - GLM</a></li>
<li class="chapter" data-level="11.9.3" data-path="supervised-learning.html"><a href="supervised-learning.html#random-forest-model"><i class="fa fa-check"></i><b>11.9.3</b> Random Forest Model</a></li>
<li class="chapter" data-level="11.9.4" data-path="supervised-learning.html"><a href="supervised-learning.html#support-vector-machine-model---svm"><i class="fa fa-check"></i><b>11.9.4</b> Support Vector Machine Model - SVM</a></li>
<li class="chapter" data-level="11.9.5" data-path="supervised-learning.html"><a href="supervised-learning.html#naive-bayes-model"><i class="fa fa-check"></i><b>11.9.5</b> Naive Bayes Model</a></li>
<li class="chapter" data-level="11.9.6" data-path="supervised-learning.html"><a href="supervised-learning.html#model-comparison"><i class="fa fa-check"></i><b>11.9.6</b> Model Comparison</a></li>
<li class="chapter" data-level="11.9.7" data-path="supervised-learning.html"><a href="supervised-learning.html#predicting-using-the-best-model"><i class="fa fa-check"></i><b>11.9.7</b> Predicting using the best model</a></li>
</ul></li>
<li class="chapter" data-level="11.10" data-path="supervised-learning.html"><a href="supervised-learning.html#exercises-17"><i class="fa fa-check"></i><b>11.10</b> Exercises</a></li>
<li class="chapter" data-level="11.11" data-path="supervised-learning.html"><a href="supervised-learning.html#ethics-bias-in-algorithmic-decision-making"><i class="fa fa-check"></i><b>11.11</b> Ethics: Bias in Algorithmic Decision Making</a>
<ul>
<li class="chapter" data-level="11.11.1" data-path="supervised-learning.html"><a href="supervised-learning.html#the-risk-of-proxy-variables"><i class="fa fa-check"></i><b>11.11.1</b> The Risk of Proxy Variables</a></li>
<li class="chapter" data-level="11.11.2" data-path="supervised-learning.html"><a href="supervised-learning.html#feedback-loops"><i class="fa fa-check"></i><b>11.11.2</b> Feedback Loops</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html"><i class="fa fa-check"></i><b>12</b> Unsupervised Learning</a>
<ul>
<li class="chapter" data-level="12.1" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#learning-objectives-3"><i class="fa fa-check"></i><b>12.1</b> Learning Objectives</a></li>
<li class="chapter" data-level="12.2" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#applications-of-unsupervised-learning"><i class="fa fa-check"></i><b>12.2</b> Applications of Unsupervised Learning</a></li>
<li class="chapter" data-level="12.3" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#k-means-clustering"><i class="fa fa-check"></i><b>12.3</b> K-Means Clustering</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#clustering-with-k-2"><i class="fa fa-check"></i><b>12.3.1</b> Clustering with k = 2</a></li>
<li class="chapter" data-level="12.3.2" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#clustering-with-k-3"><i class="fa fa-check"></i><b>12.3.2</b> Clustering with k &gt;= 3</a></li>
<li class="chapter" data-level="12.3.3" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#determination-of-optimal-clusters"><i class="fa fa-check"></i><b>12.3.3</b> Determination of Optimal Clusters</a></li>
<li class="chapter" data-level="12.3.4" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#k-means-for-more-than-2-variables"><i class="fa fa-check"></i><b>12.3.4</b> k-means for more than 2 variables</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#hierarchical-clustering"><i class="fa fa-check"></i><b>12.4</b> Hierarchical Clustering</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#clustering-with-two-variables"><i class="fa fa-check"></i><b>12.4.1</b> Clustering with two variables</a></li>
<li class="chapter" data-level="12.4.2" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#determination-of-optimal-clusters-1"><i class="fa fa-check"></i><b>12.4.2</b> Determination of Optimal Clusters</a></li>
<li class="chapter" data-level="12.4.3" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#obtain-the-grouping"><i class="fa fa-check"></i><b>12.4.3</b> Obtain the grouping</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#dimensionality-reduction"><i class="fa fa-check"></i><b>12.5</b> Dimensionality Reduction</a></li>
<li class="chapter" data-level="12.6" data-path="unsupervised-learning.html"><a href="unsupervised-learning.html#exercises-18"><i class="fa fa-check"></i><b>12.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="string-processing-and-text-mining.html"><a href="string-processing-and-text-mining.html"><i class="fa fa-check"></i><b>13</b> String processing and text mining</a>
<ul>
<li class="chapter" data-level="13.1" data-path="string-processing-and-text-mining.html"><a href="string-processing-and-text-mining.html#basic-functions"><i class="fa fa-check"></i><b>13.1</b> Basic functions</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="string-processing-and-text-mining.html"><a href="string-processing-and-text-mining.html#replacing-characters"><i class="fa fa-check"></i><b>13.1.1</b> Replacing characters</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="string-processing-and-text-mining.html"><a href="string-processing-and-text-mining.html#regular-expressions"><i class="fa fa-check"></i><b>13.2</b> Regular expressions</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="string-processing-and-text-mining.html"><a href="string-processing-and-text-mining.html#alternation"><i class="fa fa-check"></i><b>13.2.1</b> Alternation</a></li>
<li class="chapter" data-level="13.2.2" data-path="string-processing-and-text-mining.html"><a href="string-processing-and-text-mining.html#anchoring"><i class="fa fa-check"></i><b>13.2.2</b> Anchoring</a></li>
<li class="chapter" data-level="13.2.3" data-path="string-processing-and-text-mining.html"><a href="string-processing-and-text-mining.html#repetitions"><i class="fa fa-check"></i><b>13.2.3</b> Repetitions</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="string-processing-and-text-mining.html"><a href="string-processing-and-text-mining.html#from-strings-to-dates"><i class="fa fa-check"></i><b>13.3</b> From strings to dates</a></li>
<li class="chapter" data-level="13.4" data-path="string-processing-and-text-mining.html"><a href="string-processing-and-text-mining.html#exercises-19"><i class="fa fa-check"></i><b>13.4</b> Exercises</a></li>
<li class="chapter" data-level="13.5" data-path="string-processing-and-text-mining.html"><a href="string-processing-and-text-mining.html#text-mining-using-tidy-data"><i class="fa fa-check"></i><b>13.5</b> Text Mining using Tidy Data</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="string-processing-and-text-mining.html"><a href="string-processing-and-text-mining.html#importing-data-and-tokenization"><i class="fa fa-check"></i><b>13.5.1</b> Importing data and Tokenization</a></li>
<li class="chapter" data-level="13.5.2" data-path="string-processing-and-text-mining.html"><a href="string-processing-and-text-mining.html#text-cleaning-and-tokenization"><i class="fa fa-check"></i><b>13.5.2</b> Text cleaning and Tokenization</a></li>
<li class="chapter" data-level="13.5.3" data-path="string-processing-and-text-mining.html"><a href="string-processing-and-text-mining.html#word-cloud"><i class="fa fa-check"></i><b>13.5.3</b> Word Cloud</a></li>
<li class="chapter" data-level="13.5.4" data-path="string-processing-and-text-mining.html"><a href="string-processing-and-text-mining.html#word-frequency-plot"><i class="fa fa-check"></i><b>13.5.4</b> Word Frequency Plot</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="string-processing-and-text-mining.html"><a href="string-processing-and-text-mining.html#sentiment-analysis"><i class="fa fa-check"></i><b>13.6</b> Sentiment Analysis</a></li>
<li class="chapter" data-level="13.7" data-path="string-processing-and-text-mining.html"><a href="string-processing-and-text-mining.html#exercises-20"><i class="fa fa-check"></i><b>13.7</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>VI Generative AI</b></span></li>
<li class="chapter" data-level="14" data-path="genai-intro.html"><a href="genai-intro.html"><i class="fa fa-check"></i><b>14</b> Data Science in the Age of AI</a>
<ul>
<li class="chapter" data-level="14.1" data-path="genai-intro.html"><a href="genai-intro.html#what-is-a-large-language-model"><i class="fa fa-check"></i><b>14.1</b> What is a Large Language Model?</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="genai-intro.html"><a href="genai-intro.html#its-all-about-probability"><i class="fa fa-check"></i><b>14.1.1</b> It’s all about Probability</a></li>
<li class="chapter" data-level="14.1.2" data-path="genai-intro.html"><a href="genai-intro.html#tokens-vs.-words"><i class="fa fa-check"></i><b>14.1.2</b> Tokens vs. Words</a></li>
<li class="chapter" data-level="14.1.3" data-path="genai-intro.html"><a href="genai-intro.html#temperature-controlling-creativity"><i class="fa fa-check"></i><b>14.1.3</b> Temperature: Controlling Creativity</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="genai-intro.html"><a href="genai-intro.html#setting-up-your-ai-environment"><i class="fa fa-check"></i><b>14.2</b> Setting Up Your AI Environment</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="genai-intro.html"><a href="genai-intro.html#the-solution-local-llms"><i class="fa fa-check"></i><b>14.2.1</b> The Solution: Local LLMs</a></li>
<li class="chapter" data-level="14.2.2" data-path="genai-intro.html"><a href="genai-intro.html#the-.renviron-file"><i class="fa fa-check"></i><b>14.2.2</b> The <code>.Renviron</code> File</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="genai-intro.html"><a href="genai-intro.html#ai-as-the-pair-programmer"><i class="fa fa-check"></i><b>14.3</b> AI as the “Pair Programmer”</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="genai-intro.html"><a href="genai-intro.html#the-great-refactorer"><i class="fa fa-check"></i><b>14.3.1</b> The Great Refactorer</a></li>
<li class="chapter" data-level="14.3.2" data-path="genai-intro.html"><a href="genai-intro.html#the-translator"><i class="fa fa-check"></i><b>14.3.2</b> The Translator</a></li>
<li class="chapter" data-level="14.3.3" data-path="genai-intro.html"><a href="genai-intro.html#pro-tip-prompt-engineering-101"><i class="fa fa-check"></i><b>14.3.3</b> Pro Tip: Prompt Engineering 101</a></li>
<li class="chapter" data-level="14.3.4" data-path="genai-intro.html"><a href="genai-intro.html#the-regex-master"><i class="fa fa-check"></i><b>14.3.4</b> The Regex Master</a></li>
<li class="chapter" data-level="14.3.5" data-path="genai-intro.html"><a href="genai-intro.html#the-error-decoder"><i class="fa fa-check"></i><b>14.3.5</b> The Error Decoder</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="genai-intro.html"><a href="genai-intro.html#the-risks-hallucinations"><i class="fa fa-check"></i><b>14.4</b> The Risks: Hallucinations</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="genai-intro.html"><a href="genai-intro.html#the-package-hallucination"><i class="fa fa-check"></i><b>14.4.1</b> The “Package” Hallucination</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="genai-intro.html"><a href="genai-intro.html#building-a-robust-request"><i class="fa fa-check"></i><b>14.5</b> Building a Robust Request</a></li>
<li class="chapter" data-level="14.6" data-path="genai-intro.html"><a href="genai-intro.html#the-holy-grail-structured-data-extraction"><i class="fa fa-check"></i><b>14.6</b> The Holy Grail: Structured Data extraction</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="genai-intro.html"><a href="genai-intro.html#forcing-json-output"><i class="fa fa-check"></i><b>14.6.1</b> Forcing JSON Output</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="genai-intro.html"><a href="genai-intro.html#batch-processing-the-purrr-workflow"><i class="fa fa-check"></i><b>14.7</b> Batch Processing: The <code>purrr</code> Workflow</a></li>
<li class="chapter" data-level="14.8" data-path="genai-intro.html"><a href="genai-intro.html#summary"><i class="fa fa-check"></i><b>14.8</b> Summary</a></li>
<li class="chapter" data-level="14.9" data-path="genai-intro.html"><a href="genai-intro.html#beyond-generation-embeddings"><i class="fa fa-check"></i><b>14.9</b> Beyond Generation: Embeddings</a>
<ul>
<li class="chapter" data-level="14.9.1" data-path="genai-intro.html"><a href="genai-intro.html#r-implementation"><i class="fa fa-check"></i><b>14.9.1</b> R Implementation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="genai-embeddings.html"><a href="genai-embeddings.html"><i class="fa fa-check"></i><b>15</b> Text Analysis with Embeddings</a>
<ul>
<li class="chapter" data-level="15.1" data-path="genai-embeddings.html"><a href="genai-embeddings.html#beyond-bag-of-words"><i class="fa fa-check"></i><b>15.1</b> Beyond Bag-of-Words</a></li>
<li class="chapter" data-level="15.2" data-path="genai-embeddings.html"><a href="genai-embeddings.html#what-is-an-embedding"><i class="fa fa-check"></i><b>15.2</b> What is an Embedding?</a></li>
<li class="chapter" data-level="15.3" data-path="genai-embeddings.html"><a href="genai-embeddings.html#getting-embeddings-in-r"><i class="fa fa-check"></i><b>15.3</b> Getting Embeddings in R</a></li>
<li class="chapter" data-level="15.4" data-path="genai-embeddings.html"><a href="genai-embeddings.html#visualizing-meaning-dimensionality-reduction"><i class="fa fa-check"></i><b>15.4</b> Visualizing Meaning (Dimensionality Reduction)</a></li>
<li class="chapter" data-level="15.5" data-path="genai-embeddings.html"><a href="genai-embeddings.html#building-a-semantic-search-engine"><i class="fa fa-check"></i><b>15.5</b> Building a Semantic Search Engine</a></li>
<li class="chapter" data-level="15.6" data-path="genai-embeddings.html"><a href="genai-embeddings.html#summary-the-ai-workflow"><i class="fa fa-check"></i><b>15.6</b> Summary: The AI Workflow</a></li>
</ul></li>
<li class="part"><span><b>VII Real Cases</b></span></li>
<li class="chapter" data-level="" data-path="introduction-3.html"><a href="introduction-3.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="16" data-path="case-study-real-estate-market-analysis.html"><a href="case-study-real-estate-market-analysis.html"><i class="fa fa-check"></i><b>16</b> Case Study: Real Estate Market Analysis</a>
<ul>
<li class="chapter" data-level="16.1" data-path="case-study-real-estate-market-analysis.html"><a href="case-study-real-estate-market-analysis.html#objectives"><i class="fa fa-check"></i><b>16.1</b> Objectives</a></li>
<li class="chapter" data-level="16.2" data-path="case-study-real-estate-market-analysis.html"><a href="case-study-real-estate-market-analysis.html#loading-libraries"><i class="fa fa-check"></i><b>16.2</b> Loading Libraries</a></li>
<li class="chapter" data-level="16.3" data-path="case-study-real-estate-market-analysis.html"><a href="case-study-real-estate-market-analysis.html#exploring-the-data"><i class="fa fa-check"></i><b>16.3</b> Exploring the Data</a></li>
<li class="chapter" data-level="16.4" data-path="case-study-real-estate-market-analysis.html"><a href="case-study-real-estate-market-analysis.html#data-cleaning"><i class="fa fa-check"></i><b>16.4</b> Data Cleaning</a></li>
<li class="chapter" data-level="16.5" data-path="case-study-real-estate-market-analysis.html"><a href="case-study-real-estate-market-analysis.html#exploratory-analysis"><i class="fa fa-check"></i><b>16.5</b> Exploratory Analysis</a>
<ul>
<li class="chapter" data-level="16.5.1" data-path="case-study-real-estate-market-analysis.html"><a href="case-study-real-estate-market-analysis.html#market-volume-over-time"><i class="fa fa-check"></i><b>16.5.1</b> Market Volume Over Time</a></li>
<li class="chapter" data-level="16.5.2" data-path="case-study-real-estate-market-analysis.html"><a href="case-study-real-estate-market-analysis.html#comparing-cities"><i class="fa fa-check"></i><b>16.5.2</b> Comparing Cities</a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="case-study-real-estate-market-analysis.html"><a href="case-study-real-estate-market-analysis.html#creating-indicators"><i class="fa fa-check"></i><b>16.6</b> Creating Indicators</a></li>
<li class="chapter" data-level="16.7" data-path="case-study-real-estate-market-analysis.html"><a href="case-study-real-estate-market-analysis.html#try-it-yourself"><i class="fa fa-check"></i><b>16.7</b> Try It Yourself</a></li>
<li class="chapter" data-level="16.8" data-path="case-study-real-estate-market-analysis.html"><a href="case-study-real-estate-market-analysis.html#conclusions"><i class="fa fa-check"></i><b>16.8</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="google-analytics-from-r.html"><a href="google-analytics-from-r.html"><i class="fa fa-check"></i><b>17</b> Google Analytics from R</a>
<ul>
<li class="chapter" data-level="17.1" data-path="google-analytics-from-r.html"><a href="google-analytics-from-r.html#problem"><i class="fa fa-check"></i><b>17.1</b> Problem</a></li>
<li class="chapter" data-level="17.2" data-path="google-analytics-from-r.html"><a href="google-analytics-from-r.html#access-to-data"><i class="fa fa-check"></i><b>17.2</b> Access to data</a></li>
<li class="chapter" data-level="17.3" data-path="google-analytics-from-r.html"><a href="google-analytics-from-r.html#visualization"><i class="fa fa-check"></i><b>17.3</b> Visualization</a></li>
<li class="chapter" data-level="17.4" data-path="google-analytics-from-r.html"><a href="google-analytics-from-r.html#conclusion"><i class="fa fa-check"></i><b>17.4</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="ethics-checklist.html"><a href="ethics-checklist.html"><i class="fa fa-check"></i><b>18</b> Appendix A: Responsible AI Checklist</a>
<ul>
<li class="chapter" data-level="18.1" data-path="ethics-checklist.html"><a href="ethics-checklist.html#data-quality-lineage"><i class="fa fa-check"></i><b>18.1</b> Data Quality &amp; Lineage</a></li>
<li class="chapter" data-level="18.2" data-path="ethics-checklist.html"><a href="ethics-checklist.html#fairness-bias"><i class="fa fa-check"></i><b>18.2</b> Fairness &amp; Bias</a></li>
<li class="chapter" data-level="18.3" data-path="ethics-checklist.html"><a href="ethics-checklist.html#transparency-explainability"><i class="fa fa-check"></i><b>18.3</b> Transparency &amp; Explainability</a></li>
<li class="chapter" data-level="18.4" data-path="ethics-checklist.html"><a href="ethics-checklist.html#reproducibility-integrity"><i class="fa fa-check"></i><b>18.4</b> Reproducibility &amp; Integrity</a></li>
<li class="chapter" data-level="18.5" data-path="ethics-checklist.html"><a href="ethics-checklist.html#genai-specifics"><i class="fa fa-check"></i><b>18.5</b> GenAI Specifics</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="r6-intro.html"><a href="r6-intro.html"><i class="fa fa-check"></i><b>19</b> Appendix B: Object Oriented Programming with R6</a>
<ul>
<li class="chapter" data-level="19.1" data-path="r6-intro.html"><a href="r6-intro.html#the-r6-package-classes-methods-encapsulation-and-inheritance"><i class="fa fa-check"></i><b>19.1</b> The R6 package: Classes, methods, encapsulation, and inheritance</a></li>
<li class="chapter" data-level="19.2" data-path="r6-intro.html"><a href="r6-intro.html#exercises-21"><i class="fa fa-check"></i><b>19.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="string-processing-and-text-mining" class="section level1 hasAnchor" number="13">
<h1><span class="header-section-number">Chapter 13</span> String processing and text mining<a href="string-processing-and-text-mining.html#string-processing-and-text-mining" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="basic-functions" class="section level2 hasAnchor" number="13.1">
<h2><span class="header-section-number">13.1</span> Basic functions<a href="string-processing-and-text-mining.html#basic-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We have already learned how to import data and consolidate it. However, we cannot yet work with this data. We have to validate through string processing and ensure a minimum quality to be able to perform our analyses.</p>
<p>For example, in the previous chapter we imported data from Wikipedia, however we did not focus on whether we could already perform operations or visualizations with our data.</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb539-1"><a href="string-processing-and-text-mining.html#cb539-1" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb539-2"><a href="string-processing-and-text-mining.html#cb539-2" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://es.wikipedia.org/wiki/Anexo:Pa%C3%ADses_hispanos_por_poblaci%C3%B3n&quot;</span></span>
<span id="cb539-3"><a href="string-processing-and-text-mining.html#cb539-3" tabindex="-1"></a><span class="co">#url &lt;- &quot;https://es.wikipedia.org/wiki/Distribuci%C3%B3n_geogr%C3%A1fica_del_idioma_espa%C3%B1ol&quot; #as a back up URL</span></span>
<span id="cb539-4"><a href="string-processing-and-text-mining.html#cb539-4" tabindex="-1"></a>html_data <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url)</span>
<span id="cb539-5"><a href="string-processing-and-text-mining.html#cb539-5" tabindex="-1"></a></span>
<span id="cb539-6"><a href="string-processing-and-text-mining.html#cb539-6" tabindex="-1"></a>web_tables <span class="ot">&lt;-</span> html_data <span class="sc">|&gt;</span></span>
<span id="cb539-7"><a href="string-processing-and-text-mining.html#cb539-7" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;body&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb539-8"><a href="string-processing-and-text-mining.html#cb539-8" tabindex="-1"></a>  <span class="fu">html_nodes</span>(<span class="st">&quot;table&quot;</span>)</span>
<span id="cb539-9"><a href="string-processing-and-text-mining.html#cb539-9" tabindex="-1"></a></span>
<span id="cb539-10"><a href="string-processing-and-text-mining.html#cb539-10" tabindex="-1"></a>raw_table <span class="ot">&lt;-</span> web_tables[[<span class="dv">2</span>]] <span class="sc">|&gt;</span></span>
<span id="cb539-11"><a href="string-processing-and-text-mining.html#cb539-11" tabindex="-1"></a>  <span class="fu">html_table</span>()</span>
<span id="cb539-12"><a href="string-processing-and-text-mining.html#cb539-12" tabindex="-1"></a></span>
<span id="cb539-13"><a href="string-processing-and-text-mining.html#cb539-13" tabindex="-1"></a>raw_table <span class="ot">&lt;-</span> raw_table <span class="sc">|&gt;</span> </span>
<span id="cb539-14"><a href="string-processing-and-text-mining.html#cb539-14" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;country&quot;</span>, <span class="st">&quot;population&quot;</span>, <span class="st">&quot;prop_population&quot;</span>, <span class="st">&quot;avg_change&quot;</span>, <span class="st">&quot;link&quot;</span>)) </span>
<span id="cb539-15"><a href="string-processing-and-text-mining.html#cb539-15" tabindex="-1"></a></span>
<span id="cb539-16"><a href="string-processing-and-text-mining.html#cb539-16" tabindex="-1"></a>raw_table <span class="ot">&lt;-</span> raw_table <span class="sc">|&gt;</span></span>
<span id="cb539-17"><a href="string-processing-and-text-mining.html#cb539-17" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb539-18"><a href="string-processing-and-text-mining.html#cb539-18" tabindex="-1"></a></span>
<span id="cb539-19"><a href="string-processing-and-text-mining.html#cb539-19" tabindex="-1"></a>raw_table <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">5</span>)</span></code></pre></div>
<p>We may not have noticed, but we can observe columns with spaces or commas where there should be numbers. We can validate this not only by analyzing the class of the column, but also if we try to calculate the average of that variable.</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="string-processing-and-text-mining.html#cb540-1" tabindex="-1"></a><span class="fu">class</span>(raw_table<span class="sc">$</span>population)</span>
<span id="cb540-2"><a href="string-processing-and-text-mining.html#cb540-2" tabindex="-1"></a></span>
<span id="cb540-3"><a href="string-processing-and-text-mining.html#cb540-3" tabindex="-1"></a><span class="fu">mean</span>(raw_table<span class="sc">$</span>population)</span></code></pre></div>
<p>We cannot do a direct conversion to number either because white spaces and commas are characters.</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="string-processing-and-text-mining.html#cb541-1" tabindex="-1"></a><span class="fu">as.numeric</span>(raw_table<span class="sc">$</span>population)</span></code></pre></div>
<p>There are so frequent and so many possible use cases that there are already multiple functions for processing strings included in the tidyverse library. Likewise, there is more than one way to process strings. It will always depend on how the raw data is found.</p>
<div id="replacing-characters" class="section level3 hasAnchor" number="13.1.1">
<h3><span class="header-section-number">13.1.1</span> Replacing characters<a href="string-processing-and-text-mining.html#replacing-characters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One of the basic functions that we will use the most will be replacing characters. We apply this function when we are sure that this change will not compromise the rest of the data. We have spaces and we have commas. So we could start by replacing one of the two to normalize them using the <code>str_replace_all(string, pattern, replacement)</code> function. In the pattern attribute we will use <code>\\s</code>, which comes from <code>space</code>. We are going to learn first to modify the data stored in a vector and then we will replicate it to our entire table.</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="string-processing-and-text-mining.html#cb542-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb542-2"><a href="string-processing-and-text-mining.html#cb542-2" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb542-3"><a href="string-processing-and-text-mining.html#cb542-3" tabindex="-1"></a></span>
<span id="cb542-4"><a href="string-processing-and-text-mining.html#cb542-4" tabindex="-1"></a>population_vector <span class="ot">&lt;-</span> raw_table<span class="sc">$</span>population</span>
<span id="cb542-5"><a href="string-processing-and-text-mining.html#cb542-5" tabindex="-1"></a></span>
<span id="cb542-6"><a href="string-processing-and-text-mining.html#cb542-6" tabindex="-1"></a>population_vector <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(population_vector, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">s&quot;</span>, <span class="st">&quot;,&quot;</span>)</span>
<span id="cb542-7"><a href="string-processing-and-text-mining.html#cb542-7" tabindex="-1"></a></span>
<span id="cb542-8"><a href="string-processing-and-text-mining.html#cb542-8" tabindex="-1"></a>population_vector</span></code></pre></div>
<p>We have purposely taken all the values to be separated by commas because now we can easily use the <code>parse_number(vector)</code> function which not only replaces the commas with empty strings, but also removes any non-numeric value before the first number, which facilitates us if we had monetary values, and also converts the value from character type to numeric type.</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="string-processing-and-text-mining.html#cb543-1" tabindex="-1"></a>population_vector <span class="ot">&lt;-</span> <span class="fu">parse_number</span>(population_vector)</span>
<span id="cb543-2"><a href="string-processing-and-text-mining.html#cb543-2" tabindex="-1"></a></span>
<span id="cb543-3"><a href="string-processing-and-text-mining.html#cb543-3" tabindex="-1"></a><span class="co"># Additional example in case we had a monetary value:</span></span>
<span id="cb543-4"><a href="string-processing-and-text-mining.html#cb543-4" tabindex="-1"></a><span class="fu">parse_number</span>(<span class="st">&quot;$345,153&quot;</span>)</span></code></pre></div>
<p>This vector now allows us to perform mathematical operations or visualization of the distribution.</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="string-processing-and-text-mining.html#cb544-1" tabindex="-1"></a><span class="co"># Convert to millions</span></span>
<span id="cb544-2"><a href="string-processing-and-text-mining.html#cb544-2" tabindex="-1"></a>population_vector <span class="ot">&lt;-</span> population_vector<span class="sc">/</span><span class="dv">10</span><span class="sc">^</span><span class="dv">6</span></span>
<span id="cb544-3"><a href="string-processing-and-text-mining.html#cb544-3" tabindex="-1"></a></span>
<span id="cb544-4"><a href="string-processing-and-text-mining.html#cb544-4" tabindex="-1"></a><span class="co"># We remove the last value which is the world population:</span></span>
<span id="cb544-5"><a href="string-processing-and-text-mining.html#cb544-5" tabindex="-1"></a>length_val <span class="ot">&lt;-</span> <span class="fu">length</span>(population_vector)</span>
<span id="cb544-6"><a href="string-processing-and-text-mining.html#cb544-6" tabindex="-1"></a>population_vector <span class="ot">&lt;-</span> population_vector[<span class="sc">-</span>length_val]</span>
<span id="cb544-7"><a href="string-processing-and-text-mining.html#cb544-7" tabindex="-1"></a></span>
<span id="cb544-8"><a href="string-processing-and-text-mining.html#cb544-8" tabindex="-1"></a><span class="co"># Visualization</span></span>
<span id="cb544-9"><a href="string-processing-and-text-mining.html#cb544-9" tabindex="-1"></a><span class="fu">boxplot</span>(population_vector)</span></code></pre></div>
<p>We already know which functions to use to transform the fields of our case. However, we have applied them to vectors. To mutate the columns of our table in raw form we will use the function <code>mutate(across(columns, function))</code> using the pipeline operator <code>|&gt;</code>. Let’s apply the first change of spaces by commas and not only to column 3, population, but also to column 5, average change.</p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb545-1"><a href="string-processing-and-text-mining.html#cb545-1" tabindex="-1"></a>raw_table <span class="sc">|&gt;</span> </span>
<span id="cb545-2"><a href="string-processing-and-text-mining.html#cb545-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="sc">~</span><span class="fu">str_replace_all</span>(., <span class="st">&quot;</span><span class="sc">\\</span><span class="st">s&quot;</span>, <span class="st">&quot;,&quot;</span>)))</span></code></pre></div>
<p>We have removed from the <code>str_replace_all</code> function the <code>string</code> attribute and replaced it with a dot <code>.</code>. And that dot <code>.</code> indicates that it will evaluate for each column <code>c(3,5)</code> of our table.</p>
<p>Now, let’s apply the parse_number function that we applied previously.</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="string-processing-and-text-mining.html#cb546-1" tabindex="-1"></a>raw_table <span class="sc">|&gt;</span> </span>
<span id="cb546-2"><a href="string-processing-and-text-mining.html#cb546-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="sc">~</span><span class="fu">str_replace_all</span>(., <span class="st">&quot;</span><span class="sc">\\</span><span class="st">s&quot;</span>, <span class="st">&quot;,&quot;</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb546-3"><a href="string-processing-and-text-mining.html#cb546-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>), <span class="sc">~</span><span class="fu">parse_number</span>(.)))</span></code></pre></div>
</div>
</div>
<div id="regular-expressions" class="section level2 hasAnchor" number="13.2">
<h2><span class="header-section-number">13.2</span> Regular expressions<a href="string-processing-and-text-mining.html#regular-expressions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A <a href="https://stringr.tidyverse.org/articles/regular-expressions.html">regular expression</a><a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a> (or regex as it is known in English) is a pattern that describes a set of strings. We have already used regex in the previous section using only the pattern <code>\\s</code>. However, usually we will have many more use cases that will require a pattern that can convert a wider range of cases.</p>
<p>Although we could analyze all possible use cases available in the documentation, we learn faster by use cases. Let’s analyze a case that will allow us to learn some patterns little by little.</p>
<p>In the <code>dslabs</code> library we found and used previously the height data, <code>heights</code>, of students from a university expressed in inches.</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="string-processing-and-text-mining.html#cb547-1" tabindex="-1"></a><span class="fu">library</span>(dslabs)</span>
<span id="cb547-2"><a href="string-processing-and-text-mining.html#cb547-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb547-3"><a href="string-processing-and-text-mining.html#cb547-3" tabindex="-1"></a><span class="fu">data</span>(heights)</span>
<span id="cb547-4"><a href="string-processing-and-text-mining.html#cb547-4" tabindex="-1"></a></span>
<span id="cb547-5"><a href="string-processing-and-text-mining.html#cb547-5" tabindex="-1"></a>heights <span class="sc">|&gt;</span> </span>
<span id="cb547-6"><a href="string-processing-and-text-mining.html#cb547-6" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb547-7"><a href="string-processing-and-text-mining.html#cb547-7" tabindex="-1"></a><span class="co">#&gt;       sex height</span></span>
<span id="cb547-8"><a href="string-processing-and-text-mining.html#cb547-8" tabindex="-1"></a><span class="co">#&gt; 1    Male     75</span></span>
<span id="cb547-9"><a href="string-processing-and-text-mining.html#cb547-9" tabindex="-1"></a><span class="co">#&gt; 2    Male     70</span></span>
<span id="cb547-10"><a href="string-processing-and-text-mining.html#cb547-10" tabindex="-1"></a><span class="co">#&gt; 3    Male     68</span></span>
<span id="cb547-11"><a href="string-processing-and-text-mining.html#cb547-11" tabindex="-1"></a><span class="co">#&gt; 4    Male     74</span></span>
<span id="cb547-12"><a href="string-processing-and-text-mining.html#cb547-12" tabindex="-1"></a><span class="co">#&gt; 5    Male     61</span></span>
<span id="cb547-13"><a href="string-processing-and-text-mining.html#cb547-13" tabindex="-1"></a><span class="co">#&gt; 6  Female     65</span></span>
<span id="cb547-14"><a href="string-processing-and-text-mining.html#cb547-14" tabindex="-1"></a><span class="co">#&gt; 7  Female     66</span></span>
<span id="cb547-15"><a href="string-processing-and-text-mining.html#cb547-15" tabindex="-1"></a><span class="co">#&gt; 8  Female     62</span></span>
<span id="cb547-16"><a href="string-processing-and-text-mining.html#cb547-16" tabindex="-1"></a><span class="co">#&gt; 9  Female     66</span></span>
<span id="cb547-17"><a href="string-processing-and-text-mining.html#cb547-17" tabindex="-1"></a><span class="co">#&gt; 10   Male     67</span></span></code></pre></div>
<p>These data were ready to be analyzed. However, that was not how it came from the source. The students had to fill out a survey and even when they were asked for their height in inches, they completed their height in inches, feet, centimeters, writing numbers, letters, etc. We can see the initial data from the form in the <code>reported_heights</code> data frame.</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="string-processing-and-text-mining.html#cb548-1" tabindex="-1"></a>reported_heights <span class="sc">|&gt;</span> </span>
<span id="cb548-2"><a href="string-processing-and-text-mining.html#cb548-2" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb548-3"><a href="string-processing-and-text-mining.html#cb548-3" tabindex="-1"></a><span class="co">#&gt;             time_stamp    sex height</span></span>
<span id="cb548-4"><a href="string-processing-and-text-mining.html#cb548-4" tabindex="-1"></a><span class="co">#&gt; 1  2014-09-02 13:40:36   Male     75</span></span>
<span id="cb548-5"><a href="string-processing-and-text-mining.html#cb548-5" tabindex="-1"></a><span class="co">#&gt; 2  2014-09-02 13:46:59   Male     70</span></span>
<span id="cb548-6"><a href="string-processing-and-text-mining.html#cb548-6" tabindex="-1"></a><span class="co">#&gt; 3  2014-09-02 13:59:20   Male     68</span></span>
<span id="cb548-7"><a href="string-processing-and-text-mining.html#cb548-7" tabindex="-1"></a><span class="co">#&gt; 4  2014-09-02 14:51:53   Male     74</span></span>
<span id="cb548-8"><a href="string-processing-and-text-mining.html#cb548-8" tabindex="-1"></a><span class="co">#&gt; 5  2014-09-02 15:16:15   Male     61</span></span>
<span id="cb548-9"><a href="string-processing-and-text-mining.html#cb548-9" tabindex="-1"></a><span class="co">#&gt; 6  2014-09-02 15:16:16 Female     65</span></span>
<span id="cb548-10"><a href="string-processing-and-text-mining.html#cb548-10" tabindex="-1"></a><span class="co">#&gt; 7  2014-09-02 15:16:19 Female     66</span></span>
<span id="cb548-11"><a href="string-processing-and-text-mining.html#cb548-11" tabindex="-1"></a><span class="co">#&gt; 8  2014-09-02 15:16:21 Female     62</span></span>
<span id="cb548-12"><a href="string-processing-and-text-mining.html#cb548-12" tabindex="-1"></a><span class="co">#&gt; 9  2014-09-02 15:16:21 Female     66</span></span>
<span id="cb548-13"><a href="string-processing-and-text-mining.html#cb548-13" tabindex="-1"></a><span class="co">#&gt; 10 2014-09-02 15:16:22   Male     67</span></span></code></pre></div>
<p>Although we might think that they entered the data correctly, we do not have to trust and it is always better to validate the quality of our data. There are multiple ways to validate, as we can see below:</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="string-processing-and-text-mining.html#cb549-1" tabindex="-1"></a>heights <span class="ot">&lt;-</span> reported_heights<span class="sc">$</span>height</span>
<span id="cb549-2"><a href="string-processing-and-text-mining.html#cb549-2" tabindex="-1"></a></span>
<span id="cb549-3"><a href="string-processing-and-text-mining.html#cb549-3" tabindex="-1"></a><span class="co"># Validation option 1: Random sample</span></span>
<span id="cb549-4"><a href="string-processing-and-text-mining.html#cb549-4" tabindex="-1"></a><span class="fu">sample</span>(heights, <span class="dv">100</span>)</span>
<span id="cb549-5"><a href="string-processing-and-text-mining.html#cb549-5" tabindex="-1"></a><span class="co">#&gt;   [1] &quot;71&quot;       &quot;67&quot;       &quot;66&quot;       &quot;64&quot;       &quot;70&quot;       &quot;70&quot;      </span></span>
<span id="cb549-6"><a href="string-processing-and-text-mining.html#cb549-6" tabindex="-1"></a><span class="co">#&gt;   [7] &quot;76&quot;       &quot;1&quot;        &quot;59&quot;       &quot;67.2&quot;     &quot;69&quot;       &quot;67&quot;      </span></span>
<span id="cb549-7"><a href="string-processing-and-text-mining.html#cb549-7" tabindex="-1"></a><span class="co">#&gt;  [13] &quot;67&quot;       &quot;6&quot;        &quot;62&quot;       &quot;69&quot;       &quot;74&quot;       &quot;69&quot;      </span></span>
<span id="cb549-8"><a href="string-processing-and-text-mining.html#cb549-8" tabindex="-1"></a><span class="co">#&gt;  [19] &quot;178&quot;      &quot;69&quot;       &quot;74&quot;       &quot;169&quot;      &quot;67&quot;       &quot;68.5&quot;    </span></span>
<span id="cb549-9"><a href="string-processing-and-text-mining.html#cb549-9" tabindex="-1"></a><span class="co">#&gt;  [25] &quot;68.5&quot;     &quot;71&quot;       &quot;68&quot;       &quot;158&quot;      &quot;6.1&quot;      &quot;708,661&quot; </span></span>
<span id="cb549-10"><a href="string-processing-and-text-mining.html#cb549-10" tabindex="-1"></a><span class="co">#&gt;  [31] &quot;6.2&quot;      &quot;69&quot;       &quot;75&quot;       &quot;5&#39;6&quot;      &quot;67&quot;       &quot;68.4&quot;    </span></span>
<span id="cb549-11"><a href="string-processing-and-text-mining.html#cb549-11" tabindex="-1"></a><span class="co">#&gt;  [37] &quot;75&quot;       &quot;5.7&quot;      &quot;72&quot;       &quot;77&quot;       &quot;75&quot;       &quot;68&quot;      </span></span>
<span id="cb549-12"><a href="string-processing-and-text-mining.html#cb549-12" tabindex="-1"></a><span class="co">#&gt;  [43] &quot;69&quot;       &quot;72&quot;       &quot;62&quot;       &quot;65&quot;       &quot;73&quot;       &quot;67&quot;      </span></span>
<span id="cb549-13"><a href="string-processing-and-text-mining.html#cb549-13" tabindex="-1"></a><span class="co">#&gt;  [49] &quot;67&quot;       &quot;5.2&quot;      &quot;67.71&quot;    &quot;67&quot;       &quot;5&#39;3&quot;      &quot;66&quot;      </span></span>
<span id="cb549-14"><a href="string-processing-and-text-mining.html#cb549-14" tabindex="-1"></a><span class="co">#&gt;  [55] &quot;5&#39;7.5&#39;&#39;&quot;  &quot;69&quot;       &quot;65&quot;       &quot;150&quot;      &quot;69&quot;       &quot;5&#39;11&#39;&#39;&quot;  </span></span>
<span id="cb549-15"><a href="string-processing-and-text-mining.html#cb549-15" tabindex="-1"></a><span class="co">#&gt;  [61] &quot;68.11024&quot; &quot;175&quot;      &quot;152&quot;      &quot;5&#39; 10&quot;    &quot;65&quot;       &quot;74.5&quot;    </span></span>
<span id="cb549-16"><a href="string-processing-and-text-mining.html#cb549-16" tabindex="-1"></a><span class="co">#&gt;  [67] &quot;70&quot;       &quot;72&quot;       &quot;73.22&quot;    &quot;63&quot;       &quot;5&#39;9&#39;&#39;&quot;    &quot;68.5&quot;    </span></span>
<span id="cb549-17"><a href="string-processing-and-text-mining.html#cb549-17" tabindex="-1"></a><span class="co">#&gt;  [73] &quot;74&quot;       &quot;74&quot;       &quot;5&#39;7\&quot;&quot;    &quot;6&#39;3\&quot;&quot;    &quot;67&quot;       &quot;73.22&quot;   </span></span>
<span id="cb549-18"><a href="string-processing-and-text-mining.html#cb549-18" tabindex="-1"></a><span class="co">#&gt;  [79] &quot;74&quot;       &quot;72.8346&quot;  &quot;67.72&quot;    &quot;175&quot;      &quot;5.69&quot;     &quot;69.3&quot;    </span></span>
<span id="cb549-19"><a href="string-processing-and-text-mining.html#cb549-19" tabindex="-1"></a><span class="co">#&gt;  [85] &quot;5&#39;10&#39;&#39;&quot;   &quot;72&quot;       &quot;60&quot;       &quot;68&quot;       &quot;69&quot;       &quot;73&quot;      </span></span>
<span id="cb549-20"><a href="string-processing-and-text-mining.html#cb549-20" tabindex="-1"></a><span class="co">#&gt;  [91] &quot;75&quot;       &quot;70&quot;       &quot;64&quot;       &quot;170&quot;      &quot;649,606&quot;  &quot;73&quot;      </span></span>
<span id="cb549-21"><a href="string-processing-and-text-mining.html#cb549-21" tabindex="-1"></a><span class="co">#&gt;  [97] &quot;58&quot;       &quot;60&quot;       &quot;174&quot;      &quot;64.173&quot;</span></span>
<span id="cb549-22"><a href="string-processing-and-text-mining.html#cb549-22" tabindex="-1"></a></span>
<span id="cb549-23"><a href="string-processing-and-text-mining.html#cb549-23" tabindex="-1"></a><span class="co"># Validation option 2: convert to numbers and count if there are NAs</span></span>
<span id="cb549-24"><a href="string-processing-and-text-mining.html#cb549-24" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(heights)</span>
<span id="cb549-25"><a href="string-processing-and-text-mining.html#cb549-25" tabindex="-1"></a><span class="co">#&gt; Warning: NAs introduced by coercion</span></span>
<span id="cb549-26"><a href="string-processing-and-text-mining.html#cb549-26" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(x))</span>
<span id="cb549-27"><a href="string-processing-and-text-mining.html#cb549-27" tabindex="-1"></a><span class="co">#&gt; [1] 81</span></span>
<span id="cb549-28"><a href="string-processing-and-text-mining.html#cb549-28" tabindex="-1"></a></span>
<span id="cb549-29"><a href="string-processing-and-text-mining.html#cb549-29" tabindex="-1"></a><span class="co"># Validation option 3: add column of those that cannot be converted to number:</span></span>
<span id="cb549-30"><a href="string-processing-and-text-mining.html#cb549-30" tabindex="-1"></a>reported_heights <span class="sc">|&gt;</span> </span>
<span id="cb549-31"><a href="string-processing-and-text-mining.html#cb549-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">numeric_height =</span> <span class="fu">as.numeric</span>(height)) <span class="sc">|&gt;</span> </span>
<span id="cb549-32"><a href="string-processing-and-text-mining.html#cb549-32" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(numeric_height)) <span class="sc">|&gt;</span> </span>
<span id="cb549-33"><a href="string-processing-and-text-mining.html#cb549-33" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb549-34"><a href="string-processing-and-text-mining.html#cb549-34" tabindex="-1"></a><span class="co">#&gt; Warning: There was 1 warning in `mutate()`.</span></span>
<span id="cb549-35"><a href="string-processing-and-text-mining.html#cb549-35" tabindex="-1"></a><span class="co">#&gt; ℹ In argument: `numeric_height = as.numeric(height)`.</span></span>
<span id="cb549-36"><a href="string-processing-and-text-mining.html#cb549-36" tabindex="-1"></a><span class="co">#&gt; Caused by warning:</span></span>
<span id="cb549-37"><a href="string-processing-and-text-mining.html#cb549-37" tabindex="-1"></a><span class="co">#&gt; ! NAs introduced by coercion</span></span>
<span id="cb549-38"><a href="string-processing-and-text-mining.html#cb549-38" tabindex="-1"></a><span class="co">#&gt;             time_stamp    sex                 height numeric_height</span></span>
<span id="cb549-39"><a href="string-processing-and-text-mining.html#cb549-39" tabindex="-1"></a><span class="co">#&gt; 1  2014-09-02 15:16:28   Male                  5&#39; 4&quot;             NA</span></span>
<span id="cb549-40"><a href="string-processing-and-text-mining.html#cb549-40" tabindex="-1"></a><span class="co">#&gt; 2  2014-09-02 15:16:37 Female                  165cm             NA</span></span>
<span id="cb549-41"><a href="string-processing-and-text-mining.html#cb549-41" tabindex="-1"></a><span class="co">#&gt; 3  2014-09-02 15:16:52   Male                    5&#39;7             NA</span></span>
<span id="cb549-42"><a href="string-processing-and-text-mining.html#cb549-42" tabindex="-1"></a><span class="co">#&gt; 4  2014-09-02 15:16:56   Male                  &gt;9000             NA</span></span>
<span id="cb549-43"><a href="string-processing-and-text-mining.html#cb549-43" tabindex="-1"></a><span class="co">#&gt; 5  2014-09-02 15:16:56   Male                   5&#39;7&quot;             NA</span></span>
<span id="cb549-44"><a href="string-processing-and-text-mining.html#cb549-44" tabindex="-1"></a><span class="co">#&gt; 6  2014-09-02 15:17:09 Female                   5&#39;3&quot;             NA</span></span>
<span id="cb549-45"><a href="string-processing-and-text-mining.html#cb549-45" tabindex="-1"></a><span class="co">#&gt; 7  2014-09-02 15:18:00   Male 5 feet and 8.11 inches             NA</span></span>
<span id="cb549-46"><a href="string-processing-and-text-mining.html#cb549-46" tabindex="-1"></a><span class="co">#&gt; 8  2014-09-02 15:19:48   Male                   5&#39;11             NA</span></span>
<span id="cb549-47"><a href="string-processing-and-text-mining.html#cb549-47" tabindex="-1"></a><span class="co">#&gt; 9  2014-09-04 00:46:45   Male                  5&#39;9&#39;&#39;             NA</span></span>
<span id="cb549-48"><a href="string-processing-and-text-mining.html#cb549-48" tabindex="-1"></a><span class="co">#&gt; 10 2014-09-04 10:29:44   Male                 5&#39;10&#39;&#39;             NA</span></span></code></pre></div>
<p>We might want to choose to eliminate these NA data as they are not significant with respect to the total of 1,095 data points. However, there are several of these data points that follow a determined pattern and instead of being discarded could be converted to the scale we have in the rest of the data. For example, there are people who entered their height as 5’7”, which, for those who remember the conversion, can be converted because 1 foot is 12 inches. So <span class="math inline">\(5*12+7=67\)</span>. And so, like that case, we can detect patterns, but we have, again, to be careful in detecting the exact pattern and not a very generic one that can change other use cases. If everyone followed the same pattern <span class="math inline">\(x&#39;y&#39;&#39;\)</span> or <span class="math inline">\(x&#39;y\)</span> it would be much easier to convert it to inches by calculating <span class="math inline">\(x*12+y\)</span>.</p>
<p>Let’s start by extracting our column to a single character vector with all the values that do not convert automatically to number or were entered in inches. We detect this if they measure more than 5 and up to 7 feet (from 1.5m to 2.1 meters). After that we will create the transformations little by little.</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="string-processing-and-text-mining.html#cb550-1" tabindex="-1"></a>problematic_heights <span class="ot">&lt;-</span> reported_heights <span class="sc">|&gt;</span> </span>
<span id="cb550-2"><a href="string-processing-and-text-mining.html#cb550-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(<span class="fu">as.numeric</span>(height)) <span class="sc">|</span> <span class="co"># Does not convert to number</span></span>
<span id="cb550-3"><a href="string-processing-and-text-mining.html#cb550-3" tabindex="-1"></a>         (<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">as.numeric</span>(height)) <span class="sc">&amp;</span> <span class="fu">as.numeric</span>(height) <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">&amp;</span></span>
<span id="cb550-4"><a href="string-processing-and-text-mining.html#cb550-4" tabindex="-1"></a>            <span class="fu">as.numeric</span>(height) <span class="sc">&lt;=</span> <span class="dv">7</span> ) <span class="co"># or entered in feet and not inches</span></span>
<span id="cb550-5"><a href="string-processing-and-text-mining.html#cb550-5" tabindex="-1"></a>        ) <span class="sc">|&gt;</span> </span>
<span id="cb550-6"><a href="string-processing-and-text-mining.html#cb550-6" tabindex="-1"></a>  <span class="fu">pull</span>(height)</span>
<span id="cb550-7"><a href="string-processing-and-text-mining.html#cb550-7" tabindex="-1"></a></span>
<span id="cb550-8"><a href="string-processing-and-text-mining.html#cb550-8" tabindex="-1"></a><span class="fu">length</span>(problematic_heights)</span>
<span id="cb550-9"><a href="string-processing-and-text-mining.html#cb550-9" tabindex="-1"></a><span class="co">#&gt; [1] 168</span></span></code></pre></div>
<p>Adding the condition of having entered in feet we have 168 errors. We cannot ignore 15.3% of errors.</p>
<p>We will use <code>str_view()</code> to visualize matches. This function is extremely helpful when debugging regular expressions as it highlights exactly what is matching your pattern.</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="string-processing-and-text-mining.html#cb551-1" tabindex="-1"></a><span class="co"># Let&#39;s visualize entries containing &quot;feet&quot;</span></span>
<span id="cb551-2"><a href="string-processing-and-text-mining.html#cb551-2" tabindex="-1"></a><span class="fu">str_view</span>(problematic_heights, <span class="st">&quot;feet&quot;</span>, <span class="at">match=</span><span class="cn">TRUE</span>)</span>
<span id="cb551-3"><a href="string-processing-and-text-mining.html#cb551-3" tabindex="-1"></a><span class="co">#&gt;  [10] │ 5 &lt;feet&gt; and 8.11 inches</span></span>
<span id="cb551-4"><a href="string-processing-and-text-mining.html#cb551-4" tabindex="-1"></a><span class="co">#&gt;  [82] │ 5 &lt;feet&gt; 7inches</span></span>
<span id="cb551-5"><a href="string-processing-and-text-mining.html#cb551-5" tabindex="-1"></a><span class="co">#&gt; [140] │ 5 &lt;feet&gt; 6 inches</span></span></code></pre></div>
<p>We can also use <code>str_detect(string, pattern)</code> to get a logical value (<code>TRUE</code>/<code>FALSE</code>) to filter our vector.</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="string-processing-and-text-mining.html#cb552-1" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(problematic_heights, <span class="st">&quot;feet&quot;</span>)</span>
<span id="cb552-2"><a href="string-processing-and-text-mining.html#cb552-2" tabindex="-1"></a></span>
<span id="cb552-3"><a href="string-processing-and-text-mining.html#cb552-3" tabindex="-1"></a>problematic_heights[index] <span class="co"># Match the pattern</span></span>
<span id="cb552-4"><a href="string-processing-and-text-mining.html#cb552-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;5 feet and 8.11 inches&quot; &quot;5 feet 7inches&quot;         &quot;5 feet 6 inches&quot;</span></span>
<span id="cb552-5"><a href="string-processing-and-text-mining.html#cb552-5" tabindex="-1"></a>problematic_heights[<span class="sc">!</span>index] <span class="sc">|&gt;</span> <span class="co"># Do not match the pattern</span></span>
<span id="cb552-6"><a href="string-processing-and-text-mining.html#cb552-6" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">40</span>) </span>
<span id="cb552-7"><a href="string-processing-and-text-mining.html#cb552-7" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;6&quot;                      &quot;5&#39; 4\&quot;&quot;                 &quot;5.3&quot;                   </span></span>
<span id="cb552-8"><a href="string-processing-and-text-mining.html#cb552-8" tabindex="-1"></a><span class="co">#&gt;  [4] &quot;165cm&quot;                  &quot;6&quot;                      &quot;5&#39;7&quot;                   </span></span>
<span id="cb552-9"><a href="string-processing-and-text-mining.html#cb552-9" tabindex="-1"></a><span class="co">#&gt;  [7] &quot;&gt;9000&quot;                  &quot;5&#39;7\&quot;&quot;                  &quot;5&#39;3\&quot;&quot;                 </span></span>
<span id="cb552-10"><a href="string-processing-and-text-mining.html#cb552-10" tabindex="-1"></a><span class="co">#&gt; [10] &quot;5.25&quot;                   &quot;5&#39;11&quot;                   &quot;5.5&quot;                   </span></span>
<span id="cb552-11"><a href="string-processing-and-text-mining.html#cb552-11" tabindex="-1"></a><span class="co">#&gt; [13] &quot;5&#39;9&#39;&#39;&quot;                  &quot;6&quot;                      &quot;6.5&quot;                   </span></span>
<span id="cb552-12"><a href="string-processing-and-text-mining.html#cb552-12" tabindex="-1"></a><span class="co">#&gt; [16] &quot;5&#39;10&#39;&#39;&quot;                 &quot;5.8&quot;                    &quot;5&quot;                     </span></span>
<span id="cb552-13"><a href="string-processing-and-text-mining.html#cb552-13" tabindex="-1"></a><span class="co">#&gt; [19] &quot;5.6&quot;                    &quot;5,3&quot;                    &quot;6&#39;&quot;                    </span></span>
<span id="cb552-14"><a href="string-processing-and-text-mining.html#cb552-14" tabindex="-1"></a><span class="co">#&gt; [22] &quot;6&quot;                      &quot;5.9&quot;                    &quot;6,8&quot;                   </span></span>
<span id="cb552-15"><a href="string-processing-and-text-mining.html#cb552-15" tabindex="-1"></a><span class="co">#&gt; [25] &quot;5&#39; 10&quot;                  &quot;5.5&quot;                    &quot;6.2&quot;                   </span></span>
<span id="cb552-16"><a href="string-processing-and-text-mining.html#cb552-16" tabindex="-1"></a><span class="co">#&gt; [28] &quot;Five foot eight inches&quot; &quot;6.2&quot;                    &quot;5.8&quot;                   </span></span>
<span id="cb552-17"><a href="string-processing-and-text-mining.html#cb552-17" tabindex="-1"></a><span class="co">#&gt; [31] &quot;5.1&quot;                    &quot;5.11&quot;                   &quot;5&#39;5\&quot;&quot;                 </span></span>
<span id="cb552-18"><a href="string-processing-and-text-mining.html#cb552-18" tabindex="-1"></a><span class="co">#&gt; [34] &quot;5&#39;2\&quot;&quot;                  &quot;5.75&quot;                   &quot;5,4&quot;                   </span></span>
<span id="cb552-19"><a href="string-processing-and-text-mining.html#cb552-19" tabindex="-1"></a><span class="co">#&gt; [37] &quot;7&quot;                      &quot;5.4&quot;                    &quot;6.1&quot;                   </span></span>
<span id="cb552-20"><a href="string-processing-and-text-mining.html#cb552-20" tabindex="-1"></a><span class="co">#&gt; [40] &quot;5&#39;3&quot;</span></span></code></pre></div>
<div id="alternation" class="section level3 hasAnchor" number="13.2.1">
<h3><span class="header-section-number">13.2.1</span> Alternation<a href="string-processing-and-text-mining.html#alternation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>|</code> is the alternation operator that will choose between one or more possible values. In our case, we have indicated to detect if there is the word “feet”, but we also have “ft” and “foot” to refer to the same thing in our data. Thus, we can create the pattern “feet” or “ft” or “foot”.</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="string-processing-and-text-mining.html#cb553-1" tabindex="-1"></a><span class="co"># Visualize the matches</span></span>
<span id="cb553-2"><a href="string-processing-and-text-mining.html#cb553-2" tabindex="-1"></a><span class="fu">str_view</span>(problematic_heights, <span class="st">&quot;feet|ft|foot&quot;</span>, <span class="at">match=</span><span class="cn">TRUE</span>)</span>
<span id="cb553-3"><a href="string-processing-and-text-mining.html#cb553-3" tabindex="-1"></a><span class="co">#&gt;  [10] │ 5 &lt;feet&gt; and 8.11 inches</span></span>
<span id="cb553-4"><a href="string-processing-and-text-mining.html#cb553-4" tabindex="-1"></a><span class="co">#&gt;  [29] │ Five &lt;foot&gt; eight inches</span></span>
<span id="cb553-5"><a href="string-processing-and-text-mining.html#cb553-5" tabindex="-1"></a><span class="co">#&gt;  [82] │ 5 &lt;feet&gt; 7inches</span></span>
<span id="cb553-6"><a href="string-processing-and-text-mining.html#cb553-6" tabindex="-1"></a><span class="co">#&gt; [124] │ 5&lt;ft&gt; 9 inches</span></span>
<span id="cb553-7"><a href="string-processing-and-text-mining.html#cb553-7" tabindex="-1"></a><span class="co">#&gt; [125] │ 5 &lt;ft&gt; 9 inches</span></span>
<span id="cb553-8"><a href="string-processing-and-text-mining.html#cb553-8" tabindex="-1"></a><span class="co">#&gt; [140] │ 5 &lt;feet&gt; 6 inches</span></span></code></pre></div>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="string-processing-and-text-mining.html#cb554-1" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(problematic_heights, <span class="st">&quot;feet|ft|foot&quot;</span>)</span>
<span id="cb554-2"><a href="string-processing-and-text-mining.html#cb554-2" tabindex="-1"></a>problematic_heights[index] <span class="co"># Match</span></span>
<span id="cb554-3"><a href="string-processing-and-text-mining.html#cb554-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;5 feet and 8.11 inches&quot; &quot;Five foot eight inches&quot; &quot;5 feet 7inches&quot;        </span></span>
<span id="cb554-4"><a href="string-processing-and-text-mining.html#cb554-4" tabindex="-1"></a><span class="co">#&gt; [4] &quot;5ft 9 inches&quot;           &quot;5 ft 9 inches&quot;          &quot;5 feet 6 inches&quot;</span></span></code></pre></div>
<p>In the same way we can find the variations for inches and other symbols that we can remove:</p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="string-processing-and-text-mining.html#cb555-1" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(problematic_heights, <span class="st">&quot;inches|in|&#39;&#39;|</span><span class="sc">\&quot;</span><span class="st">|cm|and&quot;</span>)</span>
<span id="cb555-2"><a href="string-processing-and-text-mining.html#cb555-2" tabindex="-1"></a>problematic_heights[index] <span class="co"># Match</span></span>
<span id="cb555-3"><a href="string-processing-and-text-mining.html#cb555-3" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;5&#39; 4\&quot;&quot;                 &quot;165cm&quot;                  &quot;5&#39;7\&quot;&quot;                 </span></span>
<span id="cb555-4"><a href="string-processing-and-text-mining.html#cb555-4" tabindex="-1"></a><span class="co">#&gt;  [4] &quot;5&#39;3\&quot;&quot;                  &quot;5 feet and 8.11 inches&quot; &quot;5&#39;9&#39;&#39;&quot;                 </span></span>
<span id="cb555-5"><a href="string-processing-and-text-mining.html#cb555-5" tabindex="-1"></a><span class="co">#&gt;  [7] &quot;5&#39;10&#39;&#39;&quot;                 &quot;Five foot eight inches&quot; &quot;5&#39;5\&quot;&quot;                 </span></span>
<span id="cb555-6"><a href="string-processing-and-text-mining.html#cb555-6" tabindex="-1"></a><span class="co">#&gt; [10] &quot;5&#39;2\&quot;&quot;                  &quot;5&#39;10&#39;&#39;&quot;                 &quot;5&#39;3&#39;&#39;&quot;                 </span></span>
<span id="cb555-7"><a href="string-processing-and-text-mining.html#cb555-7" tabindex="-1"></a><span class="co">#&gt; [13] &quot;5&#39;7&#39;&#39;&quot;                  &quot;5&#39;3\&quot;&quot;                  &quot;5&#39;6&#39;&#39;&quot;                 </span></span>
<span id="cb555-8"><a href="string-processing-and-text-mining.html#cb555-8" tabindex="-1"></a><span class="co">#&gt; [16] &quot;5&#39;7.5&#39;&#39;&quot;                &quot;5&#39;7.5&#39;&#39;&quot;                &quot;5&#39;2\&quot;&quot;                 </span></span>
<span id="cb555-9"><a href="string-processing-and-text-mining.html#cb555-9" tabindex="-1"></a><span class="co">#&gt; [19] &quot;5&#39; 7.78\&quot;&quot;              &quot;5 feet 7inches&quot;         &quot;5&#39;8\&quot;&quot;                 </span></span>
<span id="cb555-10"><a href="string-processing-and-text-mining.html#cb555-10" tabindex="-1"></a><span class="co">#&gt; [22] &quot;5&#39;11\&quot;&quot;                 &quot;5&#39;7\&quot;&quot;                  &quot;5&#39; 11\&quot;&quot;               </span></span>
<span id="cb555-11"><a href="string-processing-and-text-mining.html#cb555-11" tabindex="-1"></a><span class="co">#&gt; [25] &quot;6&#39;1\&quot;&quot;                  &quot;69\&quot;&quot;                   &quot;5&#39; 7\&quot;&quot;                </span></span>
<span id="cb555-12"><a href="string-processing-and-text-mining.html#cb555-12" tabindex="-1"></a><span class="co">#&gt; [28] &quot;5&#39;10&#39;&#39;&quot;                 &quot;5ft 9 inches&quot;           &quot;5 ft 9 inches&quot;         </span></span>
<span id="cb555-13"><a href="string-processing-and-text-mining.html#cb555-13" tabindex="-1"></a><span class="co">#&gt; [31] &quot;5&#39;11&#39;&#39;&quot;                 &quot;5&#39;8\&quot;&quot;                  &quot;5 feet 6 inches&quot;       </span></span>
<span id="cb555-14"><a href="string-processing-and-text-mining.html#cb555-14" tabindex="-1"></a><span class="co">#&gt; [34] &quot;5&#39;10&#39;&#39;&quot;                 &quot;6&#39;3\&quot;&quot;                  &quot;5&#39;5&#39;&#39;&quot;                 </span></span>
<span id="cb555-15"><a href="string-processing-and-text-mining.html#cb555-15" tabindex="-1"></a><span class="co">#&gt; [37] &quot;5&#39;7\&quot;&quot;                  &quot;6&#39;4\&quot;&quot;                  &quot;170 cm&quot;</span></span></code></pre></div>
<p>In this case we have entered <code>''</code> to detect those who entered that symbol to denote inches and <code>\"</code> in case they used double quotes. In this latter case we have used <code>\</code> so that it does not generate an error when interpreting as closing the string.</p>
<p>We could already start replacing based on the detected patterns:</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="string-processing-and-text-mining.html#cb556-1" tabindex="-1"></a>problematic_heights <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(problematic_heights, <span class="st">&quot;feet|ft|foot&quot;</span>, <span class="st">&quot;&#39;&quot;</span>)</span>
<span id="cb556-2"><a href="string-processing-and-text-mining.html#cb556-2" tabindex="-1"></a>problematic_heights <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(problematic_heights, <span class="st">&quot;inches|in|&#39;&#39;|</span><span class="sc">\&quot;</span><span class="st">|cm|and&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb556-3"><a href="string-processing-and-text-mining.html#cb556-3" tabindex="-1"></a></span>
<span id="cb556-4"><a href="string-processing-and-text-mining.html#cb556-4" tabindex="-1"></a>problematic_heights <span class="sc">|&gt;</span> </span>
<span id="cb556-5"><a href="string-processing-and-text-mining.html#cb556-5" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">30</span>)</span>
<span id="cb556-6"><a href="string-processing-and-text-mining.html#cb556-6" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;6&quot;             &quot;5&#39; 4&quot;          &quot;5.3&quot;           &quot;165&quot;          </span></span>
<span id="cb556-7"><a href="string-processing-and-text-mining.html#cb556-7" tabindex="-1"></a><span class="co">#&gt;  [5] &quot;6&quot;             &quot;5&#39;7&quot;           &quot;&gt;9000&quot;         &quot;5&#39;7&quot;          </span></span>
<span id="cb556-8"><a href="string-processing-and-text-mining.html#cb556-8" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;5&#39;3&quot;           &quot;5 &#39;  8.11 &quot;    &quot;5.25&quot;          &quot;5&#39;11&quot;         </span></span>
<span id="cb556-9"><a href="string-processing-and-text-mining.html#cb556-9" tabindex="-1"></a><span class="co">#&gt; [13] &quot;5.5&quot;           &quot;5&#39;9&quot;           &quot;6&quot;             &quot;6.5&quot;          </span></span>
<span id="cb556-10"><a href="string-processing-and-text-mining.html#cb556-10" tabindex="-1"></a><span class="co">#&gt; [17] &quot;5&#39;10&quot;          &quot;5.8&quot;           &quot;5&quot;             &quot;5.6&quot;          </span></span>
<span id="cb556-11"><a href="string-processing-and-text-mining.html#cb556-11" tabindex="-1"></a><span class="co">#&gt; [21] &quot;5,3&quot;           &quot;6&#39;&quot;            &quot;6&quot;             &quot;5.9&quot;          </span></span>
<span id="cb556-12"><a href="string-processing-and-text-mining.html#cb556-12" tabindex="-1"></a><span class="co">#&gt; [25] &quot;6,8&quot;           &quot;5&#39; 10&quot;         &quot;5.5&quot;           &quot;6.2&quot;          </span></span>
<span id="cb556-13"><a href="string-processing-and-text-mining.html#cb556-13" tabindex="-1"></a><span class="co">#&gt; [29] &quot;Five &#39; eight &quot; &quot;6.2&quot;</span></span></code></pre></div>
<p>As an additional effort, we could also look to solve that some people have written words instead of numbers. For this we create a function that replaces each word with a number and apply it to the vector:</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="string-processing-and-text-mining.html#cb557-1" tabindex="-1"></a>words_to_number <span class="ot">&lt;-</span> <span class="cf">function</span>(s){</span>
<span id="cb557-2"><a href="string-processing-and-text-mining.html#cb557-2" tabindex="-1"></a>  <span class="fu">str_to_lower</span>(s) <span class="sc">|&gt;</span>  </span>
<span id="cb557-3"><a href="string-processing-and-text-mining.html#cb557-3" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;zero&quot;</span>, <span class="st">&quot;0&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb557-4"><a href="string-processing-and-text-mining.html#cb557-4" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;1&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb557-5"><a href="string-processing-and-text-mining.html#cb557-5" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;two&quot;</span>, <span class="st">&quot;2&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb557-6"><a href="string-processing-and-text-mining.html#cb557-6" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;three&quot;</span>, <span class="st">&quot;3&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb557-7"><a href="string-processing-and-text-mining.html#cb557-7" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;four&quot;</span>, <span class="st">&quot;4&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb557-8"><a href="string-processing-and-text-mining.html#cb557-8" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;five&quot;</span>, <span class="st">&quot;5&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb557-9"><a href="string-processing-and-text-mining.html#cb557-9" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;six&quot;</span>, <span class="st">&quot;6&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb557-10"><a href="string-processing-and-text-mining.html#cb557-10" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;seven&quot;</span>, <span class="st">&quot;7&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb557-11"><a href="string-processing-and-text-mining.html#cb557-11" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;eight&quot;</span>, <span class="st">&quot;8&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb557-12"><a href="string-processing-and-text-mining.html#cb557-12" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;nine&quot;</span>, <span class="st">&quot;9&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb557-13"><a href="string-processing-and-text-mining.html#cb557-13" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;ten&quot;</span>, <span class="st">&quot;10&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb557-14"><a href="string-processing-and-text-mining.html#cb557-14" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;eleven&quot;</span>, <span class="st">&quot;11&quot;</span>)</span>
<span id="cb557-15"><a href="string-processing-and-text-mining.html#cb557-15" tabindex="-1"></a>}</span>
<span id="cb557-16"><a href="string-processing-and-text-mining.html#cb557-16" tabindex="-1"></a></span>
<span id="cb557-17"><a href="string-processing-and-text-mining.html#cb557-17" tabindex="-1"></a>problematic_heights <span class="ot">&lt;-</span> <span class="fu">words_to_number</span>(problematic_heights)</span>
<span id="cb557-18"><a href="string-processing-and-text-mining.html#cb557-18" tabindex="-1"></a>problematic_heights <span class="sc">|&gt;</span> </span>
<span id="cb557-19"><a href="string-processing-and-text-mining.html#cb557-19" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">30</span>)</span>
<span id="cb557-20"><a href="string-processing-and-text-mining.html#cb557-20" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;6&quot;          &quot;5&#39; 4&quot;       &quot;5.3&quot;        &quot;165&quot;        &quot;6&quot;         </span></span>
<span id="cb557-21"><a href="string-processing-and-text-mining.html#cb557-21" tabindex="-1"></a><span class="co">#&gt;  [6] &quot;5&#39;7&quot;        &quot;&gt;9000&quot;      &quot;5&#39;7&quot;        &quot;5&#39;3&quot;        &quot;5 &#39;  8.11 &quot;</span></span>
<span id="cb557-22"><a href="string-processing-and-text-mining.html#cb557-22" tabindex="-1"></a><span class="co">#&gt; [11] &quot;5.25&quot;       &quot;5&#39;11&quot;       &quot;5.5&quot;        &quot;5&#39;9&quot;        &quot;6&quot;         </span></span>
<span id="cb557-23"><a href="string-processing-and-text-mining.html#cb557-23" tabindex="-1"></a><span class="co">#&gt; [16] &quot;6.5&quot;        &quot;5&#39;10&quot;       &quot;5.8&quot;        &quot;5&quot;          &quot;5.6&quot;       </span></span>
<span id="cb557-24"><a href="string-processing-and-text-mining.html#cb557-24" tabindex="-1"></a><span class="co">#&gt; [21] &quot;5,3&quot;        &quot;6&#39;&quot;         &quot;6&quot;          &quot;5.9&quot;        &quot;6,8&quot;       </span></span>
<span id="cb557-25"><a href="string-processing-and-text-mining.html#cb557-25" tabindex="-1"></a><span class="co">#&gt; [26] &quot;5&#39; 10&quot;      &quot;5.5&quot;        &quot;6.2&quot;        &quot;5 &#39; 8 &quot;     &quot;6.2&quot;</span></span></code></pre></div>
</div>
<div id="anchoring" class="section level3 hasAnchor" number="13.2.2">
<h3><span class="header-section-number">13.2.2</span> Anchoring<a href="string-processing-and-text-mining.html#anchoring" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that it is more standardized we can start with regex with more generic characteristics. For example, there is a person who has entered <code>6'</code>. It would be convenient to have everything in the form feet plus inches. With which we should have <code>6'0</code>. To achieve this we have to create a regex according to this generic situation. We will use the symbol <code>^</code> to anchor our validation to “start with” and the symbol <code>$</code> to match with the end of the string. Before replacing, let’s first see who matches.</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="string-processing-and-text-mining.html#cb558-1" tabindex="-1"></a><span class="fu">str_view</span>(problematic_heights, <span class="st">&quot;^6&#39;$&quot;</span>, <span class="at">match=</span><span class="cn">TRUE</span>)</span>
<span id="cb558-2"><a href="string-processing-and-text-mining.html#cb558-2" tabindex="-1"></a><span class="co">#&gt; [22] │ &lt;6&#39;&gt;</span></span></code></pre></div>
<p>This regex indicates that it starts with <code>6'</code> and that the expression ends there. We could still make it more generic to address those who, in the future, write 5 inches (1.52m) or 6 inches (1.82m). For this we will use brackets and inside them we will put all the values that we will accept.</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="string-processing-and-text-mining.html#cb559-1" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(problematic_heights, <span class="st">&quot;^[56]&#39;$&quot;</span>)</span>
<span id="cb559-2"><a href="string-processing-and-text-mining.html#cb559-2" tabindex="-1"></a>problematic_heights[index] <span class="co"># Match</span></span>
<span id="cb559-3"><a href="string-processing-and-text-mining.html#cb559-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;6&#39;&quot;</span></span></code></pre></div>
<p>There is still only one result, but our regex is more generic now and we can already use it to replace. Before replacing in our vector we are going to do a test to learn how to create what we need from a pattern.</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="string-processing-and-text-mining.html#cb560-1" tabindex="-1"></a>test_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;5&#39;&quot;</span>, <span class="st">&quot;6&#39;&quot;</span>)</span>
<span id="cb560-2"><a href="string-processing-and-text-mining.html#cb560-2" tabindex="-1"></a></span>
<span id="cb560-3"><a href="string-processing-and-text-mining.html#cb560-3" tabindex="-1"></a><span class="fu">str_replace_all</span>(test_vec, <span class="st">&quot;^([56])&#39;$&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&#39;0&quot;</span>)</span>
<span id="cb560-4"><a href="string-processing-and-text-mining.html#cb560-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;5&#39;0&quot; &quot;6&#39;0&quot;</span></span></code></pre></div>
<p>We have placed between parentheses to indicate that what is inside is our first value and we use <code>\\1</code> to refer to that first value. So we are indicating to write the first value, then a quote <code>'</code>, and then a zero <code>0</code>.</p>
<p>Now we are ready to apply to our entire vector. We are going to make the change to consider not only 5 and 6, but up to the value of 7 inches (2.1m). Likewise, we are going to take the cases in which there is only a number without the foot symbol <code>'</code>.</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="string-processing-and-text-mining.html#cb561-1" tabindex="-1"></a>problematic_heights <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(problematic_heights, <span class="st">&quot;^([5-7])&#39;$&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&#39;0&quot;</span>)</span>
<span id="cb561-2"><a href="string-processing-and-text-mining.html#cb561-2" tabindex="-1"></a>problematic_heights <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(problematic_heights, <span class="st">&quot;^([5-7])$&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&#39;0&quot;</span>)</span>
<span id="cb561-3"><a href="string-processing-and-text-mining.html#cb561-3" tabindex="-1"></a></span>
<span id="cb561-4"><a href="string-processing-and-text-mining.html#cb561-4" tabindex="-1"></a>problematic_heights <span class="sc">|&gt;</span> </span>
<span id="cb561-5"><a href="string-processing-and-text-mining.html#cb561-5" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">30</span>)</span>
<span id="cb561-6"><a href="string-processing-and-text-mining.html#cb561-6" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;6&#39;0&quot;        &quot;5&#39; 4&quot;       &quot;5.3&quot;        &quot;165&quot;        &quot;6&#39;0&quot;       </span></span>
<span id="cb561-7"><a href="string-processing-and-text-mining.html#cb561-7" tabindex="-1"></a><span class="co">#&gt;  [6] &quot;5&#39;7&quot;        &quot;&gt;9000&quot;      &quot;5&#39;7&quot;        &quot;5&#39;3&quot;        &quot;5 &#39;  8.11 &quot;</span></span>
<span id="cb561-8"><a href="string-processing-and-text-mining.html#cb561-8" tabindex="-1"></a><span class="co">#&gt; [11] &quot;5.25&quot;       &quot;5&#39;11&quot;       &quot;5.5&quot;        &quot;5&#39;9&quot;        &quot;6&#39;0&quot;       </span></span>
<span id="cb561-9"><a href="string-processing-and-text-mining.html#cb561-9" tabindex="-1"></a><span class="co">#&gt; [16] &quot;6.5&quot;        &quot;5&#39;10&quot;       &quot;5.8&quot;        &quot;5&#39;0&quot;        &quot;5.6&quot;       </span></span>
<span id="cb561-10"><a href="string-processing-and-text-mining.html#cb561-10" tabindex="-1"></a><span class="co">#&gt; [21] &quot;5,3&quot;        &quot;6&#39;0&quot;        &quot;6&#39;0&quot;        &quot;5.9&quot;        &quot;6,8&quot;       </span></span>
<span id="cb561-11"><a href="string-processing-and-text-mining.html#cb561-11" tabindex="-1"></a><span class="co">#&gt; [26] &quot;5&#39; 10&quot;      &quot;5.5&quot;        &quot;6.2&quot;        &quot;5 &#39; 8 &quot;     &quot;6.2&quot;</span></span></code></pre></div>
</div>
<div id="repetitions" class="section level3 hasAnchor" number="13.2.3">
<h3><span class="header-section-number">13.2.3</span> Repetitions<a href="string-processing-and-text-mining.html#repetitions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can control how many times a pattern matches using repetition operators:</p>
<p>We can control how many times a pattern matches using repetition operators. The question mark <strong><code>?</code></strong> indicates that the preceding element matches <strong>0 or 1</strong> time (making it optional). The plus sign <strong><code>+</code></strong> requires <strong>1 or more</strong> matches, ensuring the element is present at least once. The asterisk <strong><code>*</code></strong> allows for <strong>0 or more</strong> matches, meaning the element can be absent or repeated indefinitely.</p>
<p>For example, to find all cases where instead of using the foot symbol <code>'</code> they entered a comma, a period, or a space we will use the following pattern:</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="string-processing-and-text-mining.html#cb562-1" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">&quot;^([4-7])</span><span class="sc">\\</span><span class="st">s*[,</span><span class="sc">\\</span><span class="st">.]</span><span class="sc">\\</span><span class="st">s*(</span><span class="sc">\\</span><span class="st">d*)$&quot;</span></span></code></pre></div>
<p>Let’s read the pattern:</p>
<ol style="list-style-type: decimal">
<li>The string starts with a digit ranging from 4 to 7.</li>
<li><code>\\s</code> means that it is followed by a white space, but we use <code>*</code> to indicate that this character appears 0 or more times.</li>
<li>After that space we will look for any of the following characters: <code>,</code>, a period <code>\\.</code> (to which we put double backslash because the period alone in a pattern means “any value”).</li>
<li>We use <code>\\s*</code> again to look for zero or more white spaces.</li>
<li>Finally we indicate that the string ends there with a digit, to denote that look for any digit we use <code>\\d</code>, d for digit. And we add asterisk so that it keeps one or more digits that it finds.</li>
</ol>
<p>In summary: it starts with a number, then symbols and then a digit. Between the symbols there could be white spaces. That is our pattern.</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="string-processing-and-text-mining.html#cb563-1" tabindex="-1"></a><span class="fu">str_view</span>(problematic_heights, pattern, <span class="at">match=</span><span class="cn">TRUE</span>)</span>
<span id="cb563-2"><a href="string-processing-and-text-mining.html#cb563-2" tabindex="-1"></a><span class="co">#&gt;  [3] │ &lt;5.3&gt;</span></span>
<span id="cb563-3"><a href="string-processing-and-text-mining.html#cb563-3" tabindex="-1"></a><span class="co">#&gt; [11] │ &lt;5.25&gt;</span></span>
<span id="cb563-4"><a href="string-processing-and-text-mining.html#cb563-4" tabindex="-1"></a><span class="co">#&gt; [13] │ &lt;5.5&gt;</span></span>
<span id="cb563-5"><a href="string-processing-and-text-mining.html#cb563-5" tabindex="-1"></a><span class="co">#&gt; [16] │ &lt;6.5&gt;</span></span>
<span id="cb563-6"><a href="string-processing-and-text-mining.html#cb563-6" tabindex="-1"></a><span class="co">#&gt; [18] │ &lt;5.8&gt;</span></span>
<span id="cb563-7"><a href="string-processing-and-text-mining.html#cb563-7" tabindex="-1"></a><span class="co">#&gt; [20] │ &lt;5.6&gt;</span></span>
<span id="cb563-8"><a href="string-processing-and-text-mining.html#cb563-8" tabindex="-1"></a><span class="co">#&gt; [21] │ &lt;5,3&gt;</span></span>
<span id="cb563-9"><a href="string-processing-and-text-mining.html#cb563-9" tabindex="-1"></a><span class="co">#&gt; [24] │ &lt;5.9&gt;</span></span>
<span id="cb563-10"><a href="string-processing-and-text-mining.html#cb563-10" tabindex="-1"></a><span class="co">#&gt; [25] │ &lt;6,8&gt;</span></span>
<span id="cb563-11"><a href="string-processing-and-text-mining.html#cb563-11" tabindex="-1"></a><span class="co">#&gt; [27] │ &lt;5.5&gt;</span></span>
<span id="cb563-12"><a href="string-processing-and-text-mining.html#cb563-12" tabindex="-1"></a><span class="co">#&gt; [28] │ &lt;6.2&gt;</span></span>
<span id="cb563-13"><a href="string-processing-and-text-mining.html#cb563-13" tabindex="-1"></a><span class="co">#&gt; [30] │ &lt;6.2&gt;</span></span>
<span id="cb563-14"><a href="string-processing-and-text-mining.html#cb563-14" tabindex="-1"></a><span class="co">#&gt; [31] │ &lt;5.8&gt;</span></span>
<span id="cb563-15"><a href="string-processing-and-text-mining.html#cb563-15" tabindex="-1"></a><span class="co">#&gt; [32] │ &lt;5.1&gt;</span></span>
<span id="cb563-16"><a href="string-processing-and-text-mining.html#cb563-16" tabindex="-1"></a><span class="co">#&gt; [33] │ &lt;5.11&gt;</span></span>
<span id="cb563-17"><a href="string-processing-and-text-mining.html#cb563-17" tabindex="-1"></a><span class="co">#&gt; [36] │ &lt;5.75&gt;</span></span>
<span id="cb563-18"><a href="string-processing-and-text-mining.html#cb563-18" tabindex="-1"></a><span class="co">#&gt; [37] │ &lt;5,4&gt;</span></span>
<span id="cb563-19"><a href="string-processing-and-text-mining.html#cb563-19" tabindex="-1"></a><span class="co">#&gt; [39] │ &lt;5.4&gt;</span></span>
<span id="cb563-20"><a href="string-processing-and-text-mining.html#cb563-20" tabindex="-1"></a><span class="co">#&gt; [40] │ &lt;6.1&gt;</span></span>
<span id="cb563-21"><a href="string-processing-and-text-mining.html#cb563-21" tabindex="-1"></a><span class="co">#&gt; [42] │ &lt;5.6&gt;</span></span>
<span id="cb563-22"><a href="string-processing-and-text-mining.html#cb563-22" tabindex="-1"></a><span class="co">#&gt; ... and 48 more</span></span></code></pre></div>
<p>We already found the values that match the pattern, so we are ready to replace.</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="string-processing-and-text-mining.html#cb564-1" tabindex="-1"></a>problematic_heights <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(</span>
<span id="cb564-2"><a href="string-processing-and-text-mining.html#cb564-2" tabindex="-1"></a>                        problematic_heights, </span>
<span id="cb564-3"><a href="string-processing-and-text-mining.html#cb564-3" tabindex="-1"></a>                        <span class="st">&quot;^([4-7])</span><span class="sc">\\</span><span class="st">s*[,</span><span class="sc">\\</span><span class="st">.]</span><span class="sc">\\</span><span class="st">s*(</span><span class="sc">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1.</span><span class="sc">\\</span><span class="st">2&#39;0&quot;</span></span>
<span id="cb564-4"><a href="string-processing-and-text-mining.html#cb564-4" tabindex="-1"></a>                   )</span>
<span id="cb564-5"><a href="string-processing-and-text-mining.html#cb564-5" tabindex="-1"></a></span>
<span id="cb564-6"><a href="string-processing-and-text-mining.html#cb564-6" tabindex="-1"></a>problematic_heights <span class="sc">|&gt;</span> </span>
<span id="cb564-7"><a href="string-processing-and-text-mining.html#cb564-7" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">30</span>)</span>
<span id="cb564-8"><a href="string-processing-and-text-mining.html#cb564-8" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;6&#39;0&quot;        &quot;5&#39; 4&quot;       &quot;5.3&#39;0&quot;      &quot;165&quot;        &quot;6&#39;0&quot;       </span></span>
<span id="cb564-9"><a href="string-processing-and-text-mining.html#cb564-9" tabindex="-1"></a><span class="co">#&gt;  [6] &quot;5&#39;7&quot;        &quot;&gt;9000&quot;      &quot;5&#39;7&quot;        &quot;5&#39;3&quot;        &quot;5 &#39;  8.11 &quot;</span></span>
<span id="cb564-10"><a href="string-processing-and-text-mining.html#cb564-10" tabindex="-1"></a><span class="co">#&gt; [11] &quot;5.25&#39;0&quot;     &quot;5&#39;11&quot;       &quot;5.5&#39;0&quot;      &quot;5&#39;9&quot;        &quot;6&#39;0&quot;       </span></span>
<span id="cb564-11"><a href="string-processing-and-text-mining.html#cb564-11" tabindex="-1"></a><span class="co">#&gt; [16] &quot;6.5&#39;0&quot;      &quot;5&#39;10&quot;       &quot;5.8&#39;0&quot;      &quot;5&#39;0&quot;        &quot;5.6&#39;0&quot;     </span></span>
<span id="cb564-12"><a href="string-processing-and-text-mining.html#cb564-12" tabindex="-1"></a><span class="co">#&gt; [21] &quot;5.3&#39;0&quot;      &quot;6&#39;0&quot;        &quot;6&#39;0&quot;        &quot;5.9&#39;0&quot;      &quot;6.8&#39;0&quot;     </span></span>
<span id="cb564-13"><a href="string-processing-and-text-mining.html#cb564-13" tabindex="-1"></a><span class="co">#&gt; [26] &quot;5&#39; 10&quot;      &quot;5.5&#39;0&quot;      &quot;6.2&#39;0&quot;      &quot;5 &#39; 8 &quot;     &quot;6.2&#39;0&quot;</span></span></code></pre></div>
<p>Another pattern we see now is when before or after the foot symbol <code>'</code> there is a white space. Let’s make the change with what we learned and include cases where there are decimals:</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="string-processing-and-text-mining.html#cb565-1" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(problematic_heights, </span>
<span id="cb565-2"><a href="string-processing-and-text-mining.html#cb565-2" tabindex="-1"></a>                     <span class="st">&quot;^([4-7]</span><span class="sc">\\</span><span class="st">.?</span><span class="sc">\\</span><span class="st">d*)</span><span class="sc">\\</span><span class="st">s*&#39;</span><span class="sc">\\</span><span class="st">s*(</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.?</span><span class="sc">\\</span><span class="st">d*)</span><span class="sc">\\</span><span class="st">s*$&quot;</span>)</span>
<span id="cb565-3"><a href="string-processing-and-text-mining.html#cb565-3" tabindex="-1"></a></span>
<span id="cb565-4"><a href="string-processing-and-text-mining.html#cb565-4" tabindex="-1"></a>problematic_heights[index] <span class="sc">|&gt;</span> <span class="co"># Match</span></span>
<span id="cb565-5"><a href="string-processing-and-text-mining.html#cb565-5" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">30</span>)</span>
<span id="cb565-6"><a href="string-processing-and-text-mining.html#cb565-6" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;6&#39;0&quot;        &quot;5&#39; 4&quot;       &quot;5.3&#39;0&quot;      &quot;6&#39;0&quot;        &quot;5&#39;7&quot;       </span></span>
<span id="cb565-7"><a href="string-processing-and-text-mining.html#cb565-7" tabindex="-1"></a><span class="co">#&gt;  [6] &quot;5&#39;7&quot;        &quot;5&#39;3&quot;        &quot;5 &#39;  8.11 &quot; &quot;5.25&#39;0&quot;     &quot;5&#39;11&quot;      </span></span>
<span id="cb565-8"><a href="string-processing-and-text-mining.html#cb565-8" tabindex="-1"></a><span class="co">#&gt; [11] &quot;5.5&#39;0&quot;      &quot;5&#39;9&quot;        &quot;6&#39;0&quot;        &quot;6.5&#39;0&quot;      &quot;5&#39;10&quot;      </span></span>
<span id="cb565-9"><a href="string-processing-and-text-mining.html#cb565-9" tabindex="-1"></a><span class="co">#&gt; [16] &quot;5.8&#39;0&quot;      &quot;5&#39;0&quot;        &quot;5.6&#39;0&quot;      &quot;5.3&#39;0&quot;      &quot;6&#39;0&quot;       </span></span>
<span id="cb565-10"><a href="string-processing-and-text-mining.html#cb565-10" tabindex="-1"></a><span class="co">#&gt; [21] &quot;6&#39;0&quot;        &quot;5.9&#39;0&quot;      &quot;6.8&#39;0&quot;      &quot;5&#39; 10&quot;      &quot;5.5&#39;0&quot;     </span></span>
<span id="cb565-11"><a href="string-processing-and-text-mining.html#cb565-11" tabindex="-1"></a><span class="co">#&gt; [26] &quot;6.2&#39;0&quot;      &quot;5 &#39; 8 &quot;     &quot;6.2&#39;0&quot;      &quot;5.8&#39;0&quot;      &quot;5.1&#39;0&quot;</span></span>
<span id="cb565-12"><a href="string-processing-and-text-mining.html#cb565-12" tabindex="-1"></a></span>
<span id="cb565-13"><a href="string-processing-and-text-mining.html#cb565-13" tabindex="-1"></a>problematic_heights <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(</span>
<span id="cb565-14"><a href="string-processing-and-text-mining.html#cb565-14" tabindex="-1"></a>                      problematic_heights, </span>
<span id="cb565-15"><a href="string-processing-and-text-mining.html#cb565-15" tabindex="-1"></a>                      <span class="st">&quot;^([4-7]</span><span class="sc">\\</span><span class="st">.?</span><span class="sc">\\</span><span class="st">d*)</span><span class="sc">\\</span><span class="st">s*&#39;</span><span class="sc">\\</span><span class="st">s*(</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.?</span><span class="sc">\\</span><span class="st">d*)</span><span class="sc">\\</span><span class="st">s*$&quot;</span>,</span>
<span id="cb565-16"><a href="string-processing-and-text-mining.html#cb565-16" tabindex="-1"></a>                      <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&#39;</span><span class="sc">\\</span><span class="st">2&quot;</span></span>
<span id="cb565-17"><a href="string-processing-and-text-mining.html#cb565-17" tabindex="-1"></a>                   )</span>
<span id="cb565-18"><a href="string-processing-and-text-mining.html#cb565-18" tabindex="-1"></a></span>
<span id="cb565-19"><a href="string-processing-and-text-mining.html#cb565-19" tabindex="-1"></a>problematic_heights <span class="sc">|&gt;</span> </span>
<span id="cb565-20"><a href="string-processing-and-text-mining.html#cb565-20" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">30</span>)</span>
<span id="cb565-21"><a href="string-processing-and-text-mining.html#cb565-21" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;6&#39;0&quot;    &quot;5&#39;4&quot;    &quot;5.3&#39;0&quot;  &quot;165&quot;    &quot;6&#39;0&quot;    &quot;5&#39;7&quot;    &quot;&gt;9000&quot;  &quot;5&#39;7&quot;   </span></span>
<span id="cb565-22"><a href="string-processing-and-text-mining.html#cb565-22" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;5&#39;3&quot;    &quot;5&#39;8.11&quot; &quot;5.25&#39;0&quot; &quot;5&#39;11&quot;   &quot;5.5&#39;0&quot;  &quot;5&#39;9&quot;    &quot;6&#39;0&quot;    &quot;6.5&#39;0&quot; </span></span>
<span id="cb565-23"><a href="string-processing-and-text-mining.html#cb565-23" tabindex="-1"></a><span class="co">#&gt; [17] &quot;5&#39;10&quot;   &quot;5.8&#39;0&quot;  &quot;5&#39;0&quot;    &quot;5.6&#39;0&quot;  &quot;5.3&#39;0&quot;  &quot;6&#39;0&quot;    &quot;6&#39;0&quot;    &quot;5.9&#39;0&quot; </span></span>
<span id="cb565-24"><a href="string-processing-and-text-mining.html#cb565-24" tabindex="-1"></a><span class="co">#&gt; [25] &quot;6.8&#39;0&quot;  &quot;5&#39;10&quot;   &quot;5.5&#39;0&quot;  &quot;6.2&#39;0&quot;  &quot;5&#39;8&quot;    &quot;6.2&#39;0&quot;</span></span></code></pre></div>
<p>Likewise, we have the pattern in which they entered: feet + space + inches without any symbol. Let’s make the change with what we learned.</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="string-processing-and-text-mining.html#cb566-1" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(problematic_heights, <span class="st">&quot;^([4-7])</span><span class="sc">\\</span><span class="st">s+(</span><span class="sc">\\</span><span class="st">d*)</span><span class="sc">\\</span><span class="st">s*$&quot;</span>)</span>
<span id="cb566-2"><a href="string-processing-and-text-mining.html#cb566-2" tabindex="-1"></a></span>
<span id="cb566-3"><a href="string-processing-and-text-mining.html#cb566-3" tabindex="-1"></a>problematic_heights[index] <span class="co"># Match</span></span>
<span id="cb566-4"><a href="string-processing-and-text-mining.html#cb566-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;5 11&quot; &quot;6 04&quot;</span></span>
<span id="cb566-5"><a href="string-processing-and-text-mining.html#cb566-5" tabindex="-1"></a></span>
<span id="cb566-6"><a href="string-processing-and-text-mining.html#cb566-6" tabindex="-1"></a>problematic_heights <span class="ot">&lt;-</span> <span class="fu">str_replace_all</span>(</span>
<span id="cb566-7"><a href="string-processing-and-text-mining.html#cb566-7" tabindex="-1"></a>                      problematic_heights, </span>
<span id="cb566-8"><a href="string-processing-and-text-mining.html#cb566-8" tabindex="-1"></a>                      <span class="st">&quot;^([4-7])</span><span class="sc">\\</span><span class="st">s+(</span><span class="sc">\\</span><span class="st">d*)</span><span class="sc">\\</span><span class="st">s*$&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&#39;</span><span class="sc">\\</span><span class="st">2&quot;</span></span>
<span id="cb566-9"><a href="string-processing-and-text-mining.html#cb566-9" tabindex="-1"></a>                   )</span>
<span id="cb566-10"><a href="string-processing-and-text-mining.html#cb566-10" tabindex="-1"></a></span>
<span id="cb566-11"><a href="string-processing-and-text-mining.html#cb566-11" tabindex="-1"></a>problematic_heights <span class="sc">|&gt;</span> </span>
<span id="cb566-12"><a href="string-processing-and-text-mining.html#cb566-12" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">30</span>)</span>
<span id="cb566-13"><a href="string-processing-and-text-mining.html#cb566-13" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;6&#39;0&quot;    &quot;5&#39;4&quot;    &quot;5.3&#39;0&quot;  &quot;165&quot;    &quot;6&#39;0&quot;    &quot;5&#39;7&quot;    &quot;&gt;9000&quot;  &quot;5&#39;7&quot;   </span></span>
<span id="cb566-14"><a href="string-processing-and-text-mining.html#cb566-14" tabindex="-1"></a><span class="co">#&gt;  [9] &quot;5&#39;3&quot;    &quot;5&#39;8.11&quot; &quot;5.25&#39;0&quot; &quot;5&#39;11&quot;   &quot;5.5&#39;0&quot;  &quot;5&#39;9&quot;    &quot;6&#39;0&quot;    &quot;6.5&#39;0&quot; </span></span>
<span id="cb566-15"><a href="string-processing-and-text-mining.html#cb566-15" tabindex="-1"></a><span class="co">#&gt; [17] &quot;5&#39;10&quot;   &quot;5.8&#39;0&quot;  &quot;5&#39;0&quot;    &quot;5.6&#39;0&quot;  &quot;5.3&#39;0&quot;  &quot;6&#39;0&quot;    &quot;6&#39;0&quot;    &quot;5.9&#39;0&quot; </span></span>
<span id="cb566-16"><a href="string-processing-and-text-mining.html#cb566-16" tabindex="-1"></a><span class="co">#&gt; [25] &quot;6.8&#39;0&quot;  &quot;5&#39;10&quot;   &quot;5.5&#39;0&quot;  &quot;6.2&#39;0&quot;  &quot;5&#39;8&quot;    &quot;6.2&#39;0&quot;</span></span></code></pre></div>
<p>We are ready to put all the patterns together and the power of patterns is that they can serve us for future exercises. Thus, we will create a function where we will place each change that we can verify to a string.</p>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="string-processing-and-text-mining.html#cb567-1" tabindex="-1"></a>format_errors <span class="ot">&lt;-</span> <span class="cf">function</span>(string){</span>
<span id="cb567-2"><a href="string-processing-and-text-mining.html#cb567-2" tabindex="-1"></a>  string <span class="sc">|&gt;</span> </span>
<span id="cb567-3"><a href="string-processing-and-text-mining.html#cb567-3" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;feet|ft|foot&quot;</span>, <span class="st">&quot;&#39;&quot;</span>) <span class="sc">|&gt;</span> <span class="co"># Change feet for &#39;</span></span>
<span id="cb567-4"><a href="string-processing-and-text-mining.html#cb567-4" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;inches|in|&#39;&#39;|</span><span class="sc">\&quot;</span><span class="st">|cm|and&quot;</span>, <span class="st">&quot;&quot;</span>) <span class="sc">|&gt;</span> <span class="co"># Remove symbols</span></span>
<span id="cb567-5"><a href="string-processing-and-text-mining.html#cb567-5" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;^([5-7])&#39;$&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&#39;0&quot;</span>) <span class="sc">|&gt;</span> <span class="co"># Adds 0 to 5&#39;, 6&#39; or 7&#39;</span></span>
<span id="cb567-6"><a href="string-processing-and-text-mining.html#cb567-6" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;^([5-7])$&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&#39;0&quot;</span>) <span class="sc">|&gt;</span> <span class="co"># Adds 0 to 5, 6 or 7</span></span>
<span id="cb567-7"><a href="string-processing-and-text-mining.html#cb567-7" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;^([4-7])</span><span class="sc">\\</span><span class="st">s*[,</span><span class="sc">\\</span><span class="st">.]</span><span class="sc">\\</span><span class="st">s*(</span><span class="sc">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1.</span><span class="sc">\\</span><span class="st">2&#39;0&quot;</span>) <span class="sc">|&gt;</span> <span class="co"># Change 5.3&#39; to 5.3&#39;0</span></span>
<span id="cb567-8"><a href="string-processing-and-text-mining.html#cb567-8" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;^([4-7]</span><span class="sc">\\</span><span class="st">.?</span><span class="sc">\\</span><span class="st">d*)</span><span class="sc">\\</span><span class="st">s*&#39;</span><span class="sc">\\</span><span class="st">s*(</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.?</span><span class="sc">\\</span><span class="st">d*)</span><span class="sc">\\</span><span class="st">s*$&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&#39;</span><span class="sc">\\</span><span class="st">2&quot;</span>) <span class="sc">|&gt;</span> <span class="co">#Removes spaces in middle</span></span>
<span id="cb567-9"><a href="string-processing-and-text-mining.html#cb567-9" tabindex="-1"></a>    <span class="fu">str_replace_all</span>(<span class="st">&quot;^([4-7])</span><span class="sc">\\</span><span class="st">s+(</span><span class="sc">\\</span><span class="st">d*)</span><span class="sc">\\</span><span class="st">s*$&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&#39;</span><span class="sc">\\</span><span class="st">2&quot;</span>) <span class="sc">|&gt;</span> <span class="co"># Adds &#39;</span></span>
<span id="cb567-10"><a href="string-processing-and-text-mining.html#cb567-10" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="st">&quot;^([12])</span><span class="sc">\\</span><span class="st">s*,</span><span class="sc">\\</span><span class="st">s*(</span><span class="sc">\\</span><span class="st">d*)$&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1.</span><span class="sc">\\</span><span class="st">2&quot;</span>) <span class="sc">|&gt;</span> <span class="co"># Changes decimals from commas to dots</span></span>
<span id="cb567-11"><a href="string-processing-and-text-mining.html#cb567-11" tabindex="-1"></a>    <span class="fu">str_trim</span>() <span class="co">#Removes spaces at start and end</span></span>
<span id="cb567-12"><a href="string-processing-and-text-mining.html#cb567-12" tabindex="-1"></a>}</span></code></pre></div>
<p>Thus, we have created two functions that could be useful to us if we were to work with surveys of the same type again.</p>
<p>Before applying it to our entire table let’s extract the values to a vector again to apply the created functions.</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="string-processing-and-text-mining.html#cb568-1" tabindex="-1"></a>problematic_heights <span class="ot">&lt;-</span> reported_heights <span class="sc">|&gt;</span> </span>
<span id="cb568-2"><a href="string-processing-and-text-mining.html#cb568-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(<span class="fu">as.numeric</span>(height)) <span class="sc">|</span> <span class="co"># Does not convert to number</span></span>
<span id="cb568-3"><a href="string-processing-and-text-mining.html#cb568-3" tabindex="-1"></a>         (<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">as.numeric</span>(height)) <span class="sc">&amp;</span> <span class="fu">as.numeric</span>(height) <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">&amp;</span></span>
<span id="cb568-4"><a href="string-processing-and-text-mining.html#cb568-4" tabindex="-1"></a>            <span class="fu">as.numeric</span>(height) <span class="sc">&lt;=</span> <span class="dv">7</span> ) <span class="co"># or entered in feet and not inches</span></span>
<span id="cb568-5"><a href="string-processing-and-text-mining.html#cb568-5" tabindex="-1"></a>        ) <span class="sc">|&gt;</span> </span>
<span id="cb568-6"><a href="string-processing-and-text-mining.html#cb568-6" tabindex="-1"></a>  <span class="fu">pull</span>(height)</span></code></pre></div>
<p>Now let’s apply the created functions:</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="string-processing-and-text-mining.html#cb569-1" tabindex="-1"></a>formatted_heights <span class="ot">&lt;-</span> problematic_heights <span class="sc">|&gt;</span> </span>
<span id="cb569-2"><a href="string-processing-and-text-mining.html#cb569-2" tabindex="-1"></a>  <span class="fu">words_to_number</span>() <span class="sc">|&gt;</span> </span>
<span id="cb569-3"><a href="string-processing-and-text-mining.html#cb569-3" tabindex="-1"></a>  <span class="fu">format_errors</span>()</span>
<span id="cb569-4"><a href="string-processing-and-text-mining.html#cb569-4" tabindex="-1"></a></span>
<span id="cb569-5"><a href="string-processing-and-text-mining.html#cb569-5" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">&quot;^([4-7]</span><span class="sc">\\</span><span class="st">.?</span><span class="sc">\\</span><span class="st">d*)</span><span class="sc">\\</span><span class="st">s*&#39;</span><span class="sc">\\</span><span class="st">s*(</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.?</span><span class="sc">\\</span><span class="st">d*)</span><span class="sc">\\</span><span class="st">s*$&quot;</span></span>
<span id="cb569-6"><a href="string-processing-and-text-mining.html#cb569-6" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(formatted_heights, pattern)</span>
<span id="cb569-7"><a href="string-processing-and-text-mining.html#cb569-7" tabindex="-1"></a>formatted_heights[<span class="sc">!</span>index] <span class="co"># Do not match the pattern</span></span>
<span id="cb569-8"><a href="string-processing-and-text-mining.html#cb569-8" tabindex="-1"></a><span class="co">#&gt;  [1] &quot;165&quot;       &quot;&gt;9000&quot;     &quot;2&#39;33&quot;      &quot;1.70&quot;      &quot;yyy&quot;       &quot;6*12&quot;     </span></span>
<span id="cb569-9"><a href="string-processing-and-text-mining.html#cb569-9" tabindex="-1"></a><span class="co">#&gt;  [7] &quot;69&quot;        &quot;708,661&quot;   &quot;649,606&quot;   &quot;728,346&quot;   &quot;170&quot;       &quot;7,283,465&quot;</span></span></code></pre></div>
<p>We have managed to reduce from 168 errors of 1095 records, 15.3% of errors, to 12 errors of 1095, 1% of errors. We can now apply to our initial table.</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb570-1"><a href="string-processing-and-text-mining.html#cb570-1" tabindex="-1"></a><span class="co"># Apply created formulas</span></span>
<span id="cb570-2"><a href="string-processing-and-text-mining.html#cb570-2" tabindex="-1"></a>heights <span class="ot">&lt;-</span> reported_heights <span class="sc">|&gt;</span> </span>
<span id="cb570-3"><a href="string-processing-and-text-mining.html#cb570-3" tabindex="-1"></a>  <span class="fu">mutate</span>(height) <span class="sc">|&gt;</span> </span>
<span id="cb570-4"><a href="string-processing-and-text-mining.html#cb570-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">height =</span> <span class="fu">words_to_number</span>(height) <span class="sc">|&gt;</span> <span class="fu">format_errors</span>())</span>
<span id="cb570-5"><a href="string-processing-and-text-mining.html#cb570-5" tabindex="-1"></a></span>
<span id="cb570-6"><a href="string-processing-and-text-mining.html#cb570-6" tabindex="-1"></a><span class="co"># Get random samples to validate quality</span></span>
<span id="cb570-7"><a href="string-processing-and-text-mining.html#cb570-7" tabindex="-1"></a>random_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(heights)) </span>
<span id="cb570-8"><a href="string-processing-and-text-mining.html#cb570-8" tabindex="-1"></a>heights[random_indices, ] <span class="sc">|&gt;</span> </span>
<span id="cb570-9"><a href="string-processing-and-text-mining.html#cb570-9" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">15</span>)</span>
<span id="cb570-10"><a href="string-processing-and-text-mining.html#cb570-10" tabindex="-1"></a><span class="co">#&gt;               time_stamp    sex height</span></span>
<span id="cb570-11"><a href="string-processing-and-text-mining.html#cb570-11" tabindex="-1"></a><span class="co">#&gt; 155  2014-09-02 15:17:12 Female     63</span></span>
<span id="cb570-12"><a href="string-processing-and-text-mining.html#cb570-12" tabindex="-1"></a><span class="co">#&gt; 426  2015-01-06 22:58:54   Male   5&#39;12</span></span>
<span id="cb570-13"><a href="string-processing-and-text-mining.html#cb570-13" tabindex="-1"></a><span class="co">#&gt; 1029 2016-07-26 13:02:34   Male     67</span></span>
<span id="cb570-14"><a href="string-processing-and-text-mining.html#cb570-14" tabindex="-1"></a><span class="co">#&gt; 326  2014-10-14 05:18:11   Male     71</span></span>
<span id="cb570-15"><a href="string-processing-and-text-mining.html#cb570-15" tabindex="-1"></a><span class="co">#&gt; 789  2016-01-25 08:15:45 Female    5&#39;5</span></span>
<span id="cb570-16"><a href="string-processing-and-text-mining.html#cb570-16" tabindex="-1"></a><span class="co">#&gt; 985  2016-04-23 17:15:26   Male   67.5</span></span>
<span id="cb570-17"><a href="string-processing-and-text-mining.html#cb570-17" tabindex="-1"></a><span class="co">#&gt; 39   2014-09-02 15:16:31   Male     72</span></span>
<span id="cb570-18"><a href="string-processing-and-text-mining.html#cb570-18" tabindex="-1"></a><span class="co">#&gt; 822  2016-01-25 21:18:33   Male     68</span></span>
<span id="cb570-19"><a href="string-processing-and-text-mining.html#cb570-19" tabindex="-1"></a><span class="co">#&gt; 986  2016-04-25 06:11:45   Male    180</span></span>
<span id="cb570-20"><a href="string-processing-and-text-mining.html#cb570-20" tabindex="-1"></a><span class="co">#&gt; 137  2014-09-02 15:17:02   Male     68</span></span>
<span id="cb570-21"><a href="string-processing-and-text-mining.html#cb570-21" tabindex="-1"></a><span class="co">#&gt; 455  2015-01-28 03:59:44   Male  5.5&#39;0</span></span>
<span id="cb570-22"><a href="string-processing-and-text-mining.html#cb570-22" tabindex="-1"></a><span class="co">#&gt; 589  2015-05-25 16:19:20   Male     69</span></span>
<span id="cb570-23"><a href="string-processing-and-text-mining.html#cb570-23" tabindex="-1"></a><span class="co">#&gt; 1089 2017-09-04 07:28:40   Male     69</span></span>
<span id="cb570-24"><a href="string-processing-and-text-mining.html#cb570-24" tabindex="-1"></a><span class="co">#&gt; 196  2014-09-02 15:18:30 Female  64.57</span></span>
<span id="cb570-25"><a href="string-processing-and-text-mining.html#cb570-25" tabindex="-1"></a><span class="co">#&gt; 680  2015-09-01 22:45:11   Male     68</span></span></code></pre></div>
<p>We still have to do some conversions. However, since they follow a determined pattern we can use the <code>extract(source_column, new_columns, pattern, remove_source)</code> function to confirm creating new columns for each value of our pattern.</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="string-processing-and-text-mining.html#cb571-1" tabindex="-1"></a>pattern <span class="ot">&lt;-</span> <span class="st">&quot;^([4-7]</span><span class="sc">\\</span><span class="st">.?</span><span class="sc">\\</span><span class="st">d*)</span><span class="sc">\\</span><span class="st">s*&#39;</span><span class="sc">\\</span><span class="st">s*(</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.?</span><span class="sc">\\</span><span class="st">d*)</span><span class="sc">\\</span><span class="st">s*$&quot;</span></span>
<span id="cb571-2"><a href="string-processing-and-text-mining.html#cb571-2" tabindex="-1"></a></span>
<span id="cb571-3"><a href="string-processing-and-text-mining.html#cb571-3" tabindex="-1"></a>heights <span class="sc">|&gt;</span> </span>
<span id="cb571-4"><a href="string-processing-and-text-mining.html#cb571-4" tabindex="-1"></a>  <span class="fu">extract</span>(height, <span class="fu">c</span>(<span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>), <span class="at">regex =</span> pattern, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb571-5"><a href="string-processing-and-text-mining.html#cb571-5" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">15</span>)</span>
<span id="cb571-6"><a href="string-processing-and-text-mining.html#cb571-6" tabindex="-1"></a><span class="co">#&gt;             time_stamp    sex height feet inches</span></span>
<span id="cb571-7"><a href="string-processing-and-text-mining.html#cb571-7" tabindex="-1"></a><span class="co">#&gt; 1  2014-09-02 13:40:36   Male     75 &lt;NA&gt;   &lt;NA&gt;</span></span>
<span id="cb571-8"><a href="string-processing-and-text-mining.html#cb571-8" tabindex="-1"></a><span class="co">#&gt; 2  2014-09-02 13:46:59   Male     70 &lt;NA&gt;   &lt;NA&gt;</span></span>
<span id="cb571-9"><a href="string-processing-and-text-mining.html#cb571-9" tabindex="-1"></a><span class="co">#&gt; 3  2014-09-02 13:59:20   Male     68 &lt;NA&gt;   &lt;NA&gt;</span></span>
<span id="cb571-10"><a href="string-processing-and-text-mining.html#cb571-10" tabindex="-1"></a><span class="co">#&gt; 4  2014-09-02 14:51:53   Male     74 &lt;NA&gt;   &lt;NA&gt;</span></span>
<span id="cb571-11"><a href="string-processing-and-text-mining.html#cb571-11" tabindex="-1"></a><span class="co">#&gt; 5  2014-09-02 15:16:15   Male     61 &lt;NA&gt;   &lt;NA&gt;</span></span>
<span id="cb571-12"><a href="string-processing-and-text-mining.html#cb571-12" tabindex="-1"></a><span class="co">#&gt; 6  2014-09-02 15:16:16 Female     65 &lt;NA&gt;   &lt;NA&gt;</span></span>
<span id="cb571-13"><a href="string-processing-and-text-mining.html#cb571-13" tabindex="-1"></a><span class="co">#&gt; 7  2014-09-02 15:16:19 Female     66 &lt;NA&gt;   &lt;NA&gt;</span></span>
<span id="cb571-14"><a href="string-processing-and-text-mining.html#cb571-14" tabindex="-1"></a><span class="co">#&gt; 8  2014-09-02 15:16:21 Female     62 &lt;NA&gt;   &lt;NA&gt;</span></span>
<span id="cb571-15"><a href="string-processing-and-text-mining.html#cb571-15" tabindex="-1"></a><span class="co">#&gt; 9  2014-09-02 15:16:21 Female     66 &lt;NA&gt;   &lt;NA&gt;</span></span>
<span id="cb571-16"><a href="string-processing-and-text-mining.html#cb571-16" tabindex="-1"></a><span class="co">#&gt; 10 2014-09-02 15:16:22   Male     67 &lt;NA&gt;   &lt;NA&gt;</span></span>
<span id="cb571-17"><a href="string-processing-and-text-mining.html#cb571-17" tabindex="-1"></a><span class="co">#&gt; 11 2014-09-02 15:16:22   Male     72 &lt;NA&gt;   &lt;NA&gt;</span></span>
<span id="cb571-18"><a href="string-processing-and-text-mining.html#cb571-18" tabindex="-1"></a><span class="co">#&gt; 12 2014-09-02 15:16:23   Male    6&#39;0    6      0</span></span>
<span id="cb571-19"><a href="string-processing-and-text-mining.html#cb571-19" tabindex="-1"></a><span class="co">#&gt; 13 2014-09-02 15:16:23   Male     69 &lt;NA&gt;   &lt;NA&gt;</span></span>
<span id="cb571-20"><a href="string-processing-and-text-mining.html#cb571-20" tabindex="-1"></a><span class="co">#&gt; 14 2014-09-02 15:16:26   Male     68 &lt;NA&gt;   &lt;NA&gt;</span></span>
<span id="cb571-21"><a href="string-processing-and-text-mining.html#cb571-21" tabindex="-1"></a><span class="co">#&gt; 15 2014-09-02 15:16:26   Male     69 &lt;NA&gt;   &lt;NA&gt;</span></span></code></pre></div>
<p>Now that we have the data that matches the pattern in two other columns, and we know they are numbers, we can convert everything to number.</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="string-processing-and-text-mining.html#cb572-1" tabindex="-1"></a>heights <span class="sc">|&gt;</span> </span>
<span id="cb572-2"><a href="string-processing-and-text-mining.html#cb572-2" tabindex="-1"></a>  <span class="fu">extract</span>(height, <span class="fu">c</span>(<span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>), <span class="at">regex =</span> pattern, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb572-3"><a href="string-processing-and-text-mining.html#cb572-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>), <span class="sc">~</span><span class="fu">as.numeric</span>(.))) <span class="sc">|&gt;</span> </span>
<span id="cb572-4"><a href="string-processing-and-text-mining.html#cb572-4" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">15</span>)</span>
<span id="cb572-5"><a href="string-processing-and-text-mining.html#cb572-5" tabindex="-1"></a><span class="co">#&gt; Warning: There was 1 warning in `mutate()`.</span></span>
<span id="cb572-6"><a href="string-processing-and-text-mining.html#cb572-6" tabindex="-1"></a><span class="co">#&gt; ℹ In argument: `across(c(&quot;height&quot;, &quot;feet&quot;, &quot;inches&quot;),</span></span>
<span id="cb572-7"><a href="string-processing-and-text-mining.html#cb572-7" tabindex="-1"></a><span class="co">#&gt;   ~as.numeric(.))`.</span></span>
<span id="cb572-8"><a href="string-processing-and-text-mining.html#cb572-8" tabindex="-1"></a><span class="co">#&gt; Caused by warning:</span></span>
<span id="cb572-9"><a href="string-processing-and-text-mining.html#cb572-9" tabindex="-1"></a><span class="co">#&gt; ! NAs introduced by coercion</span></span>
<span id="cb572-10"><a href="string-processing-and-text-mining.html#cb572-10" tabindex="-1"></a><span class="co">#&gt;             time_stamp    sex height feet inches</span></span>
<span id="cb572-11"><a href="string-processing-and-text-mining.html#cb572-11" tabindex="-1"></a><span class="co">#&gt; 1  2014-09-02 13:40:36   Male     75   NA     NA</span></span>
<span id="cb572-12"><a href="string-processing-and-text-mining.html#cb572-12" tabindex="-1"></a><span class="co">#&gt; 2  2014-09-02 13:46:59   Male     70   NA     NA</span></span>
<span id="cb572-13"><a href="string-processing-and-text-mining.html#cb572-13" tabindex="-1"></a><span class="co">#&gt; 3  2014-09-02 13:59:20   Male     68   NA     NA</span></span>
<span id="cb572-14"><a href="string-processing-and-text-mining.html#cb572-14" tabindex="-1"></a><span class="co">#&gt; 4  2014-09-02 14:51:53   Male     74   NA     NA</span></span>
<span id="cb572-15"><a href="string-processing-and-text-mining.html#cb572-15" tabindex="-1"></a><span class="co">#&gt; 5  2014-09-02 15:16:15   Male     61   NA     NA</span></span>
<span id="cb572-16"><a href="string-processing-and-text-mining.html#cb572-16" tabindex="-1"></a><span class="co">#&gt; 6  2014-09-02 15:16:16 Female     65   NA     NA</span></span>
<span id="cb572-17"><a href="string-processing-and-text-mining.html#cb572-17" tabindex="-1"></a><span class="co">#&gt; 7  2014-09-02 15:16:19 Female     66   NA     NA</span></span>
<span id="cb572-18"><a href="string-processing-and-text-mining.html#cb572-18" tabindex="-1"></a><span class="co">#&gt; 8  2014-09-02 15:16:21 Female     62   NA     NA</span></span>
<span id="cb572-19"><a href="string-processing-and-text-mining.html#cb572-19" tabindex="-1"></a><span class="co">#&gt; 9  2014-09-02 15:16:21 Female     66   NA     NA</span></span>
<span id="cb572-20"><a href="string-processing-and-text-mining.html#cb572-20" tabindex="-1"></a><span class="co">#&gt; 10 2014-09-02 15:16:22   Male     67   NA     NA</span></span>
<span id="cb572-21"><a href="string-processing-and-text-mining.html#cb572-21" tabindex="-1"></a><span class="co">#&gt; 11 2014-09-02 15:16:22   Male     72   NA     NA</span></span>
<span id="cb572-22"><a href="string-processing-and-text-mining.html#cb572-22" tabindex="-1"></a><span class="co">#&gt; 12 2014-09-02 15:16:23   Male     NA    6      0</span></span>
<span id="cb572-23"><a href="string-processing-and-text-mining.html#cb572-23" tabindex="-1"></a><span class="co">#&gt; 13 2014-09-02 15:16:23   Male     69   NA     NA</span></span>
<span id="cb572-24"><a href="string-processing-and-text-mining.html#cb572-24" tabindex="-1"></a><span class="co">#&gt; 14 2014-09-02 15:16:26   Male     68   NA     NA</span></span>
<span id="cb572-25"><a href="string-processing-and-text-mining.html#cb572-25" tabindex="-1"></a><span class="co">#&gt; 15 2014-09-02 15:16:26   Male     69   NA     NA</span></span></code></pre></div>
<p>Now that our columns are numeric we can perform operations to calculate height.</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="string-processing-and-text-mining.html#cb573-1" tabindex="-1"></a>heights <span class="sc">|&gt;</span> </span>
<span id="cb573-2"><a href="string-processing-and-text-mining.html#cb573-2" tabindex="-1"></a>  <span class="fu">extract</span>(height, <span class="fu">c</span>(<span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>), <span class="at">regex =</span> pattern, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb573-3"><a href="string-processing-and-text-mining.html#cb573-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>), <span class="sc">~</span><span class="fu">as.numeric</span>(.))) <span class="sc">|&gt;</span> </span>
<span id="cb573-4"><a href="string-processing-and-text-mining.html#cb573-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fixed_heights =</span> feet<span class="sc">*</span><span class="dv">12</span> <span class="sc">+</span> inches) <span class="sc">|&gt;</span> </span>
<span id="cb573-5"><a href="string-processing-and-text-mining.html#cb573-5" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">15</span>)</span>
<span id="cb573-6"><a href="string-processing-and-text-mining.html#cb573-6" tabindex="-1"></a><span class="co">#&gt; Warning: There was 1 warning in `mutate()`.</span></span>
<span id="cb573-7"><a href="string-processing-and-text-mining.html#cb573-7" tabindex="-1"></a><span class="co">#&gt; ℹ In argument: `across(c(&quot;height&quot;, &quot;feet&quot;, &quot;inches&quot;),</span></span>
<span id="cb573-8"><a href="string-processing-and-text-mining.html#cb573-8" tabindex="-1"></a><span class="co">#&gt;   ~as.numeric(.))`.</span></span>
<span id="cb573-9"><a href="string-processing-and-text-mining.html#cb573-9" tabindex="-1"></a><span class="co">#&gt; Caused by warning:</span></span>
<span id="cb573-10"><a href="string-processing-and-text-mining.html#cb573-10" tabindex="-1"></a><span class="co">#&gt; ! NAs introduced by coercion</span></span>
<span id="cb573-11"><a href="string-processing-and-text-mining.html#cb573-11" tabindex="-1"></a><span class="co">#&gt;             time_stamp    sex height feet inches fixed_heights</span></span>
<span id="cb573-12"><a href="string-processing-and-text-mining.html#cb573-12" tabindex="-1"></a><span class="co">#&gt; 1  2014-09-02 13:40:36   Male     75   NA     NA            NA</span></span>
<span id="cb573-13"><a href="string-processing-and-text-mining.html#cb573-13" tabindex="-1"></a><span class="co">#&gt; 2  2014-09-02 13:46:59   Male     70   NA     NA            NA</span></span>
<span id="cb573-14"><a href="string-processing-and-text-mining.html#cb573-14" tabindex="-1"></a><span class="co">#&gt; 3  2014-09-02 13:59:20   Male     68   NA     NA            NA</span></span>
<span id="cb573-15"><a href="string-processing-and-text-mining.html#cb573-15" tabindex="-1"></a><span class="co">#&gt; 4  2014-09-02 14:51:53   Male     74   NA     NA            NA</span></span>
<span id="cb573-16"><a href="string-processing-and-text-mining.html#cb573-16" tabindex="-1"></a><span class="co">#&gt; 5  2014-09-02 15:16:15   Male     61   NA     NA            NA</span></span>
<span id="cb573-17"><a href="string-processing-and-text-mining.html#cb573-17" tabindex="-1"></a><span class="co">#&gt; 6  2014-09-02 15:16:16 Female     65   NA     NA            NA</span></span>
<span id="cb573-18"><a href="string-processing-and-text-mining.html#cb573-18" tabindex="-1"></a><span class="co">#&gt; 7  2014-09-02 15:16:19 Female     66   NA     NA            NA</span></span>
<span id="cb573-19"><a href="string-processing-and-text-mining.html#cb573-19" tabindex="-1"></a><span class="co">#&gt; 8  2014-09-02 15:16:21 Female     62   NA     NA            NA</span></span>
<span id="cb573-20"><a href="string-processing-and-text-mining.html#cb573-20" tabindex="-1"></a><span class="co">#&gt; 9  2014-09-02 15:16:21 Female     66   NA     NA            NA</span></span>
<span id="cb573-21"><a href="string-processing-and-text-mining.html#cb573-21" tabindex="-1"></a><span class="co">#&gt; 10 2014-09-02 15:16:22   Male     67   NA     NA            NA</span></span>
<span id="cb573-22"><a href="string-processing-and-text-mining.html#cb573-22" tabindex="-1"></a><span class="co">#&gt; 11 2014-09-02 15:16:22   Male     72   NA     NA            NA</span></span>
<span id="cb573-23"><a href="string-processing-and-text-mining.html#cb573-23" tabindex="-1"></a><span class="co">#&gt; 12 2014-09-02 15:16:23   Male     NA    6      0            72</span></span>
<span id="cb573-24"><a href="string-processing-and-text-mining.html#cb573-24" tabindex="-1"></a><span class="co">#&gt; 13 2014-09-02 15:16:23   Male     69   NA     NA            NA</span></span>
<span id="cb573-25"><a href="string-processing-and-text-mining.html#cb573-25" tabindex="-1"></a><span class="co">#&gt; 14 2014-09-02 15:16:26   Male     68   NA     NA            NA</span></span>
<span id="cb573-26"><a href="string-processing-and-text-mining.html#cb573-26" tabindex="-1"></a><span class="co">#&gt; 15 2014-09-02 15:16:26   Male     69   NA     NA            NA</span></span></code></pre></div>
<p>Finally, we will do a validation of whether the height is in an interval and/or if it was expressed in centimeters or meters.</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="string-processing-and-text-mining.html#cb574-1" tabindex="-1"></a><span class="co"># We assume for a person a minimum 50&quot; (1.2m) and max 84&quot; (2.1m)</span></span>
<span id="cb574-2"><a href="string-processing-and-text-mining.html#cb574-2" tabindex="-1"></a>min <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb574-3"><a href="string-processing-and-text-mining.html#cb574-3" tabindex="-1"></a>max <span class="ot">&lt;-</span> <span class="dv">84</span></span>
<span id="cb574-4"><a href="string-processing-and-text-mining.html#cb574-4" tabindex="-1"></a></span>
<span id="cb574-5"><a href="string-processing-and-text-mining.html#cb574-5" tabindex="-1"></a>heights <span class="ot">&lt;-</span> heights <span class="sc">|&gt;</span> </span>
<span id="cb574-6"><a href="string-processing-and-text-mining.html#cb574-6" tabindex="-1"></a>  <span class="fu">extract</span>(height, <span class="fu">c</span>(<span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>), <span class="at">regex =</span> pattern, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb574-7"><a href="string-processing-and-text-mining.html#cb574-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="st">&quot;height&quot;</span>, <span class="st">&quot;feet&quot;</span>, <span class="st">&quot;inches&quot;</span>), <span class="sc">~</span><span class="fu">as.numeric</span>(.))) <span class="sc">|&gt;</span> </span>
<span id="cb574-8"><a href="string-processing-and-text-mining.html#cb574-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fixed_heights =</span> feet<span class="sc">*</span><span class="dv">12</span> <span class="sc">+</span> inches) <span class="sc">|&gt;</span> </span>
<span id="cb574-9"><a href="string-processing-and-text-mining.html#cb574-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">final_height =</span> <span class="fu">case_when</span>(</span>
<span id="cb574-10"><a href="string-processing-and-text-mining.html#cb574-10" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(height) <span class="sc">&amp;</span> <span class="fu">between</span>(height, min, max) <span class="sc">~</span> height, <span class="co">#inches </span></span>
<span id="cb574-11"><a href="string-processing-and-text-mining.html#cb574-11" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(height) <span class="sc">&amp;</span> <span class="fu">between</span>(height<span class="sc">/</span><span class="fl">2.54</span>, min, max) <span class="sc">~</span> height<span class="sc">/</span><span class="fl">2.54</span>, <span class="co">#cm</span></span>
<span id="cb574-12"><a href="string-processing-and-text-mining.html#cb574-12" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(height) <span class="sc">&amp;</span> <span class="fu">between</span>(height<span class="sc">*</span><span class="dv">100</span><span class="sc">/</span><span class="fl">2.54</span>, min, max) <span class="sc">~</span> height<span class="sc">*</span><span class="dv">100</span><span class="sc">/</span><span class="fl">2.54</span>, <span class="co">#meters</span></span>
<span id="cb574-13"><a href="string-processing-and-text-mining.html#cb574-13" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(fixed_heights) <span class="sc">&amp;</span> inches <span class="sc">&lt;</span> <span class="dv">12</span> <span class="sc">&amp;</span> </span>
<span id="cb574-14"><a href="string-processing-and-text-mining.html#cb574-14" tabindex="-1"></a>      <span class="fu">between</span>(fixed_heights, min, max) <span class="sc">~</span> fixed_heights, <span class="co">#feet&#39;inches</span></span>
<span id="cb574-15"><a href="string-processing-and-text-mining.html#cb574-15" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.numeric</span>(<span class="cn">NA</span>)))</span>
<span id="cb574-16"><a href="string-processing-and-text-mining.html#cb574-16" tabindex="-1"></a><span class="co">#&gt; Warning: There was 1 warning in `mutate()`.</span></span>
<span id="cb574-17"><a href="string-processing-and-text-mining.html#cb574-17" tabindex="-1"></a><span class="co">#&gt; ℹ In argument: `across(c(&quot;height&quot;, &quot;feet&quot;, &quot;inches&quot;),</span></span>
<span id="cb574-18"><a href="string-processing-and-text-mining.html#cb574-18" tabindex="-1"></a><span class="co">#&gt;   ~as.numeric(.))`.</span></span>
<span id="cb574-19"><a href="string-processing-and-text-mining.html#cb574-19" tabindex="-1"></a><span class="co">#&gt; Caused by warning:</span></span>
<span id="cb574-20"><a href="string-processing-and-text-mining.html#cb574-20" tabindex="-1"></a><span class="co">#&gt; ! NAs introduced by coercion</span></span>
<span id="cb574-21"><a href="string-processing-and-text-mining.html#cb574-21" tabindex="-1"></a></span>
<span id="cb574-22"><a href="string-processing-and-text-mining.html#cb574-22" tabindex="-1"></a><span class="co"># Random Sample:</span></span>
<span id="cb574-23"><a href="string-processing-and-text-mining.html#cb574-23" tabindex="-1"></a>random_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(heights)) </span>
<span id="cb574-24"><a href="string-processing-and-text-mining.html#cb574-24" tabindex="-1"></a>heights[random_indices, ] <span class="sc">|&gt;</span> </span>
<span id="cb574-25"><a href="string-processing-and-text-mining.html#cb574-25" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>time_stamp) <span class="sc">|&gt;</span> <span class="co"># Shows all columns except time_stamp</span></span>
<span id="cb574-26"><a href="string-processing-and-text-mining.html#cb574-26" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb574-27"><a href="string-processing-and-text-mining.html#cb574-27" tabindex="-1"></a><span class="co">#&gt;         sex   height feet inches fixed_heights final_height</span></span>
<span id="cb574-28"><a href="string-processing-and-text-mining.html#cb574-28" tabindex="-1"></a><span class="co">#&gt; 201  Female 67.00000   NA     NA            NA     67.00000</span></span>
<span id="cb574-29"><a href="string-processing-and-text-mining.html#cb574-29" tabindex="-1"></a><span class="co">#&gt; 1006   Male 68.11024   NA     NA            NA     68.11024</span></span>
<span id="cb574-30"><a href="string-processing-and-text-mining.html#cb574-30" tabindex="-1"></a><span class="co">#&gt; 651    Male 70.00000   NA     NA            NA     70.00000</span></span>
<span id="cb574-31"><a href="string-processing-and-text-mining.html#cb574-31" tabindex="-1"></a><span class="co">#&gt; 545    Male 68.00000   NA     NA            NA     68.00000</span></span>
<span id="cb574-32"><a href="string-processing-and-text-mining.html#cb574-32" tabindex="-1"></a><span class="co">#&gt; 617    Male 69.00000   NA     NA            NA     69.00000</span></span>
<span id="cb574-33"><a href="string-processing-and-text-mining.html#cb574-33" tabindex="-1"></a><span class="co">#&gt; 17     Male 75.00000   NA     NA            NA     75.00000</span></span>
<span id="cb574-34"><a href="string-processing-and-text-mining.html#cb574-34" tabindex="-1"></a><span class="co">#&gt; 102  Female 71.00000   NA     NA            NA     71.00000</span></span>
<span id="cb574-35"><a href="string-processing-and-text-mining.html#cb574-35" tabindex="-1"></a><span class="co">#&gt; 71     Male 73.00000   NA     NA            NA     73.00000</span></span>
<span id="cb574-36"><a href="string-processing-and-text-mining.html#cb574-36" tabindex="-1"></a><span class="co">#&gt; 80   Female 72.00000   NA     NA            NA     72.00000</span></span>
<span id="cb574-37"><a href="string-processing-and-text-mining.html#cb574-37" tabindex="-1"></a><span class="co">#&gt; 643    Male 72.00000   NA     NA            NA     72.00000</span></span></code></pre></div>
<p>We already have our sample validated, we would only have to take the columns we need and start using the object for the analyses we need.</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb575-1"><a href="string-processing-and-text-mining.html#cb575-1" tabindex="-1"></a>final_heights <span class="ot">&lt;-</span> heights <span class="sc">|&gt;</span> </span>
<span id="cb575-2"><a href="string-processing-and-text-mining.html#cb575-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">gender =</span> sex, <span class="at">heights =</span> final_height)</span>
<span id="cb575-3"><a href="string-processing-and-text-mining.html#cb575-3" tabindex="-1"></a></span>
<span id="cb575-4"><a href="string-processing-and-text-mining.html#cb575-4" tabindex="-1"></a>final_heights <span class="sc">|&gt;</span> </span>
<span id="cb575-5"><a href="string-processing-and-text-mining.html#cb575-5" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb575-6"><a href="string-processing-and-text-mining.html#cb575-6" tabindex="-1"></a><span class="co">#&gt;    gender heights</span></span>
<span id="cb575-7"><a href="string-processing-and-text-mining.html#cb575-7" tabindex="-1"></a><span class="co">#&gt; 1    Male      75</span></span>
<span id="cb575-8"><a href="string-processing-and-text-mining.html#cb575-8" tabindex="-1"></a><span class="co">#&gt; 2    Male      70</span></span>
<span id="cb575-9"><a href="string-processing-and-text-mining.html#cb575-9" tabindex="-1"></a><span class="co">#&gt; 3    Male      68</span></span>
<span id="cb575-10"><a href="string-processing-and-text-mining.html#cb575-10" tabindex="-1"></a><span class="co">#&gt; 4    Male      74</span></span>
<span id="cb575-11"><a href="string-processing-and-text-mining.html#cb575-11" tabindex="-1"></a><span class="co">#&gt; 5    Male      61</span></span>
<span id="cb575-12"><a href="string-processing-and-text-mining.html#cb575-12" tabindex="-1"></a><span class="co">#&gt; 6  Female      65</span></span>
<span id="cb575-13"><a href="string-processing-and-text-mining.html#cb575-13" tabindex="-1"></a><span class="co">#&gt; 7  Female      66</span></span>
<span id="cb575-14"><a href="string-processing-and-text-mining.html#cb575-14" tabindex="-1"></a><span class="co">#&gt; 8  Female      62</span></span>
<span id="cb575-15"><a href="string-processing-and-text-mining.html#cb575-15" tabindex="-1"></a><span class="co">#&gt; 9  Female      66</span></span>
<span id="cb575-16"><a href="string-processing-and-text-mining.html#cb575-16" tabindex="-1"></a><span class="co">#&gt; 10   Male      67</span></span></code></pre></div>
</div>
</div>
<div id="from-strings-to-dates" class="section level2 hasAnchor" number="13.3">
<h2><span class="header-section-number">13.3</span> From strings to dates<a href="string-processing-and-text-mining.html#from-strings-to-dates" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Regularly when we import data, we are not only going to want to transform numeric data. We will also have multiple cases where we need to transform our string to a date in some particular format. For this, we will use the <code>lubridate</code> library, included in <code>tidyverse</code>, which provides us with diverse functions to make date treatment more accessible.</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="string-processing-and-text-mining.html#cb576-1" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
<p>When the text string is in the ISO 8601 date format (YYYY-MM-DD), we can directly use the <code>month()</code>, <code>day()</code>, <code>year()</code> function.</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="string-processing-and-text-mining.html#cb577-1" tabindex="-1"></a>dates_char <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;2010-05-19&quot;</span>, <span class="st">&quot;2020-05-06&quot;</span>, <span class="st">&quot;2010-02-03&quot;</span>)</span>
<span id="cb577-2"><a href="string-processing-and-text-mining.html#cb577-2" tabindex="-1"></a></span>
<span id="cb577-3"><a href="string-processing-and-text-mining.html#cb577-3" tabindex="-1"></a><span class="fu">str</span>(dates_char)</span>
<span id="cb577-4"><a href="string-processing-and-text-mining.html#cb577-4" tabindex="-1"></a><span class="co">#&gt;  chr [1:3] &quot;2010-05-19&quot; &quot;2020-05-06&quot; &quot;2010-02-03&quot;</span></span>
<span id="cb577-5"><a href="string-processing-and-text-mining.html#cb577-5" tabindex="-1"></a></span>
<span id="cb577-6"><a href="string-processing-and-text-mining.html#cb577-6" tabindex="-1"></a><span class="fu">month</span>(dates_char)</span>
<span id="cb577-7"><a href="string-processing-and-text-mining.html#cb577-7" tabindex="-1"></a><span class="co">#&gt; [1] 5 5 2</span></span></code></pre></div>
<p>However, we do not always have the date in that format and <code>lubridate()</code> gives other functions that are more flexible when coercing data. Look at this example:</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="string-processing-and-text-mining.html#cb578-1" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">20090101</span>, <span class="st">&quot;2009-01-02&quot;</span>, <span class="st">&quot;2009 01 03&quot;</span>, <span class="st">&quot;2009-1-4&quot;</span>,</span>
<span id="cb578-2"><a href="string-processing-and-text-mining.html#cb578-2" tabindex="-1"></a>       <span class="st">&quot;2009-1, 5&quot;</span>, <span class="st">&quot;Created on 2009 1 6&quot;</span>, <span class="st">&quot;200901 !!! 07&quot;</span>)</span>
<span id="cb578-3"><a href="string-processing-and-text-mining.html#cb578-3" tabindex="-1"></a></span>
<span id="cb578-4"><a href="string-processing-and-text-mining.html#cb578-4" tabindex="-1"></a><span class="fu">str</span>(dates)</span>
<span id="cb578-5"><a href="string-processing-and-text-mining.html#cb578-5" tabindex="-1"></a><span class="co">#&gt;  chr [1:7] &quot;20090101&quot; &quot;2009-01-02&quot; &quot;2009 01 03&quot; &quot;2009-1-4&quot; &quot;2009-1, 5&quot; ...</span></span>
<span id="cb578-6"><a href="string-processing-and-text-mining.html#cb578-6" tabindex="-1"></a></span>
<span id="cb578-7"><a href="string-processing-and-text-mining.html#cb578-7" tabindex="-1"></a><span class="fu">ymd</span>(dates)</span>
<span id="cb578-8"><a href="string-processing-and-text-mining.html#cb578-8" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2009-01-01&quot; &quot;2009-01-02&quot; &quot;2009-01-03&quot; &quot;2009-01-04&quot; &quot;2009-01-05&quot;</span></span>
<span id="cb578-9"><a href="string-processing-and-text-mining.html#cb578-9" tabindex="-1"></a><span class="co">#&gt; [6] &quot;2009-01-06&quot; &quot;2009-01-07&quot;</span></span></code></pre></div>
<p>The first data entered was a number, but we already know that it coerces it to text. Then, we have different values entered, but all follow the same pattern. First is the year, then the month and then the day. When we know that first is the year, then month and then day we will use the <code>ymd()</code> function to convert all dates to ISO 8601 format.</p>
<p>In the same way, we will have the following functions that we can use depending on the form in which we have the date from our source. In all cases it will be convenient for us to convert to ISO 8601 format. For example here we can see when it correctly recognizes the format and when the formatting fails.</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="string-processing-and-text-mining.html#cb579-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">&quot;28/03/89&quot;</span></span>
<span id="cb579-2"><a href="string-processing-and-text-mining.html#cb579-2" tabindex="-1"></a><span class="fu">ymd</span>(x)</span>
<span id="cb579-3"><a href="string-processing-and-text-mining.html#cb579-3" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb579-4"><a href="string-processing-and-text-mining.html#cb579-4" tabindex="-1"></a><span class="fu">mdy</span>(x)</span>
<span id="cb579-5"><a href="string-processing-and-text-mining.html#cb579-5" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb579-6"><a href="string-processing-and-text-mining.html#cb579-6" tabindex="-1"></a><span class="fu">ydm</span>(x)</span>
<span id="cb579-7"><a href="string-processing-and-text-mining.html#cb579-7" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb579-8"><a href="string-processing-and-text-mining.html#cb579-8" tabindex="-1"></a><span class="fu">myd</span>(x)</span>
<span id="cb579-9"><a href="string-processing-and-text-mining.html#cb579-9" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb579-10"><a href="string-processing-and-text-mining.html#cb579-10" tabindex="-1"></a><span class="fu">dmy</span>(x)</span>
<span id="cb579-11"><a href="string-processing-and-text-mining.html#cb579-11" tabindex="-1"></a><span class="co">#&gt; [1] &quot;1989-03-28&quot;</span></span>
<span id="cb579-12"><a href="string-processing-and-text-mining.html#cb579-12" tabindex="-1"></a><span class="fu">dym</span>(x)</span>
<span id="cb579-13"><a href="string-processing-and-text-mining.html#cb579-13" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span></code></pre></div>
<p>Finally, in the same way that we can use these functions of days, months and years, we can also use to refer to hours, minutes and seconds.</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="string-processing-and-text-mining.html#cb580-1" tabindex="-1"></a><span class="co"># Format with hours, minutes and seconds</span></span>
<span id="cb580-2"><a href="string-processing-and-text-mining.html#cb580-2" tabindex="-1"></a>date_val <span class="ot">&lt;-</span> <span class="st">&quot;Feb/2/2012 12:34:56&quot;</span></span>
<span id="cb580-3"><a href="string-processing-and-text-mining.html#cb580-3" tabindex="-1"></a><span class="fu">mdy_hms</span>(date_val)</span>
<span id="cb580-4"><a href="string-processing-and-text-mining.html#cb580-4" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2012-02-02 12:34:56 UTC&quot;</span></span>
<span id="cb580-5"><a href="string-processing-and-text-mining.html#cb580-5" tabindex="-1"></a></span>
<span id="cb580-6"><a href="string-processing-and-text-mining.html#cb580-6" tabindex="-1"></a><span class="co"># Additional data: Showing system date:</span></span>
<span id="cb580-7"><a href="string-processing-and-text-mining.html#cb580-7" tabindex="-1"></a><span class="fu">now</span>()</span>
<span id="cb580-8"><a href="string-processing-and-text-mining.html#cb580-8" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2025-12-25 16:09:37 GMT&quot;</span></span></code></pre></div>
</div>
<div id="exercises-19" class="section level2 hasAnchor" number="13.4">
<h2><span class="header-section-number">13.4</span> Exercises<a href="string-processing-and-text-mining.html#exercises-19" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before solving the following exercise run this Script:</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="string-processing-and-text-mining.html#cb581-1" tabindex="-1"></a>sales <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb581-2"><a href="string-processing-and-text-mining.html#cb581-2" tabindex="-1"></a>  <span class="at">month =</span> <span class="fu">c</span>(<span class="st">&quot;April&quot;</span>, <span class="st">&quot;May&quot;</span>, <span class="st">&quot;June&quot;</span>),</span>
<span id="cb581-3"><a href="string-processing-and-text-mining.html#cb581-3" tabindex="-1"></a>  <span class="at">revenue =</span> <span class="fu">c</span>(<span class="st">&quot;s/32,124&quot;</span>, <span class="st">&quot;s/35,465&quot;</span>, <span class="st">&quot;S/38,332&quot;</span>),</span>
<span id="cb581-4"><a href="string-processing-and-text-mining.html#cb581-4" tabindex="-1"></a>  <span class="at">profit =</span> <span class="fu">c</span>(<span class="st">&quot;s/8,120&quot;</span>, <span class="st">&quot;s/9,432&quot;</span>, <span class="st">&quot;s/10,543&quot;</span>)</span>
<span id="cb581-5"><a href="string-processing-and-text-mining.html#cb581-5" tabindex="-1"></a>)</span></code></pre></div>
<ol start="113" style="list-style-type: decimal">
<li>Convert the <code>revenue</code> and <code>profit</code> columns in the <code>sales</code> object to numeric values, removing any currency symbols or formatting characters.</li>
</ol>
<details>
<summary type="button">
Solution
</summary>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="string-processing-and-text-mining.html#cb582-1" tabindex="-1"></a><span class="co"># Solution 1</span></span>
<span id="cb582-2"><a href="string-processing-and-text-mining.html#cb582-2" tabindex="-1"></a>sales <span class="sc">|&gt;</span> </span>
<span id="cb582-3"><a href="string-processing-and-text-mining.html#cb582-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), <span class="sc">~</span><span class="fu">parse_number</span>(.)))</span>
<span id="cb582-4"><a href="string-processing-and-text-mining.html#cb582-4" tabindex="-1"></a></span>
<span id="cb582-5"><a href="string-processing-and-text-mining.html#cb582-5" tabindex="-1"></a><span class="co"># Alternative solution, longer</span></span>
<span id="cb582-6"><a href="string-processing-and-text-mining.html#cb582-6" tabindex="-1"></a>sales <span class="sc">|&gt;</span></span>
<span id="cb582-7"><a href="string-processing-and-text-mining.html#cb582-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), <span class="sc">~</span><span class="fu">str_replace_all</span>(., <span class="st">&quot;</span><span class="sc">\\</span><span class="st">S/|,&quot;</span>, <span class="st">&quot;&quot;</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb582-8"><a href="string-processing-and-text-mining.html#cb582-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), <span class="sc">~</span><span class="fu">as.numeric</span>(.)))</span></code></pre></div>
</details>
<ol start="114" style="list-style-type: decimal">
<li>Clean the <code>universities</code> vector so that all university names are standardized. Specifically, replace abbreviations like “Univ.” or “U.” at the beginning of the string with the full word “University”.</li>
</ol>
<details>
<summary type="button">
Solution
</summary>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="string-processing-and-text-mining.html#cb583-1" tabindex="-1"></a>universities <span class="sc">|&gt;</span> </span>
<span id="cb583-2"><a href="string-processing-and-text-mining.html#cb583-2" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="st">&quot;^Univ</span><span class="sc">\\</span><span class="st">.?</span><span class="sc">\\</span><span class="st">s|^U</span><span class="sc">\\</span><span class="st">.?</span><span class="sc">\\</span><span class="st">s&quot;</span>, <span class="st">&quot;University &quot;</span>)</span></code></pre></div>
</details>
<p>For the following exercises, we are going to work on the survey data conducted prior to Brexit in the UK. Run the Script first:</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="string-processing-and-text-mining.html#cb584-1" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb584-2"><a href="string-processing-and-text-mining.html#cb584-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb584-3"><a href="string-processing-and-text-mining.html#cb584-3" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://en.wikipedia.org/w/index.php?title=Opinion_polling_for_the_United_Kingdom_European_Union_membership_referendum&amp;oldid=896735054&quot;</span></span>
<span id="cb584-4"><a href="string-processing-and-text-mining.html#cb584-4" tabindex="-1"></a>table_html <span class="ot">&lt;-</span> <span class="fu">read_html</span>(url) <span class="sc">|&gt;</span> <span class="fu">html_nodes</span>(<span class="st">&quot;table&quot;</span>)</span>
<span id="cb584-5"><a href="string-processing-and-text-mining.html#cb584-5" tabindex="-1"></a>polls <span class="ot">&lt;-</span> table_html[[<span class="dv">5</span>]] <span class="sc">|&gt;</span> <span class="fu">html_table</span>(<span class="at">fill =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<ol start="115" style="list-style-type: decimal">
<li>Update the <code>polls</code> object by renaming columns to <code>c("date", "remain", "leave", "undecided", "spread", "sample", "pollster", "type", "notes")</code>. Then, filter the dataset to retain only rows where the <code>remain</code> column contains a percentage symbol (“%”).</li>
</ol>
<details>
<summary type="button">
Solution
</summary>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="string-processing-and-text-mining.html#cb585-1" tabindex="-1"></a><span class="fu">names</span>(polls) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;remain&quot;</span>, <span class="st">&quot;leave&quot;</span>, <span class="st">&quot;undecided&quot;</span>, <span class="st">&quot;spread&quot;</span>,</span>
<span id="cb585-2"><a href="string-processing-and-text-mining.html#cb585-2" tabindex="-1"></a>                  <span class="st">&quot;sample&quot;</span>, <span class="st">&quot;pollster&quot;</span>, <span class="st">&quot;type&quot;</span>, <span class="st">&quot;notes&quot;</span>)</span>
<span id="cb585-3"><a href="string-processing-and-text-mining.html#cb585-3" tabindex="-1"></a>polls <span class="ot">&lt;-</span> polls[<span class="fu">str_detect</span>(polls<span class="sc">$</span>remain, <span class="st">&quot;%&quot;</span>), ]</span>
<span id="cb585-4"><a href="string-processing-and-text-mining.html#cb585-4" tabindex="-1"></a>polls </span>
<span id="cb585-5"><a href="string-processing-and-text-mining.html#cb585-5" tabindex="-1"></a></span>
<span id="cb585-6"><a href="string-processing-and-text-mining.html#cb585-6" tabindex="-1"></a><span class="co"># If we want to validate the number of polls:</span></span>
<span id="cb585-7"><a href="string-processing-and-text-mining.html#cb585-7" tabindex="-1"></a><span class="fu">nrow</span>(polls)</span></code></pre></div>
</details>
<ol start="116" style="list-style-type: decimal">
<li>Extract the <code>remain</code> column into a vector and convert the text percentages into proper numeric probabilities (e.g., convert “50%” to 0.5).</li>
</ol>
<details>
<summary type="button">
Solution
</summary>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="string-processing-and-text-mining.html#cb586-1" tabindex="-1"></a>remain <span class="ot">&lt;-</span> polls<span class="sc">$</span>remain</span>
<span id="cb586-2"><a href="string-processing-and-text-mining.html#cb586-2" tabindex="-1"></a></span>
<span id="cb586-3"><a href="string-processing-and-text-mining.html#cb586-3" tabindex="-1"></a><span class="co"># Solution 1:</span></span>
<span id="cb586-4"><a href="string-processing-and-text-mining.html#cb586-4" tabindex="-1"></a>percentages <span class="ot">&lt;-</span> <span class="fu">parse_number</span>(remain)<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb586-5"><a href="string-processing-and-text-mining.html#cb586-5" tabindex="-1"></a></span>
<span id="cb586-6"><a href="string-processing-and-text-mining.html#cb586-6" tabindex="-1"></a><span class="co"># Solution 1:</span></span>
<span id="cb586-7"><a href="string-processing-and-text-mining.html#cb586-7" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">str_replace</span>(remain, <span class="st">&quot;%&quot;</span>, <span class="st">&quot;&quot;</span>)</span>
<span id="cb586-8"><a href="string-processing-and-text-mining.html#cb586-8" tabindex="-1"></a>percentages <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(temp)<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb586-9"><a href="string-processing-and-text-mining.html#cb586-9" tabindex="-1"></a></span>
<span id="cb586-10"><a href="string-processing-and-text-mining.html#cb586-10" tabindex="-1"></a><span class="co"># Solution 2:</span></span>
<span id="cb586-11"><a href="string-processing-and-text-mining.html#cb586-11" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">str_remove</span>(remain, <span class="st">&quot;%&quot;</span>)</span>
<span id="cb586-12"><a href="string-processing-and-text-mining.html#cb586-12" tabindex="-1"></a>percentages <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(temp)<span class="sc">/</span><span class="dv">100</span></span></code></pre></div>
</details>
<ol start="117" style="list-style-type: decimal">
<li>In the <code>undecided</code> column, the value “N/A” appears when the sum of <code>remain</code> and <code>leave</code> equals 100%. Create a vector for <code>undecided</code> where these “N/A” values are replaced with “0%”.</li>
</ol>
<details>
<summary type="button">
Solution
</summary>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb587-1"><a href="string-processing-and-text-mining.html#cb587-1" tabindex="-1"></a>undecided <span class="ot">&lt;-</span> polls<span class="sc">$</span>undecided</span>
<span id="cb587-2"><a href="string-processing-and-text-mining.html#cb587-2" tabindex="-1"></a></span>
<span id="cb587-3"><a href="string-processing-and-text-mining.html#cb587-3" tabindex="-1"></a><span class="fu">str_replace</span>(undecided, <span class="st">&quot;N/A&quot;</span>, <span class="st">&quot;0%&quot;</span>)</span></code></pre></div>
</details>
<ol start="118" style="list-style-type: decimal">
<li>encapsulate your cleaning logic into a single function named <code>format_percentage(string)</code>. Test this function with the vector <code>c("13.5%", "N/A", "10%")</code> to verify it handles both percentages and “N/A” values correctly.</li>
</ol>
<details>
<summary type="button">
Solution
</summary>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="string-processing-and-text-mining.html#cb588-1" tabindex="-1"></a></span>
<span id="cb588-2"><a href="string-processing-and-text-mining.html#cb588-2" tabindex="-1"></a>format_percentage <span class="ot">&lt;-</span> <span class="cf">function</span>(string){</span>
<span id="cb588-3"><a href="string-processing-and-text-mining.html#cb588-3" tabindex="-1"></a>  string <span class="sc">|&gt;</span> </span>
<span id="cb588-4"><a href="string-processing-and-text-mining.html#cb588-4" tabindex="-1"></a>    <span class="fu">str_replace</span>(<span class="st">&quot;N/A&quot;</span>, <span class="st">&quot;0%&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb588-5"><a href="string-processing-and-text-mining.html#cb588-5" tabindex="-1"></a>    <span class="fu">parse_number</span>()<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb588-6"><a href="string-processing-and-text-mining.html#cb588-6" tabindex="-1"></a>}</span>
<span id="cb588-7"><a href="string-processing-and-text-mining.html#cb588-7" tabindex="-1"></a></span>
<span id="cb588-8"><a href="string-processing-and-text-mining.html#cb588-8" tabindex="-1"></a><span class="co"># Function test:</span></span>
<span id="cb588-9"><a href="string-processing-and-text-mining.html#cb588-9" tabindex="-1"></a>test_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;13.5%&quot;</span>, <span class="st">&quot;N/A&quot;</span>, <span class="st">&quot;10%&quot;</span>)</span>
<span id="cb588-10"><a href="string-processing-and-text-mining.html#cb588-10" tabindex="-1"></a></span>
<span id="cb588-11"><a href="string-processing-and-text-mining.html#cb588-11" tabindex="-1"></a><span class="fu">format_percentage</span>(test_vec)</span></code></pre></div>
</details>
<ol start="119" style="list-style-type: decimal">
<li>Apply <code>format_percentage</code> to the <code>remain</code>, <code>leave</code>, <code>undecided</code>, and <code>spread</code> columns in the <code>polls</code> dataset. Also, ensure the <code>sample</code> column is converted to a numeric type.</li>
</ol>
<details>
<summary type="button">
Solution
</summary>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb589-1"><a href="string-processing-and-text-mining.html#cb589-1" tabindex="-1"></a>polls <span class="ot">&lt;-</span> polls <span class="sc">|&gt;</span> </span>
<span id="cb589-2"><a href="string-processing-and-text-mining.html#cb589-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="st">&quot;remain&quot;</span>, <span class="st">&quot;leave&quot;</span>, <span class="st">&quot;undecided&quot;</span>, <span class="st">&quot;spread&quot;</span>), <span class="sc">~</span><span class="fu">format_percentage</span>(.))) <span class="sc">|&gt;</span> </span>
<span id="cb589-3"><a href="string-processing-and-text-mining.html#cb589-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(<span class="st">&quot;sample&quot;</span>), <span class="sc">~</span><span class="fu">parse_number</span>(.)))</span></code></pre></div>
</details>
<ol start="120" style="list-style-type: decimal">
<li>Import the Peruvian COVID-19 dataset from <a href="https://www.datosabiertos.gob.pe/sites/default/files/DATOSABIERTOS_SISCOVID.csv">this URL</a> into an object named <code>covid_peru</code>. Convert the birth date column (<code>FECHA_NACIMIENTO</code>) to a proper Date format and calculate the age distribution of the infected individuals using a histogram.</li>
</ol>
<details>
<summary type="button">
Solution
</summary>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="string-processing-and-text-mining.html#cb590-1" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://www.datosabiertos.gob.pe/sites/default/files/DATOSABIERTOS_SISCOVID.csv&quot;</span></span>
<span id="cb590-2"><a href="string-processing-and-text-mining.html#cb590-2" tabindex="-1"></a>covid_peru <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(url)</span>
<span id="cb590-3"><a href="string-processing-and-text-mining.html#cb590-3" tabindex="-1"></a></span>
<span id="cb590-4"><a href="string-processing-and-text-mining.html#cb590-4" tabindex="-1"></a><span class="co"># We look for those that do not follow the ISO 8601 standard:</span></span>
<span id="cb590-5"><a href="string-processing-and-text-mining.html#cb590-5" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(covid_peru<span class="sc">$</span>FECHA_NACIMIENTO, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d{4}-</span><span class="sc">\\</span><span class="st">d{2}-</span><span class="sc">\\</span><span class="st">d{2}&quot;</span>)</span>
<span id="cb590-6"><a href="string-processing-and-text-mining.html#cb590-6" tabindex="-1"></a>covid_peru<span class="sc">$</span>FECHA_NACIMIENTO[<span class="sc">!</span>index]</span>
<span id="cb590-7"><a href="string-processing-and-text-mining.html#cb590-7" tabindex="-1"></a></span>
<span id="cb590-8"><a href="string-processing-and-text-mining.html#cb590-8" tabindex="-1"></a><span class="co"># We see dates in DD/MM/YYYY format</span></span>
<span id="cb590-9"><a href="string-processing-and-text-mining.html#cb590-9" tabindex="-1"></a><span class="co"># We replace to ISO 8601 format:</span></span>
<span id="cb590-10"><a href="string-processing-and-text-mining.html#cb590-10" tabindex="-1"></a>covid_peru <span class="ot">&lt;-</span> covid_peru <span class="sc">|&gt;</span> </span>
<span id="cb590-11"><a href="string-processing-and-text-mining.html#cb590-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="st">&quot;FECHA_NACIMIENTO&quot;</span>, </span>
<span id="cb590-12"><a href="string-processing-and-text-mining.html#cb590-12" tabindex="-1"></a>            <span class="sc">~</span><span class="fu">str_replace</span>(., <span class="st">&quot;(</span><span class="sc">\\</span><span class="st">d{2})/(</span><span class="sc">\\</span><span class="st">d{2})/(</span><span class="sc">\\</span><span class="st">d{4})&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">3-</span><span class="sc">\\</span><span class="st">2-</span><span class="sc">\\</span><span class="st">1&quot;</span>)</span>
<span id="cb590-13"><a href="string-processing-and-text-mining.html#cb590-13" tabindex="-1"></a>            ))</span>
<span id="cb590-14"><a href="string-processing-and-text-mining.html#cb590-14" tabindex="-1"></a></span>
<span id="cb590-15"><a href="string-processing-and-text-mining.html#cb590-15" tabindex="-1"></a><span class="co"># We search again for those that do not follow ISO 8601 standard:</span></span>
<span id="cb590-16"><a href="string-processing-and-text-mining.html#cb590-16" tabindex="-1"></a>index <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(covid_peru<span class="sc">$</span>FECHA_NACIMIENTO, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d{4}-</span><span class="sc">\\</span><span class="st">d{2}-</span><span class="sc">\\</span><span class="st">d{2}&quot;</span>)</span>
<span id="cb590-17"><a href="string-processing-and-text-mining.html#cb590-17" tabindex="-1"></a>covid_peru<span class="sc">$</span>FECHA_NACIMIENTO[<span class="sc">!</span>index]</span>
<span id="cb590-18"><a href="string-processing-and-text-mining.html#cb590-18" tabindex="-1"></a></span>
<span id="cb590-19"><a href="string-processing-and-text-mining.html#cb590-19" tabindex="-1"></a><span class="co"># Convert column to date:</span></span>
<span id="cb590-20"><a href="string-processing-and-text-mining.html#cb590-20" tabindex="-1"></a>covid_peru <span class="ot">&lt;-</span> covid_peru <span class="sc">|&gt;</span> </span>
<span id="cb590-21"><a href="string-processing-and-text-mining.html#cb590-21" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="st">&quot;FECHA_NACIMIENTO&quot;</span>, <span class="sc">~</span><span class="fu">ymd</span>(.)))</span>
<span id="cb590-22"><a href="string-processing-and-text-mining.html#cb590-22" tabindex="-1"></a></span>
<span id="cb590-23"><a href="string-processing-and-text-mining.html#cb590-23" tabindex="-1"></a><span class="co"># Now that it is date format we create histogram:</span></span>
<span id="cb590-24"><a href="string-processing-and-text-mining.html#cb590-24" tabindex="-1"></a>covid_peru <span class="sc">|&gt;</span> </span>
<span id="cb590-25"><a href="string-processing-and-text-mining.html#cb590-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> <span class="fu">year</span>(<span class="fu">now</span>()) <span class="sc">-</span> <span class="fu">year</span>(FECHA_NACIMIENTO)) <span class="sc">|&gt;</span> </span>
<span id="cb590-26"><a href="string-processing-and-text-mining.html#cb590-26" tabindex="-1"></a>  <span class="fu">pull</span>(age) <span class="sc">|&gt;</span> </span>
<span id="cb590-27"><a href="string-processing-and-text-mining.html#cb590-27" tabindex="-1"></a>  <span class="fu">hist</span>()</span></code></pre></div>
</details>
</div>
<div id="text-mining-using-tidy-data" class="section level2 hasAnchor" number="13.5">
<h2><span class="header-section-number">13.5</span> Text Mining using Tidy Data<a href="string-processing-and-text-mining.html#text-mining-using-tidy-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Text mining is the discovery by computer of new information, previously unknown, by automatically extracting information from different written resources. Written resources can be websites, books, chats, comments, emails, reviews, articles, etc.</p>
<p>To perform text mining efficiently in R, we will use the <code>tidytext</code> package. The “tidy” text format is defined as a table with one token per row. A token can be a word, a sentence, or a paragraph, but usually, it is single words. This structure allows us to use all the standard tools we’ve learned (<code>dplyr</code>, <code>ggplot2</code>) to analyze text.</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb591-1"><a href="string-processing-and-text-mining.html#cb591-1" tabindex="-1"></a><span class="co"># Install packages if you haven&#39;t yet</span></span>
<span id="cb591-2"><a href="string-processing-and-text-mining.html#cb591-2" tabindex="-1"></a><span class="co"># install.packages(&quot;tidytext&quot;)</span></span>
<span id="cb591-3"><a href="string-processing-and-text-mining.html#cb591-3" tabindex="-1"></a></span>
<span id="cb591-4"><a href="string-processing-and-text-mining.html#cb591-4" tabindex="-1"></a><span class="fu">library</span>(tidytext)</span>
<span id="cb591-5"><a href="string-processing-and-text-mining.html#cb591-5" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb591-6"><a href="string-processing-and-text-mining.html#cb591-6" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb591-7"><a href="string-processing-and-text-mining.html#cb591-7" tabindex="-1"></a><span class="fu">library</span>(syuzhet) <span class="co"># For sentiment analysis</span></span>
<span id="cb591-8"><a href="string-processing-and-text-mining.html#cb591-8" tabindex="-1"></a><span class="fu">library</span>(wordcloud) </span></code></pre></div>
<div id="importing-data-and-tokenization" class="section level3 hasAnchor" number="13.5.1">
<h3><span class="header-section-number">13.5.1</span> Importing data and Tokenization<a href="string-processing-and-text-mining.html#importing-data-and-tokenization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Word maps or word clouds allow us to quickly identify which are the words that are repeated most in a text.</p>
<p>We are going to analyze the work “Pride and Prejudice” written by the author Jane Austen. We will obtain the text from the <a href="www.gutenberg.org">Project Gutenberg</a><a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a> website. We will use the <code>get_text_as_string()</code> function from <code>syuzhet</code> to import properly.</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="string-processing-and-text-mining.html#cb592-1" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://www.gutenberg.org/cache/epub/1342/pg1342.txt&quot;</span></span>
<span id="cb592-2"><a href="string-processing-and-text-mining.html#cb592-2" tabindex="-1"></a></span>
<span id="cb592-3"><a href="string-processing-and-text-mining.html#cb592-3" tabindex="-1"></a><span class="co"># Import text as a single string</span></span>
<span id="cb592-4"><a href="string-processing-and-text-mining.html#cb592-4" tabindex="-1"></a>pride_book <span class="ot">&lt;-</span> <span class="fu">get_text_as_string</span>(url)</span>
<span id="cb592-5"><a href="string-processing-and-text-mining.html#cb592-5" tabindex="-1"></a></span>
<span id="cb592-6"><a href="string-processing-and-text-mining.html#cb592-6" tabindex="-1"></a><span class="co"># Convert to a data frame with sentences or just lines</span></span>
<span id="cb592-7"><a href="string-processing-and-text-mining.html#cb592-7" tabindex="-1"></a><span class="co"># Here we will split by newline to create a rudimentary structure</span></span>
<span id="cb592-8"><a href="string-processing-and-text-mining.html#cb592-8" tabindex="-1"></a>text_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb592-9"><a href="string-processing-and-text-mining.html#cb592-9" tabindex="-1"></a>  <span class="at">text =</span> <span class="fu">str_split</span>(pride_book, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)[[<span class="dv">1</span>]]</span>
<span id="cb592-10"><a href="string-processing-and-text-mining.html#cb592-10" tabindex="-1"></a>)</span>
<span id="cb592-11"><a href="string-processing-and-text-mining.html#cb592-11" tabindex="-1"></a></span>
<span id="cb592-12"><a href="string-processing-and-text-mining.html#cb592-12" tabindex="-1"></a><span class="co"># Remove empty lines</span></span>
<span id="cb592-13"><a href="string-processing-and-text-mining.html#cb592-13" tabindex="-1"></a>text_df <span class="ot">&lt;-</span> text_df <span class="sc">|&gt;</span> </span>
<span id="cb592-14"><a href="string-processing-and-text-mining.html#cb592-14" tabindex="-1"></a>  <span class="fu">filter</span>(text <span class="sc">!=</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb592-15"><a href="string-processing-and-text-mining.html#cb592-15" tabindex="-1"></a></span>
<span id="cb592-16"><a href="string-processing-and-text-mining.html#cb592-16" tabindex="-1"></a><span class="fu">head</span>(text_df)</span>
<span id="cb592-17"><a href="string-processing-and-text-mining.html#cb592-17" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span id="cb592-18"><a href="string-processing-and-text-mining.html#cb592-18" tabindex="-1"></a><span class="co">#&gt;   text                                                                          </span></span>
<span id="cb592-19"><a href="string-processing-and-text-mining.html#cb592-19" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                                                         </span></span>
<span id="cb592-20"><a href="string-processing-and-text-mining.html#cb592-20" tabindex="-1"></a><span class="co">#&gt; 1 &quot;The Project Gutenberg eBook of Pride and Prejudice      This ebook is for th…</span></span></code></pre></div>
</div>
<div id="text-cleaning-and-tokenization" class="section level3 hasAnchor" number="13.5.2">
<h3><span class="header-section-number">13.5.2</span> Text cleaning and Tokenization<a href="string-processing-and-text-mining.html#text-cleaning-and-tokenization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now we will clean the text and convert it to specific tokens (words). The <code>unnest_tokens()</code> function automatically:
1. Splits text into tokens (words by default).
2. Removes punctuation.
3. Converts to lowercase.</p>
<blockquote>
<p><strong>Note on AI:</strong> This process of breaking text into “tokens” is exactly how Large Language Models like GPT-4 work. In <strong>Chapter 14 (Data Science in the Age of AI)</strong>, we will see that LLMs are essentially probabilistic engines that predict the next token in a sequence. Understanding how to handle tokens here is the foundation for understanding Generative AI.</p>
</blockquote>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="string-processing-and-text-mining.html#cb593-1" tabindex="-1"></a><span class="co"># We eliminate first rows of notes/prologue if needed, though unnest_tokens handles a lot.</span></span>
<span id="cb593-2"><a href="string-processing-and-text-mining.html#cb593-2" tabindex="-1"></a><span class="co"># Let&#39;s clean some metadata lines roughly</span></span>
<span id="cb593-3"><a href="string-processing-and-text-mining.html#cb593-3" tabindex="-1"></a>start_line <span class="ot">&lt;-</span> <span class="dv">115</span></span>
<span id="cb593-4"><a href="string-processing-and-text-mining.html#cb593-4" tabindex="-1"></a>text_df <span class="ot">&lt;-</span> text_df[start_line<span class="sc">:</span><span class="fu">nrow</span>(text_df), ]</span>
<span id="cb593-5"><a href="string-processing-and-text-mining.html#cb593-5" tabindex="-1"></a></span>
<span id="cb593-6"><a href="string-processing-and-text-mining.html#cb593-6" tabindex="-1"></a><span class="co"># Tokenize</span></span>
<span id="cb593-7"><a href="string-processing-and-text-mining.html#cb593-7" tabindex="-1"></a>tidy_pride <span class="ot">&lt;-</span> text_df <span class="sc">|&gt;</span></span>
<span id="cb593-8"><a href="string-processing-and-text-mining.html#cb593-8" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text)</span>
<span id="cb593-9"><a href="string-processing-and-text-mining.html#cb593-9" tabindex="-1"></a></span>
<span id="cb593-10"><a href="string-processing-and-text-mining.html#cb593-10" tabindex="-1"></a><span class="co"># See the result</span></span>
<span id="cb593-11"><a href="string-processing-and-text-mining.html#cb593-11" tabindex="-1"></a><span class="fu">head</span>(tidy_pride)</span>
<span id="cb593-12"><a href="string-processing-and-text-mining.html#cb593-12" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 1</span></span>
<span id="cb593-13"><a href="string-processing-and-text-mining.html#cb593-13" tabindex="-1"></a><span class="co">#&gt;   word </span></span>
<span id="cb593-14"><a href="string-processing-and-text-mining.html#cb593-14" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;</span></span>
<span id="cb593-15"><a href="string-processing-and-text-mining.html#cb593-15" tabindex="-1"></a><span class="co">#&gt; 1 &lt;NA&gt; </span></span>
<span id="cb593-16"><a href="string-processing-and-text-mining.html#cb593-16" tabindex="-1"></a><span class="co">#&gt; 2 &lt;NA&gt; </span></span>
<span id="cb593-17"><a href="string-processing-and-text-mining.html#cb593-17" tabindex="-1"></a><span class="co">#&gt; 3 &lt;NA&gt; </span></span>
<span id="cb593-18"><a href="string-processing-and-text-mining.html#cb593-18" tabindex="-1"></a><span class="co">#&gt; 4 &lt;NA&gt; </span></span>
<span id="cb593-19"><a href="string-processing-and-text-mining.html#cb593-19" tabindex="-1"></a><span class="co">#&gt; 5 &lt;NA&gt; </span></span>
<span id="cb593-20"><a href="string-processing-and-text-mining.html#cb593-20" tabindex="-1"></a><span class="co">#&gt; 6 &lt;NA&gt;</span></span></code></pre></div>
<p>Now we have a table where each row is a word. This is the “tidy” format.</p>
<p>However, we clearly have words that do not add meaning (stop words), such as “the”, “and”, “of”. We can remove them using a list of stop words. The <code>tm</code> package provides a good list for English.</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb594-1"><a href="string-processing-and-text-mining.html#cb594-1" tabindex="-1"></a><span class="fu">library</span>(tm)</span>
<span id="cb594-2"><a href="string-processing-and-text-mining.html#cb594-2" tabindex="-1"></a>english_stop_words <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">word =</span> <span class="fu">stopwords</span>(<span class="st">&quot;english&quot;</span>))</span>
<span id="cb594-3"><a href="string-processing-and-text-mining.html#cb594-3" tabindex="-1"></a></span>
<span id="cb594-4"><a href="string-processing-and-text-mining.html#cb594-4" tabindex="-1"></a><span class="co"># Remove stop words using anti_join</span></span>
<span id="cb594-5"><a href="string-processing-and-text-mining.html#cb594-5" tabindex="-1"></a>tidy_pride_clean <span class="ot">&lt;-</span> tidy_pride <span class="sc">|&gt;</span></span>
<span id="cb594-6"><a href="string-processing-and-text-mining.html#cb594-6" tabindex="-1"></a>  <span class="fu">anti_join</span>(english_stop_words, <span class="at">by =</span> <span class="st">&quot;word&quot;</span>)</span>
<span id="cb594-7"><a href="string-processing-and-text-mining.html#cb594-7" tabindex="-1"></a></span>
<span id="cb594-8"><a href="string-processing-and-text-mining.html#cb594-8" tabindex="-1"></a><span class="fu">head</span>(tidy_pride_clean)</span>
<span id="cb594-9"><a href="string-processing-and-text-mining.html#cb594-9" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 1</span></span>
<span id="cb594-10"><a href="string-processing-and-text-mining.html#cb594-10" tabindex="-1"></a><span class="co">#&gt;   word </span></span>
<span id="cb594-11"><a href="string-processing-and-text-mining.html#cb594-11" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;</span></span>
<span id="cb594-12"><a href="string-processing-and-text-mining.html#cb594-12" tabindex="-1"></a><span class="co">#&gt; 1 &lt;NA&gt; </span></span>
<span id="cb594-13"><a href="string-processing-and-text-mining.html#cb594-13" tabindex="-1"></a><span class="co">#&gt; 2 &lt;NA&gt; </span></span>
<span id="cb594-14"><a href="string-processing-and-text-mining.html#cb594-14" tabindex="-1"></a><span class="co">#&gt; 3 &lt;NA&gt; </span></span>
<span id="cb594-15"><a href="string-processing-and-text-mining.html#cb594-15" tabindex="-1"></a><span class="co">#&gt; 4 &lt;NA&gt; </span></span>
<span id="cb594-16"><a href="string-processing-and-text-mining.html#cb594-16" tabindex="-1"></a><span class="co">#&gt; 5 &lt;NA&gt; </span></span>
<span id="cb594-17"><a href="string-processing-and-text-mining.html#cb594-17" tabindex="-1"></a><span class="co">#&gt; 6 &lt;NA&gt;</span></span></code></pre></div>
<p>We might also want to remove custom words or numbers that appeared in the extraction.</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="string-processing-and-text-mining.html#cb595-1" tabindex="-1"></a>custom_stop_words <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">word =</span> <span class="fu">c</span>(<span class="st">&quot;mr&quot;</span>, <span class="st">&quot;mrs&quot;</span>, <span class="st">&quot;miss&quot;</span>, <span class="st">&quot;said&quot;</span>, <span class="st">&quot;will&quot;</span>, </span>
<span id="cb595-2"><a href="string-processing-and-text-mining.html#cb595-2" tabindex="-1"></a>                                     <span class="st">&quot;one&quot;</span>, <span class="st">&quot;much&quot;</span>, <span class="st">&quot;may&quot;</span>, <span class="st">&quot;can&quot;</span>, <span class="st">&quot;now&quot;</span>, <span class="st">&quot;sir&quot;</span>, <span class="st">&quot;lady&quot;</span>))</span>
<span id="cb595-3"><a href="string-processing-and-text-mining.html#cb595-3" tabindex="-1"></a></span>
<span id="cb595-4"><a href="string-processing-and-text-mining.html#cb595-4" tabindex="-1"></a>tidy_pride_clean <span class="ot">&lt;-</span> tidy_pride_clean <span class="sc">|&gt;</span></span>
<span id="cb595-5"><a href="string-processing-and-text-mining.html#cb595-5" tabindex="-1"></a>  <span class="fu">anti_join</span>(custom_stop_words, <span class="at">by =</span> <span class="st">&quot;word&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb595-6"><a href="string-processing-and-text-mining.html#cb595-6" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(word, <span class="st">&quot;^</span><span class="sc">\\</span><span class="st">d+$&quot;</span>)) <span class="co"># Remove pure numbers</span></span></code></pre></div>
</div>
<div id="word-cloud" class="section level3 hasAnchor" number="13.5.3">
<h3><span class="header-section-number">13.5.3</span> Word Cloud<a href="string-processing-and-text-mining.html#word-cloud" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now that we have our clean data, calculating word frequency is as simple as using <code>count()</code>.</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="string-processing-and-text-mining.html#cb596-1" tabindex="-1"></a>word_counts <span class="ot">&lt;-</span> tidy_pride_clean <span class="sc">|&gt;</span></span>
<span id="cb596-2"><a href="string-processing-and-text-mining.html#cb596-2" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb596-3"><a href="string-processing-and-text-mining.html#cb596-3" tabindex="-1"></a></span>
<span id="cb596-4"><a href="string-processing-and-text-mining.html#cb596-4" tabindex="-1"></a><span class="fu">head</span>(word_counts)</span>
<span id="cb596-5"><a href="string-processing-and-text-mining.html#cb596-5" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 2</span></span>
<span id="cb596-6"><a href="string-processing-and-text-mining.html#cb596-6" tabindex="-1"></a><span class="co">#&gt;   word          n</span></span>
<span id="cb596-7"><a href="string-processing-and-text-mining.html#cb596-7" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;     &lt;int&gt;</span></span>
<span id="cb596-8"><a href="string-processing-and-text-mining.html#cb596-8" tabindex="-1"></a><span class="co">#&gt; 1 elizabeth   605</span></span>
<span id="cb596-9"><a href="string-processing-and-text-mining.html#cb596-9" tabindex="-1"></a><span class="co">#&gt; 2 darcy       383</span></span>
<span id="cb596-10"><a href="string-processing-and-text-mining.html#cb596-10" tabindex="-1"></a><span class="co">#&gt; 3 must        322</span></span>
<span id="cb596-11"><a href="string-processing-and-text-mining.html#cb596-11" tabindex="-1"></a><span class="co">#&gt; 4 bennet      309</span></span>
<span id="cb596-12"><a href="string-processing-and-text-mining.html#cb596-12" tabindex="-1"></a><span class="co">#&gt; 5 jane        274</span></span>
<span id="cb596-13"><a href="string-processing-and-text-mining.html#cb596-13" tabindex="-1"></a><span class="co">#&gt; 6 bingley     262</span></span></code></pre></div>
<p>We can create the word cloud directly from this data frame.</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="string-processing-and-text-mining.html#cb597-1" tabindex="-1"></a><span class="fu">wordcloud</span>(<span class="at">words =</span> word_counts<span class="sc">$</span>word, </span>
<span id="cb597-2"><a href="string-processing-and-text-mining.html#cb597-2" tabindex="-1"></a>          <span class="at">freq =</span> word_counts<span class="sc">$</span>n,</span>
<span id="cb597-3"><a href="string-processing-and-text-mining.html#cb597-3" tabindex="-1"></a>          <span class="at">min.freq =</span> <span class="dv">5</span>,</span>
<span id="cb597-4"><a href="string-processing-and-text-mining.html#cb597-4" tabindex="-1"></a>          <span class="at">max.words =</span> <span class="dv">80</span>, </span>
<span id="cb597-5"><a href="string-processing-and-text-mining.html#cb597-5" tabindex="-1"></a>          <span class="at">random.order =</span> <span class="cn">FALSE</span>, </span>
<span id="cb597-6"><a href="string-processing-and-text-mining.html#cb597-6" tabindex="-1"></a>          <span class="at">colors =</span> <span class="fu">brewer.pal</span>(<span class="at">name =</span> <span class="st">&quot;Dark2&quot;</span>, <span class="at">n =</span> <span class="dv">8</span>))</span></code></pre></div>
<p><img src="Data-Science-with-R_files/figure-html/unnamed-chunk-774-1.png" alt="" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="word-frequency-plot" class="section level3 hasAnchor" number="13.5.4">
<h3><span class="header-section-number">13.5.4</span> Word Frequency Plot<a href="string-processing-and-text-mining.html#word-frequency-plot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Since we have the data in a tidy format, plotting a bar chart of the most frequent words is straightforward with <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb598-1"><a href="string-processing-and-text-mining.html#cb598-1" tabindex="-1"></a>word_counts <span class="sc">|&gt;</span></span>
<span id="cb598-2"><a href="string-processing-and-text-mining.html#cb598-2" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>) <span class="sc">|&gt;</span></span>
<span id="cb598-3"><a href="string-processing-and-text-mining.html#cb598-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(n, <span class="fu">reorder</span>(word, n))) <span class="sc">+</span></span>
<span id="cb598-4"><a href="string-processing-and-text-mining.html#cb598-4" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb598-5"><a href="string-processing-and-text-mining.html#cb598-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">&quot;Frequency&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Most common words in Pride and Prejudice&quot;</span>)</span></code></pre></div>
<p><img src="Data-Science-with-R_files/figure-html/unnamed-chunk-775-1.png" alt="" width="80%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="sentiment-analysis" class="section level2 hasAnchor" number="13.6">
<h2><span class="header-section-number">13.6</span> Sentiment Analysis<a href="string-processing-and-text-mining.html#sentiment-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Sentiment analysis allows us to know the tone of the messages. We will use the <code>syuzhet</code> package combined with our tidy data skills.</p>
<p>Let’s use the same example of tweets.</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="string-processing-and-text-mining.html#cb599-1" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb599-2"><a href="string-processing-and-text-mining.html#cb599-2" tabindex="-1"></a></span>
<span id="cb599-3"><a href="string-processing-and-text-mining.html#cb599-3" tabindex="-1"></a><span class="co"># Download tweets</span></span>
<span id="cb599-4"><a href="string-processing-and-text-mining.html#cb599-4" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">&quot;https://dparedesi.github.io/Data-Science-with-R-book/data/rmapalacios-tweets.xlsx&quot;</span></span>
<span id="cb599-5"><a href="string-processing-and-text-mining.html#cb599-5" tabindex="-1"></a>temp_file <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb599-6"><a href="string-processing-and-text-mining.html#cb599-6" tabindex="-1"></a><span class="fu">download.file</span>(url, temp_file)</span>
<span id="cb599-7"><a href="string-processing-and-text-mining.html#cb599-7" tabindex="-1"></a>posts <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(temp_file)</span>
<span id="cb599-8"><a href="string-processing-and-text-mining.html#cb599-8" tabindex="-1"></a><span class="fu">file.remove</span>(temp_file)</span>
<span id="cb599-9"><a href="string-processing-and-text-mining.html#cb599-9" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb599-10"><a href="string-processing-and-text-mining.html#cb599-10" tabindex="-1"></a></span>
<span id="cb599-11"><a href="string-processing-and-text-mining.html#cb599-11" tabindex="-1"></a><span class="co"># Filter for tweets only and create a tidy dataframe</span></span>
<span id="cb599-12"><a href="string-processing-and-text-mining.html#cb599-12" tabindex="-1"></a>tweets_df <span class="ot">&lt;-</span> posts <span class="sc">|&gt;</span> </span>
<span id="cb599-13"><a href="string-processing-and-text-mining.html#cb599-13" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Tweet Type</span><span class="st">`</span> <span class="sc">==</span> <span class="st">&quot;Tweet&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb599-14"><a href="string-processing-and-text-mining.html#cb599-14" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">text =</span> Text) <span class="sc">|&gt;</span></span>
<span id="cb599-15"><a href="string-processing-and-text-mining.html#cb599-15" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tweet_id =</span> <span class="fu">row_number</span>()) </span>
<span id="cb599-16"><a href="string-processing-and-text-mining.html#cb599-16" tabindex="-1"></a></span>
<span id="cb599-17"><a href="string-processing-and-text-mining.html#cb599-17" tabindex="-1"></a><span class="fu">head</span>(tweets_df)</span>
<span id="cb599-18"><a href="string-processing-and-text-mining.html#cb599-18" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 2</span></span>
<span id="cb599-19"><a href="string-processing-and-text-mining.html#cb599-19" tabindex="-1"></a><span class="co">#&gt;   text                                                                  tweet_id</span></span>
<span id="cb599-20"><a href="string-processing-and-text-mining.html#cb599-20" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                                                                    &lt;int&gt;</span></span>
<span id="cb599-21"><a href="string-processing-and-text-mining.html#cb599-21" tabindex="-1"></a><span class="co">#&gt; 1 &quot;Le agradezco mucho regidor.\nUna visita al niño y a su madre pueden…        1</span></span>
<span id="cb599-22"><a href="string-processing-and-text-mining.html#cb599-22" tabindex="-1"></a><span class="co">#&gt; 2 &quot;Esto esta prohibido en tantas normas que no se por donde empezar.\n…        2</span></span>
<span id="cb599-23"><a href="string-processing-and-text-mining.html#cb599-23" tabindex="-1"></a><span class="co">#&gt; 3 &quot;Nadie lo sabe y a los ministros sectoriales parece importarles poco…        3</span></span>
<span id="cb599-24"><a href="string-processing-and-text-mining.html#cb599-24" tabindex="-1"></a><span class="co">#&gt; 4 &quot;Ahora se llama \&quot;trabajo remoto\&quot; con el auspicio del Estado peruan…        4</span></span>
<span id="cb599-25"><a href="string-processing-and-text-mining.html#cb599-25" tabindex="-1"></a><span class="co">#&gt; 5 &quot;¿Y usted esta muy seguro que va a salir a trabajar el lunes 25? Vay…        5</span></span>
<span id="cb599-26"><a href="string-processing-and-text-mining.html#cb599-26" tabindex="-1"></a><span class="co">#&gt; 6 &quot;No saben como abundan. https://t.co/r1qMGOhGcR&quot;                             6</span></span></code></pre></div>
<p>Now we clean the tweets. <code>unnest_tokens</code> handles most of it, but for tweets, we might want to remove URL links first.</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="string-processing-and-text-mining.html#cb600-1" tabindex="-1"></a><span class="co"># Custom cleaning function for tweets before tokenization</span></span>
<span id="cb600-2"><a href="string-processing-and-text-mining.html#cb600-2" tabindex="-1"></a>clean_tweets <span class="ot">&lt;-</span> tweets_df <span class="sc">|&gt;</span></span>
<span id="cb600-3"><a href="string-processing-and-text-mining.html#cb600-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">&quot;http</span><span class="sc">\\</span><span class="st">S+&quot;</span>, <span class="st">&quot;&quot;</span>)) <span class="sc">|&gt;</span> <span class="co"># remove URLs</span></span>
<span id="cb600-4"><a href="string-processing-and-text-mining.html#cb600-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">text =</span> <span class="fu">str_replace_all</span>(text, <span class="st">&quot;@</span><span class="sc">\\</span><span class="st">S+&quot;</span>, <span class="st">&quot;&quot;</span>)) <span class="co"># remove mentions</span></span>
<span id="cb600-5"><a href="string-processing-and-text-mining.html#cb600-5" tabindex="-1"></a></span>
<span id="cb600-6"><a href="string-processing-and-text-mining.html#cb600-6" tabindex="-1"></a><span class="co"># Get Sentiment scores for each tweet</span></span>
<span id="cb600-7"><a href="string-processing-and-text-mining.html#cb600-7" tabindex="-1"></a><span class="co"># syuzhet works well with the full text vector for scoring</span></span>
<span id="cb600-8"><a href="string-processing-and-text-mining.html#cb600-8" tabindex="-1"></a>tweet_sentiments <span class="ot">&lt;-</span> <span class="fu">get_nrc_sentiment</span>(clean_tweets<span class="sc">$</span>text, <span class="at">language =</span> <span class="st">&quot;spanish&quot;</span>)</span>
<span id="cb600-9"><a href="string-processing-and-text-mining.html#cb600-9" tabindex="-1"></a></span>
<span id="cb600-10"><a href="string-processing-and-text-mining.html#cb600-10" tabindex="-1"></a><span class="co"># Combine with original data</span></span>
<span id="cb600-11"><a href="string-processing-and-text-mining.html#cb600-11" tabindex="-1"></a>tweets_with_sentiment <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(clean_tweets, tweet_sentiments)</span>
<span id="cb600-12"><a href="string-processing-and-text-mining.html#cb600-12" tabindex="-1"></a></span>
<span id="cb600-13"><a href="string-processing-and-text-mining.html#cb600-13" tabindex="-1"></a><span class="fu">head</span>(tweets_with_sentiment)</span>
<span id="cb600-14"><a href="string-processing-and-text-mining.html#cb600-14" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 × 12</span></span>
<span id="cb600-15"><a href="string-processing-and-text-mining.html#cb600-15" tabindex="-1"></a><span class="co">#&gt;   text    tweet_id anger anticipation disgust  fear   joy sadness surprise trust</span></span>
<span id="cb600-16"><a href="string-processing-and-text-mining.html#cb600-16" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb600-17"><a href="string-processing-and-text-mining.html#cb600-17" tabindex="-1"></a><span class="co">#&gt; 1 &quot;Le ag…        1     0            1       0     2     1       3        0     3</span></span>
<span id="cb600-18"><a href="string-processing-and-text-mining.html#cb600-18" tabindex="-1"></a><span class="co">#&gt; 2 &quot;Esto …        2     4            0       3     5     0       3        0     0</span></span>
<span id="cb600-19"><a href="string-processing-and-text-mining.html#cb600-19" tabindex="-1"></a><span class="co">#&gt; 3 &quot;Nadie…        3     0            0       0     0     0       0        0     0</span></span>
<span id="cb600-20"><a href="string-processing-and-text-mining.html#cb600-20" tabindex="-1"></a><span class="co">#&gt; 4 &quot;Ahora…        4     0            1       0     0     1       0        1     1</span></span>
<span id="cb600-21"><a href="string-processing-and-text-mining.html#cb600-21" tabindex="-1"></a><span class="co">#&gt; 5 &quot;¿Y us…        5     0            2       0     1     3       2        0     4</span></span>
<span id="cb600-22"><a href="string-processing-and-text-mining.html#cb600-22" tabindex="-1"></a><span class="co">#&gt; 6 &quot;No sa…        6     0            0       0     0     0       0        0     0</span></span>
<span id="cb600-23"><a href="string-processing-and-text-mining.html#cb600-23" tabindex="-1"></a><span class="co">#&gt; # ℹ 2 more variables: negative &lt;dbl&gt;, positive &lt;dbl&gt;</span></span></code></pre></div>
<p>We can now reshape this data to visualize emotions using <code>pivot_longer</code>, just like we do with any tidy dataset.</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="string-processing-and-text-mining.html#cb601-1" tabindex="-1"></a>translate_emotions <span class="ot">&lt;-</span> <span class="cf">function</span>(string){</span>
<span id="cb601-2"><a href="string-processing-and-text-mining.html#cb601-2" tabindex="-1"></a>  <span class="fu">case_when</span>(</span>
<span id="cb601-3"><a href="string-processing-and-text-mining.html#cb601-3" tabindex="-1"></a>    string <span class="sc">==</span> <span class="st">&quot;anger&quot;</span> <span class="sc">~</span> <span class="st">&quot;Anger&quot;</span>,</span>
<span id="cb601-4"><a href="string-processing-and-text-mining.html#cb601-4" tabindex="-1"></a>    string <span class="sc">==</span> <span class="st">&quot;anticipation&quot;</span> <span class="sc">~</span> <span class="st">&quot;Anticipation&quot;</span>,</span>
<span id="cb601-5"><a href="string-processing-and-text-mining.html#cb601-5" tabindex="-1"></a>    string <span class="sc">==</span> <span class="st">&quot;disgust&quot;</span> <span class="sc">~</span> <span class="st">&quot;Disgust&quot;</span>,</span>
<span id="cb601-6"><a href="string-processing-and-text-mining.html#cb601-6" tabindex="-1"></a>    string <span class="sc">==</span> <span class="st">&quot;fear&quot;</span> <span class="sc">~</span> <span class="st">&quot;Fear&quot;</span>,</span>
<span id="cb601-7"><a href="string-processing-and-text-mining.html#cb601-7" tabindex="-1"></a>    string <span class="sc">==</span> <span class="st">&quot;joy&quot;</span> <span class="sc">~</span> <span class="st">&quot;Joy&quot;</span>,</span>
<span id="cb601-8"><a href="string-processing-and-text-mining.html#cb601-8" tabindex="-1"></a>    string <span class="sc">==</span> <span class="st">&quot;sadness&quot;</span> <span class="sc">~</span> <span class="st">&quot;Sadness&quot;</span>,</span>
<span id="cb601-9"><a href="string-processing-and-text-mining.html#cb601-9" tabindex="-1"></a>    string <span class="sc">==</span> <span class="st">&quot;surprise&quot;</span> <span class="sc">~</span> <span class="st">&quot;Surprise&quot;</span>,</span>
<span id="cb601-10"><a href="string-processing-and-text-mining.html#cb601-10" tabindex="-1"></a>    string <span class="sc">==</span> <span class="st">&quot;trust&quot;</span> <span class="sc">~</span> <span class="st">&quot;Trust&quot;</span>,</span>
<span id="cb601-11"><a href="string-processing-and-text-mining.html#cb601-11" tabindex="-1"></a>    string <span class="sc">==</span> <span class="st">&quot;negative&quot;</span> <span class="sc">~</span> <span class="st">&quot;Negative&quot;</span>,</span>
<span id="cb601-12"><a href="string-processing-and-text-mining.html#cb601-12" tabindex="-1"></a>    string <span class="sc">==</span> <span class="st">&quot;positive&quot;</span> <span class="sc">~</span> <span class="st">&quot;Positive&quot;</span>,</span>
<span id="cb601-13"><a href="string-processing-and-text-mining.html#cb601-13" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> string</span>
<span id="cb601-14"><a href="string-processing-and-text-mining.html#cb601-14" tabindex="-1"></a>  )</span>
<span id="cb601-15"><a href="string-processing-and-text-mining.html#cb601-15" tabindex="-1"></a>}</span>
<span id="cb601-16"><a href="string-processing-and-text-mining.html#cb601-16" tabindex="-1"></a></span>
<span id="cb601-17"><a href="string-processing-and-text-mining.html#cb601-17" tabindex="-1"></a><span class="co"># Summarize totals</span></span>
<span id="cb601-18"><a href="string-processing-and-text-mining.html#cb601-18" tabindex="-1"></a>sentiment_totals <span class="ot">&lt;-</span> tweets_with_sentiment <span class="sc">|&gt;</span> </span>
<span id="cb601-19"><a href="string-processing-and-text-mining.html#cb601-19" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(anger<span class="sc">:</span>positive, sum)) <span class="sc">|&gt;</span></span>
<span id="cb601-20"><a href="string-processing-and-text-mining.html#cb601-20" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;sentiment&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;total&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb601-21"><a href="string-processing-and-text-mining.html#cb601-21" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sentiment =</span> <span class="fu">translate_emotions</span>(sentiment))</span>
<span id="cb601-22"><a href="string-processing-and-text-mining.html#cb601-22" tabindex="-1"></a></span>
<span id="cb601-23"><a href="string-processing-and-text-mining.html#cb601-23" tabindex="-1"></a>sentiment_totals</span>
<span id="cb601-24"><a href="string-processing-and-text-mining.html#cb601-24" tabindex="-1"></a><span class="co">#&gt; # A tibble: 10 × 2</span></span>
<span id="cb601-25"><a href="string-processing-and-text-mining.html#cb601-25" tabindex="-1"></a><span class="co">#&gt;    sentiment    total</span></span>
<span id="cb601-26"><a href="string-processing-and-text-mining.html#cb601-26" tabindex="-1"></a><span class="co">#&gt;    &lt;chr&gt;        &lt;dbl&gt;</span></span>
<span id="cb601-27"><a href="string-processing-and-text-mining.html#cb601-27" tabindex="-1"></a><span class="co">#&gt;  1 Anger          805</span></span>
<span id="cb601-28"><a href="string-processing-and-text-mining.html#cb601-28" tabindex="-1"></a><span class="co">#&gt;  2 Anticipation   905</span></span>
<span id="cb601-29"><a href="string-processing-and-text-mining.html#cb601-29" tabindex="-1"></a><span class="co">#&gt;  3 Disgust        807</span></span>
<span id="cb601-30"><a href="string-processing-and-text-mining.html#cb601-30" tabindex="-1"></a><span class="co">#&gt;  4 Fear          1344</span></span>
<span id="cb601-31"><a href="string-processing-and-text-mining.html#cb601-31" tabindex="-1"></a><span class="co">#&gt;  5 Joy            549</span></span>
<span id="cb601-32"><a href="string-processing-and-text-mining.html#cb601-32" tabindex="-1"></a><span class="co">#&gt;  6 Sadness       1378</span></span>
<span id="cb601-33"><a href="string-processing-and-text-mining.html#cb601-33" tabindex="-1"></a><span class="co">#&gt;  7 Surprise       421</span></span>
<span id="cb601-34"><a href="string-processing-and-text-mining.html#cb601-34" tabindex="-1"></a><span class="co">#&gt;  8 Trust         1373</span></span>
<span id="cb601-35"><a href="string-processing-and-text-mining.html#cb601-35" tabindex="-1"></a><span class="co">#&gt;  9 Negative      2535</span></span>
<span id="cb601-36"><a href="string-processing-and-text-mining.html#cb601-36" tabindex="-1"></a><span class="co">#&gt; 10 Positive      2314</span></span></code></pre></div>
<p>Visualizing:</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="string-processing-and-text-mining.html#cb602-1" tabindex="-1"></a><span class="co"># Separate positive/negative from specific emotions</span></span>
<span id="cb602-2"><a href="string-processing-and-text-mining.html#cb602-2" tabindex="-1"></a>general_sentiments <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Positive&quot;</span>, <span class="st">&quot;Negative&quot;</span>)</span>
<span id="cb602-3"><a href="string-processing-and-text-mining.html#cb602-3" tabindex="-1"></a></span>
<span id="cb602-4"><a href="string-processing-and-text-mining.html#cb602-4" tabindex="-1"></a>sentiment_totals <span class="sc">|&gt;</span></span>
<span id="cb602-5"><a href="string-processing-and-text-mining.html#cb602-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>sentiment <span class="sc">%in%</span> general_sentiments) <span class="sc">|&gt;</span></span>
<span id="cb602-6"><a href="string-processing-and-text-mining.html#cb602-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">reorder</span>(sentiment, total), total, <span class="at">fill =</span> sentiment)) <span class="sc">+</span></span>
<span id="cb602-7"><a href="string-processing-and-text-mining.html#cb602-7" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb602-8"><a href="string-processing-and-text-mining.html#cb602-8" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb602-9"><a href="string-processing-and-text-mining.html#cb602-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;Total Score&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Emotions in Tweets&quot;</span>) <span class="sc">+</span></span>
<span id="cb602-10"><a href="string-processing-and-text-mining.html#cb602-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb602-11"><a href="string-processing-and-text-mining.html#cb602-11" tabindex="-1"></a></span>
<span id="cb602-12"><a href="string-processing-and-text-mining.html#cb602-12" tabindex="-1"></a>sentiment_totals <span class="sc">|&gt;</span></span>
<span id="cb602-13"><a href="string-processing-and-text-mining.html#cb602-13" tabindex="-1"></a>  <span class="fu">filter</span>(sentiment <span class="sc">%in%</span> general_sentiments) <span class="sc">|&gt;</span></span>
<span id="cb602-14"><a href="string-processing-and-text-mining.html#cb602-14" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(sentiment, total, <span class="at">fill =</span> sentiment)) <span class="sc">+</span></span>
<span id="cb602-15"><a href="string-processing-and-text-mining.html#cb602-15" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb602-16"><a href="string-processing-and-text-mining.html#cb602-16" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;Total Score&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Positive vs Negative Sentiment&quot;</span>)</span></code></pre></div>
<p><img src="Data-Science-with-R_files/figure-html/unnamed-chunk-779-1.png" alt="" width="80%" style="display: block; margin: auto;" /><img src="Data-Science-with-R_files/figure-html/unnamed-chunk-779-2.png" alt="" width="80%" style="display: block; margin: auto;" /></p>
<p>This tidy approach makes it much easier to inspect the data at every step and integrate valid data science workflows (filtering, joining, plotting) without learning a separate system just for text.</p>
</div>
<div id="exercises-20" class="section level2 hasAnchor" number="13.7">
<h2><span class="header-section-number">13.7</span> Exercises<a href="string-processing-and-text-mining.html#exercises-20" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For these exercises we will use more books from Project Gutenberg using the <code>gutenbergr</code> library.</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb603-1"><a href="string-processing-and-text-mining.html#cb603-1" tabindex="-1"></a><span class="co"># install.packages(&quot;gutenbergr&quot;)</span></span>
<span id="cb603-2"><a href="string-processing-and-text-mining.html#cb603-2" tabindex="-1"></a><span class="fu">library</span>(gutenbergr)</span>
<span id="cb603-3"><a href="string-processing-and-text-mining.html#cb603-3" tabindex="-1"></a></span>
<span id="cb603-4"><a href="string-processing-and-text-mining.html#cb603-4" tabindex="-1"></a><span class="co"># Tibble: list of books in Gutenberg.org</span></span>
<span id="cb603-5"><a href="string-processing-and-text-mining.html#cb603-5" tabindex="-1"></a>gutenberg_metadata</span>
<span id="cb603-6"><a href="string-processing-and-text-mining.html#cb603-6" tabindex="-1"></a></span>
<span id="cb603-7"><a href="string-processing-and-text-mining.html#cb603-7" tabindex="-1"></a><span class="co"># List of books in Spanish</span></span>
<span id="cb603-8"><a href="string-processing-and-text-mining.html#cb603-8" tabindex="-1"></a><span class="fu">gutenberg_works</span>(<span class="at">languages =</span> <span class="st">&quot;es&quot;</span>)</span></code></pre></div>
<ol start="121" style="list-style-type: decimal">
<li>Use <code>gutenberg_download(2000)</code> to download the text of “El ingenioso hidalgo don Quijote de la Mancha” and store the result in an object named <code>download</code>.</li>
</ol>
<details>
<summary type="button">
Solution
</summary>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="string-processing-and-text-mining.html#cb604-1" tabindex="-1"></a>download <span class="ot">&lt;-</span> <span class="fu">gutenberg_download</span>(<span class="dv">2000</span>)</span>
<span id="cb604-2"><a href="string-processing-and-text-mining.html#cb604-2" tabindex="-1"></a>quijote_text <span class="ot">&lt;-</span> download<span class="sc">$</span>text</span>
<span id="cb604-3"><a href="string-processing-and-text-mining.html#cb604-3" tabindex="-1"></a><span class="fu">head</span>(quijote_text)</span></code></pre></div>
</details>
<ol start="122" style="list-style-type: decimal">
<li>Extract a random sample of 1,000 lines from the text. Clean this sample by tokenizing into words and removing standard Spanish stop words.</li>
</ol>
<details>
<summary type="button">
Solution
</summary>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="string-processing-and-text-mining.html#cb605-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb605-2"><a href="string-processing-and-text-mining.html#cb605-2" tabindex="-1"></a>sample_lines <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">text =</span> <span class="fu">sample</span>(quijote_text, <span class="dv">1000</span>))</span>
<span id="cb605-3"><a href="string-processing-and-text-mining.html#cb605-3" tabindex="-1"></a></span>
<span id="cb605-4"><a href="string-processing-and-text-mining.html#cb605-4" tabindex="-1"></a>tidy_quijote <span class="ot">&lt;-</span> sample_lines <span class="sc">|&gt;</span></span>
<span id="cb605-5"><a href="string-processing-and-text-mining.html#cb605-5" tabindex="-1"></a>  <span class="fu">unnest_tokens</span>(word, text) <span class="sc">|&gt;</span></span>
<span id="cb605-6"><a href="string-processing-and-text-mining.html#cb605-6" tabindex="-1"></a>  <span class="fu">anti_join</span>(spanish_stop_words, <span class="at">by =</span> <span class="st">&quot;word&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb605-7"><a href="string-processing-and-text-mining.html#cb605-7" tabindex="-1"></a>  <span class="co"># Remove extra stop words if needed</span></span>
<span id="cb605-8"><a href="string-processing-and-text-mining.html#cb605-8" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>word <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;don&quot;</span>, <span class="st">&quot;quijote&quot;</span>, <span class="st">&quot;sancho&quot;</span>)) </span></code></pre></div>
</details>
<ol start="123" style="list-style-type: decimal">
<li>Visualize the most frequent words in your cleaned Quijote sample using a word cloud.</li>
</ol>
<details>
<summary type="button">
Solution
</summary>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="string-processing-and-text-mining.html#cb606-1" tabindex="-1"></a>quijote_counts <span class="ot">&lt;-</span> tidy_quijote <span class="sc">|&gt;</span></span>
<span id="cb606-2"><a href="string-processing-and-text-mining.html#cb606-2" tabindex="-1"></a>  <span class="fu">count</span>(word, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb606-3"><a href="string-processing-and-text-mining.html#cb606-3" tabindex="-1"></a></span>
<span id="cb606-4"><a href="string-processing-and-text-mining.html#cb606-4" tabindex="-1"></a><span class="fu">wordcloud</span>(<span class="at">words =</span> quijote_counts<span class="sc">$</span>word, </span>
<span id="cb606-5"><a href="string-processing-and-text-mining.html#cb606-5" tabindex="-1"></a>          <span class="at">freq =</span> quijote_counts<span class="sc">$</span>n,</span>
<span id="cb606-6"><a href="string-processing-and-text-mining.html#cb606-6" tabindex="-1"></a>          <span class="at">min.freq =</span> <span class="dv">2</span>,</span>
<span id="cb606-7"><a href="string-processing-and-text-mining.html#cb606-7" tabindex="-1"></a>          <span class="at">max.words =</span> <span class="dv">80</span>, </span>
<span id="cb606-8"><a href="string-processing-and-text-mining.html#cb606-8" tabindex="-1"></a>          <span class="at">colors =</span> <span class="fu">brewer.pal</span>(<span class="dv">8</span>, <span class="st">&quot;Dark2&quot;</span>))</span></code></pre></div>
</details>
<ol start="124" style="list-style-type: decimal">
<li>Analyze the sentiments present in your text sample to determine the overall emotional tone.</li>
</ol>
<details>
<summary type="button">
Solution
</summary>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="string-processing-and-text-mining.html#cb607-1" tabindex="-1"></a><span class="co"># Reconstruct text for syuzhet or do word-by-word sentiment if using tidytext lexicon</span></span>
<span id="cb607-2"><a href="string-processing-and-text-mining.html#cb607-2" tabindex="-1"></a><span class="co"># Using syuzhet on the original sample lines is often better for context, </span></span>
<span id="cb607-3"><a href="string-processing-and-text-mining.html#cb607-3" tabindex="-1"></a><span class="co"># but let&#39;s try token-based simply for the exercise or just use the lines:</span></span>
<span id="cb607-4"><a href="string-processing-and-text-mining.html#cb607-4" tabindex="-1"></a></span>
<span id="cb607-5"><a href="string-processing-and-text-mining.html#cb607-5" tabindex="-1"></a><span class="co"># Extract sentiments from the lines</span></span>
<span id="cb607-6"><a href="string-processing-and-text-mining.html#cb607-6" tabindex="-1"></a>quijote_sentiments <span class="ot">&lt;-</span> <span class="fu">get_nrc_sentiment</span>(sample_lines<span class="sc">$</span>text, <span class="at">language =</span> <span class="st">&quot;spanish&quot;</span>)</span>
<span id="cb607-7"><a href="string-processing-and-text-mining.html#cb607-7" tabindex="-1"></a></span>
<span id="cb607-8"><a href="string-processing-and-text-mining.html#cb607-8" tabindex="-1"></a><span class="co"># Summarize/Plot</span></span>
<span id="cb607-9"><a href="string-processing-and-text-mining.html#cb607-9" tabindex="-1"></a>quijote_sentiments <span class="sc">|&gt;</span></span>
<span id="cb607-10"><a href="string-processing-and-text-mining.html#cb607-10" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), sum)) <span class="sc">|&gt;</span></span>
<span id="cb607-11"><a href="string-processing-and-text-mining.html#cb607-11" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;sentiment&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;count&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb607-12"><a href="string-processing-and-text-mining.html#cb607-12" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">reorder</span>(sentiment, count), count)) <span class="sc">+</span></span>
<span id="cb607-13"><a href="string-processing-and-text-mining.html#cb607-13" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">&quot;steelblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb607-14"><a href="string-processing-and-text-mining.html#cb607-14" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb607-15"><a href="string-processing-and-text-mining.html#cb607-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Sentiments in Don Quijote Sample&quot;</span>)</span></code></pre></div>
</details>

</div>
</div>



<div class="footnotes">
<hr />
<ol start="11">
<li id="fn11"><p><a href="https://stringr.tidyverse.org/articles/regular-expressions.html" class="uri">https://stringr.tidyverse.org/articles/regular-expressions.html</a><a href="string-processing-and-text-mining.html#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>www.gutenberg.org<a href="string-processing-and-text-mining.html#fnref12" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="unsupervised-learning.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="genai-intro.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": true,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": null
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": null,
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "section"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
